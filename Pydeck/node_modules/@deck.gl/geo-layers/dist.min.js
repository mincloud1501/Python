!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("deck"),require("h3"),require("s2Geometry"));else if("function"==typeof define&&define.amd)define(["deck","h3","s2Geometry"],e);else{var r="object"==typeof exports?e(require("deck"),require("h3"),require("s2Geometry")):e(t.deck,t.h3,t.s2Geometry);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,(function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=30)}([function(t,e,r){t.exports=r(42)},function(e,r){e.exports=t},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)})(t)}r.d(e,"a",(function(){return i}))},,function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},,function(t,e,r){var n=r(22),i=r(36);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){var n=r(38);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,r){"use strict";(function(t,n){r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return c}));var i=r(2),a="object"!==(void 0===t?"undefined":Object(i.a)(t))||"[object process]"!==String(t)||t.browser,o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==n&&n,document:"undefined"!=typeof document&&document},s=o.global||o.self||o.window,u=void 0!==t&&t.version&&t.version.match(/v([0-9]*)/),c=u&&parseFloat(u[1])||0}).call(this,r(18),r(21))},function(t,e,r){var n=r(39),i=r(40),a=r(41);t.exports=function(t,e){return n(t)||i(t,e)||a()}},function(t,r){t.exports=e},,function(t,e,r){"use strict";(function(t,n){r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return s}));var i=r(2),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":Object(i.a)(n))&&n},o=a.window||a.self||a.global,s=a.process||{};console}).call(this,r(21),r(18))},function(t,e,r){var n=r(37);function i(e,r,a){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,r){var i=n(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(r):a.value}},i(e,r,a||e)}t.exports=i},function(t,e){t.exports=r},,function(t,e){var r,n,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&y())}function y(){if(!h){var t=s(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new v(t,e)),1!==c.length||h||s(y)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){function r(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var o=t.apply(e,n);function s(t){r(o,i,a,s,u,"next",t)}function u(t){r(o,i,a,s,u,"throw",t)}s(void 0)}))}}},,function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=n=function(t){return r(t)}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)},n(e)}t.exports=n},function(t,e){},,,function(t,e,r){var n,i,a;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */i=[],void 0===(a="function"==typeof(n=function(){"use strict";function t(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var r={},n={};function i(t,e){var i,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=n[t])?a:(i=o(t,(0|t)<0?-1:0,!0),s&&(n[t]=i),i):(s=-128<=(t|=0)&&t<128)&&(a=r[t])?a:(i=o(t,t<0?-1:0,!1),s&&(r[t]=i),i)}function a(t,e){if(isNaN(t)||!isFinite(t))return e?d:v;if(e){if(t<0)return d;if(t>=l)return b}else{if(t<=-f)return w;if(t+1>=f)return k}return t<0?a(-t,e).neg():o(t%h|0,t/h|0,e)}function o(e,r,n){return new t(e,r,n)}t.fromInt=i,t.fromNumber=a,t.fromBits=o;var s=Math.pow;function u(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return v;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(t.substring(1),e,r).neg();for(var i=a(s(r,8)),o=v,c=0;c<t.length;c+=8){var h=Math.min(8,t.length-c),l=parseInt(t.substring(c,c+h),r);if(h<8){var f=a(s(r,h));o=o.mul(f).add(a(l))}else o=(o=o.mul(i)).add(a(l))}return o.unsigned=e,o}function c(e){return e instanceof t?e:"number"==typeof e?a(e):"string"==typeof e?u(e):o(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=c;var h=4294967296,l=h*h,f=l/2,y=i(1<<24),v=i(0);t.ZERO=v;var d=i(0,!0);t.UZERO=d;var p=i(1);t.ONE=p;var m=i(1,!0);t.UONE=m;var g=i(-1);t.NEG_ONE=g;var k=o(-1,2147483647,!1);t.MAX_VALUE=k;var b=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var w=o(0,-2147483648,!1);t.MIN_VALUE=w;var E=t.prototype;return E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},E.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var e=a(t),r=this.div(e),n=r.mul(e).sub(this);return r.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=a(s(t,6),this.unsigned),o=this,u="";;){var c=o.div(i),h=(o.sub(c.mul(i)).toInt()>>>0).toString(t);if((o=c).isZero())return h+u;for(;h.length<6;)h="0"+h;u=""+h+u}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.lessThan=function(t){return this.comp(t)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return this.comp(t)<=0},E.lte=E.lessThanOrEqual,E.greaterThan=function(t){return this.comp(t)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return this.comp(t)>=0},E.gte=E.greaterThanOrEqual,E.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(p)},E.neg=E.negate,E.add=function(t){e(t)||(t=c(t));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,h=t.low>>>16,l=0,f=0,y=0,v=0;return y+=(v+=a+(65535&t.low))>>>16,f+=(y+=i+h)>>>16,l+=(f+=n+u)>>>16,l+=r+s,o((y&=65535)<<16|(v&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},E.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return v;if(e(t)||(t=c(t)),t.isZero())return v;if(this.eq(w))return t.isOdd()?w:v;if(t.eq(w))return this.isOdd()?w:v;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(y)&&t.lt(y))return a(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,u=t.high>>>16,h=65535&t.high,l=t.low>>>16,f=65535&t.low,d=0,p=0,m=0,g=0;return m+=(g+=s*f)>>>16,p+=(m+=i*f)>>>16,m&=65535,p+=(m+=s*l)>>>16,d+=(p+=n*f)>>>16,p&=65535,d+=(p+=i*l)>>>16,p&=65535,d+=(p+=s*h)>>>16,d+=r*f+n*l+i*h+s*u,o((m&=65535)<<16|(g&=65535),(d&=65535)<<16|(p&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?d:v;var r,n,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return d;if(t.gt(this.shru(1)))return m;i=d}else{if(this.eq(w))return t.eq(p)||t.eq(g)?w:t.eq(w)?p:(r=this.shr(1).div(t).shl(1)).eq(v)?t.isNegative()?p:g:(n=this.sub(t.mul(r)),i=r.add(n.div(t)));if(t.eq(w))return this.unsigned?d:v;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=v}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:s(2,o-48),h=a(r),l=h.mul(t);l.isNegative()||l.gt(n);)l=(h=a(r-=u,this.unsigned)).mul(t);h.isZero()&&(h=p),i=i.add(h),n=n.sub(l)}return i},E.div=E.divide,E.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.not=function(){return o(~this.low,~this.high,this.unsigned)},E.and=function(t){return e(t)||(t=c(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return e(t)||(t=c(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return e(t)||(t=c(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var r=this.high;return t<32?o(this.low>>>t|r<<32-t,r>>>t,this.unsigned):o(32===t?r:r>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?n.apply(e,i):n)||(t.exports=a)},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return a}));var n=r(2),i=r(29);function a(){return!("object"===(void 0===t?"undefined":Object(n.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(i.a)()}}).call(this,r(18))},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return i}));var n=r(2);function i(e){if("undefined"!=typeof window&&"object"===Object(n.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(n.a)(t.versions)&&Boolean(t.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(n.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||r;return!!(i&&i.indexOf("Electron")>=0)}}).call(this,r(18))},function(t,e,r){(function(e){const n=r(43),i=("undefined"==typeof window?e:window).deck||{};if(!i.LineLayer)throw new Error("@deck.gl/layers is not found");t.exports=Object.assign(i,n)}).call(this,r(21))},,,,,,function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,r){var n=r(4);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e,r){var n=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),o=new O(n||[]);return a._invoke=function(t,e,r){var n=h;return function(i,a){if(n===f)throw new Error("Generator is already running");if(n===y){if("throw"===i)throw a;return N()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var u=c(t,e,r);if("normal"===u.type){if(n=r.done?y:l,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=y,r.method="throw",r.arg=u.arg)}}}(t,r,o),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h="suspendedStart",l="suspendedYield",f="executing",y="completed",v={};function d(){}function p(){}function m(){}var g={};g[a]=function(){return this};var k=Object.getPrototypeOf,b=k&&k(k(M([])));b&&b!==r&&n.call(b,a)&&(g=b);var w=m.prototype=d.prototype=Object.create(g);function E(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function _(t){var e;this._invoke=function(r,i){function a(){return new Promise((function(e,a){!function e(r,i,a,o){var s=c(t[r],t,i);if("throw"!==s.type){var u=s.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?Promise.resolve(h.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(r,i,e,a)}))}return e=e?e.then(a,a):a()}}function T(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=c(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function M(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}return{next:N}}function N(){return{value:e,done:!0}}return p.prototype=w.constructor=m,m.constructor=p,m[s]=p.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},E(_.prototype),_.prototype[o]=function(){return this},t.AsyncIterator=_,t.async=function(e,r,n,i){var a=new _(u(e,r,n,i));return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(w),w[s]="Generator",w[a]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=M,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:M(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"dirname",(function(){return Tn}));var i=r(5),a=r.n(i),o=r(6),s=r.n(o),u=r(8),c=r.n(u),h=r(4),l=r.n(h),f=r(15),y=r.n(f),v=r(9),d=r.n(v),p=r(1),m=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"getShaders",value:function(){return Object.assign({},y()(l()(e.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME great-circle-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  if(abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n\nvoid main(void) {\n  geometry.worldPosition = vec3(instancePositions.xy, 0.0);\n  geometry.worldPositionAlt = vec3(instancePositions.zw, 0.0);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  \n  vec2 source = radians(instancePositions.xy);\n  vec2 target = radians(instancePositions.zw);\n  \n  float angularDist = getAngularDist(source, target);\n\n  vec3 currPos = vec3(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0);\n  vec3 nextPos = vec3(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0);\n\n  vec2 currPos64Low = mix(instancePositions64xyLow.xy, instancePositions64xyLow.zw, segmentRatio);\n  vec2 nextPos64Low = mix(instancePositions64xyLow.xy, instancePositions64xyLow.zw, nextSegmentRatio);\n\n  vec4 curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n  vec4 next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n  picking_setPickingColor(instancePickingColors);\n}\n",modules:["picking","project32"]})}}]),e}(p.ArcLayer);m.layerName="GreatCircleLayer";var g=r(11),k=r.n(g),b=r(16),w=r(26),E=r.n(w);var _=180/Math.PI,T=100;function S(t){if("string"==typeof t){if(t.indexOf("/")>0)return t;t=function(t){var e=t.padEnd(16,"0");return E.a.fromString(e,16)}(t)}return b.S2.S2Cell.toHilbertQuadkey(t.toString())}function x(t){var e=S(t);return function(t){for(var e,r,n,i,a,o,s=t.face,u=t.ij,c=t.level,h=[],l=[[0,0],[0,1],[1,1],[1,0],[0,0]],f=Math.max(1,T*Math.pow(2,-c)),y=0;y<4;y++)for(var v=l[y].slice(0),d=l[y+1],p=(d[0]-v[0])/f,m=(d[1]-v[1])/f,g=0;g<f;g++){v[0]+=p,v[1]+=m;var w=b.S2.IJToST(u,c,v),E=b.S2.STToUV(w),S=b.S2.FaceUVToXYZ(s,E);h.push((e=S,r=void 0,n=void 0,i=void 0,a=void 0,o=void 0,r=k()(e,3),n=r[0],i=r[1],a=r[2],o=Math.atan2(a,Math.sqrt(n*n+i*i)),[Math.atan2(i,n)*_,o*_]))}return h}(b.S2.S2Cell.FromHilbertQuadKey(e))}var O=Object.assign({getS2Token:{type:"accessor",value:function(t){return t.token}}},p.PolygonLayer.defaultProps),M=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"renderLayers",value:function(){var t=this.props,e=t.data,r=t.getS2Token,n=this.props,i=n.elevationScale,a=n.extruded,o=n.wireframe,s=n.filled,u=n.stroked,c=n.lineWidthUnits,h=n.lineWidthScale,l=n.lineWidthMinPixels,f=n.lineWidthMaxPixels,y=n.lineJointRounded,v=n.lineMiterLimit,d=n.lineDashJustified,m=n.getElevation,g=n.getFillColor,k=n.getLineColor,b=n.getLineWidth,w=n.getLineDashArray,E=this.props,_=E.updateTriggers,T=E.material;return new(this.getSubLayerClass("cell",p.PolygonLayer))({filled:s,wireframe:o,extruded:a,elevationScale:i,stroked:u,lineWidthUnits:c,lineWidthScale:h,lineWidthMinPixels:l,lineWidthMaxPixels:f,lineJointRounded:y,lineMiterLimit:v,lineDashJustified:d,material:T,getElevation:m,getFillColor:g,getLineColor:k,getLineWidth:b,getLineDashArray:w},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:_.getElevation,getFillColor:_.getFillColor,getLineColor:_.getLineColor,getLineWidth:_.getLineWidth,getLineDashArray:_.getLineDashArray}}),{data:e,getPolygon:function(t,e){return x(r(t,e))}})}}]),e}(p.CompositeLayer);function N(t,e,r){var n=t/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,r);return[n,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}M.layerName="S2Layer",M.defaultProps=O;var L=function(){function t(e){var r=e.getTileData,n=e.x,i=e.y,o=e.z,s=e.onTileLoad,u=e.onTileError;a()(this,t),this.x=n,this.y=i,this.z=o,this.bbox=function(t,e,r){var n=N(t,e,r),i=k()(n,2),a=i[0],o=i[1],s=N(t+1,e+1,r),u=k()(s,2);return{west:a,north:o,east:u[0],south:u[1]}}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=r,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileLoad=s,this.onTileError=u}return s()(t,[{key:"_loadData",value:function(){var t=this,e=this.x,r=this.y,n=this.z,i=this.bbox;return this.getTileData?Promise.resolve(this.getTileData({x:e,y:r,z:n,bbox:i})).then((function(e){return t._data=e,t._isLoaded=!0,t.onTileLoad(t),e})).catch((function(e){t._isLoaded=!0,t.onTileError(e)})):null}},{key:"isOverlapped",value:function(t){var e=this.x,r=this.y,n=this.z,i=Math.pow(2,t.z-n);return Math.floor(t.x/i)===e&&Math.floor(t.y/i)===r}},{key:"data",get:function(){return this._data||this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),t}();function I(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var P=1e-6,A="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function C(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function R(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function D(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function z(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}function j(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],c=r[3],h=c*n+s*a-u*i,l=c*i+u*n-o*a,f=c*a+o*i-s*n,y=-o*n-s*i-u*a;return t[0]=h*c+y*-o+l*-u-f*-s,t[1]=l*c+y*-s+f*-o-h*-u,t[2]=f*c+y*-u+h*-s-l*-o,t[3]=e[3],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var q,U;q=new A(4),A!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0,q[3]=0),U=q;function F(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function B(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],y=e[11],v=e[12],d=e[13],p=e[14],m=e[15],g=r*s-n*o,k=r*u-i*o,b=r*c-a*o,w=n*u-i*s,E=n*c-a*s,_=i*c-a*u,T=h*d-l*v,S=h*p-f*v,x=h*m-y*v,O=l*p-f*d,M=l*m-y*d,N=f*m-y*p,L=g*N-k*M+b*O+w*x-E*S+_*T;return L?(L=1/L,t[0]=(s*N-u*M+c*O)*L,t[1]=(i*M-n*N-a*O)*L,t[2]=(d*_-p*E+m*w)*L,t[3]=(f*E-l*_-y*w)*L,t[4]=(u*x-o*N-c*S)*L,t[5]=(r*N-i*x+a*S)*L,t[6]=(p*b-v*_-m*k)*L,t[7]=(h*_-f*b+y*k)*L,t[8]=(o*M-s*x+c*T)*L,t[9]=(n*x-r*M-a*T)*L,t[10]=(v*E-d*b+m*g)*L,t[11]=(l*b-h*E-y*g)*L,t[12]=(s*S-o*O-u*T)*L,t[13]=(r*O-n*S+i*T)*L,t[14]=(d*k-v*w-p*g)*L,t[15]=(h*w-l*k+f*g)*L,t):null}function V(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],y=t[12],v=t[13],d=t[14],p=t[15];return(e*o-r*a)*(l*p-f*d)-(e*s-n*a)*(h*p-f*v)+(e*u-i*a)*(h*d-l*v)+(r*s-n*o)*(c*p-f*y)-(r*u-i*o)*(c*d-l*y)+(n*u-i*s)*(c*v-h*y)}function G(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],y=e[10],v=e[11],d=e[12],p=e[13],m=e[14],g=e[15],k=r[0],b=r[1],w=r[2],E=r[3];return t[0]=k*n+b*s+w*l+E*d,t[1]=k*i+b*u+w*f+E*p,t[2]=k*a+b*c+w*y+E*m,t[3]=k*o+b*h+w*v+E*g,k=r[4],b=r[5],w=r[6],E=r[7],t[4]=k*n+b*s+w*l+E*d,t[5]=k*i+b*u+w*f+E*p,t[6]=k*a+b*c+w*y+E*m,t[7]=k*o+b*h+w*v+E*g,k=r[8],b=r[9],w=r[10],E=r[11],t[8]=k*n+b*s+w*l+E*d,t[9]=k*i+b*u+w*f+E*p,t[10]=k*a+b*c+w*y+E*m,t[11]=k*o+b*h+w*v+E*g,k=r[12],b=r[13],w=r[14],E=r[15],t[12]=k*n+b*s+w*l+E*d,t[13]=k*i+b*u+w*f+E*p,t[14]=k*a+b*c+w*y+E*m,t[15]=k*o+b*h+w*v+E*g,t}function W(t,e,r){var n,i,a,o,s,u,c,h,l,f,y,v,d=r[0],p=r[1],m=r[2];return e===t?(t[12]=e[0]*d+e[4]*p+e[8]*m+e[12],t[13]=e[1]*d+e[5]*p+e[9]*m+e[13],t[14]=e[2]*d+e[6]*p+e[10]*m+e[14],t[15]=e[3]*d+e[7]*p+e[11]*m+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],y=e[10],v=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=y,t[11]=v,t[12]=n*d+s*p+l*m+e[12],t[13]=i*d+u*p+f*m+e[13],t[14]=a*d+c*p+y*m+e[14],t[15]=o*d+h*p+v*m+e[15]),t}function H(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Z(t,e,r,n){var i,a,o,s,u,c,h,l,f,y,v,d,p,m,g,k,b,w,E,_,T,S,x,O,M=n[0],N=n[1],L=n[2],I=Math.hypot(M,N,L);return I<P?null:(M*=I=1/I,N*=I,L*=I,i=Math.sin(r),o=1-(a=Math.cos(r)),s=e[0],u=e[1],c=e[2],h=e[3],l=e[4],f=e[5],y=e[6],v=e[7],d=e[8],p=e[9],m=e[10],g=e[11],k=M*M*o+a,b=N*M*o+L*i,w=L*M*o-N*i,E=M*N*o-L*i,_=N*N*o+a,T=L*N*o+M*i,S=M*L*o+N*i,x=N*L*o-M*i,O=L*L*o+a,t[0]=s*k+l*b+d*w,t[1]=u*k+f*b+p*w,t[2]=c*k+y*b+m*w,t[3]=h*k+v*b+g*w,t[4]=s*E+l*_+d*T,t[5]=u*E+f*_+p*T,t[6]=c*E+y*_+m*T,t[7]=h*E+v*_+g*T,t[8]=s*S+l*x+d*O,t[9]=u*S+f*x+p*O,t[10]=c*S+y*x+m*O,t[11]=h*S+v*x+g*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Y(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*n,t[5]=o*i+h*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=c*i-a*n,t[9]=h*i-o*n,t[10]=l*i-s*n,t[11]=f*i-u*n,t}function K(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*n,t[1]=o*i-h*n,t[2]=s*i-l*n,t[3]=u*i-f*n,t[8]=a*n+c*i,t[9]=o*n+h*i,t[10]=s*n+l*i,t[11]=u*n+f*i,t}function Q(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*n,t[1]=o*i+h*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=c*i-a*n,t[5]=h*i-o*n,t[6]=l*i-s*n,t[7]=f*i-u*n,t}function X(t,e){var r=e[0],n=e[1],i=e[2],a=e[4],o=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,c,h),t}function J(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,y=i*s,v=i*u,d=a*o,p=a*s,m=a*u;return t[0]=1-l-v,t[1]=h+m,t[2]=f-p,t[3]=0,t[4]=h-m,t[5]=1-c-v,t[6]=y+d,t[7]=0,t[8]=f+p,t[9]=y-d,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),c=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0,t}function tt(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function et(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*c,t[15]=1,t}function rt(t,e,r,n){var i,a,o,s,u,c,h,l,f,y,v=e[0],d=e[1],p=e[2],m=n[0],g=n[1],k=n[2],b=r[0],w=r[1],E=r[2];return Math.abs(v-b)<P&&Math.abs(d-w)<P&&Math.abs(p-E)<P?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=v-b,l=d-w,f=p-E,i=g*(f*=y=1/Math.hypot(h,l,f))-k*(l*=y),a=k*(h*=y)-m*f,o=m*l-g*h,(y=Math.hypot(i,a,o))?(i*=y=1/y,a*=y,o*=y):(i=0,a=0,o=0),s=l*o-f*a,u=f*i-h*o,c=h*a-l*i,(y=Math.hypot(s,u,c))?(s*=y=1/y,u*=y,c*=y):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*v+a*d+o*p),t[13]=-(s*v+u*d+c*p),t[14]=-(h*v+l*d+f*p),t[15]=1,t)}function nt(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function it(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}!function(){var t=function(){var t=new A(2);return A!=Float32Array&&(t[0]=0,t[1]=0),t}()}();function at(){var t=new A(3);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ot(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function st(t,e,r){var n=new A(3);return n[0]=t,n[1]=e,n[2]=r,n}function ut(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ct(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ht(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function lt(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t}function ft(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}function yt(t,e,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],c=e[2],h=i*c-a*u,l=a*s-n*c,f=n*u-i*s,y=i*f-a*l,v=a*h-n*f,d=n*l-i*h,p=2*o;return h*=p,l*=p,f*=p,y*=2,v*=2,d*=2,t[0]=s+h+y,t[1]=u+l+v,t[2]=c+f+d,t}function vt(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function dt(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function pt(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function mt(t,e){var r=st(t[0],t[1],t[2]),n=st(e[0],e[1],e[2]);ut(r,r),ut(n,n);var i=ct(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var gt=ot;!function(){var t=at()}();function kt(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var bt=Math.PI,wt=bt/4,Et=bt/180,_t=512;function Tt(t,e){var r=I(t,2),n=r[0],i=r[1];kt(Number.isFinite(n)&&Number.isFinite(e)),kt(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var a=i*Et;return[(e*=_t)*(n*Et+bt)/(2*bt),e*(bt-Math.log(Math.tan(wt+.5*a)))/(2*bt)]}var St=512;function xt(t){return t/St}function Ot(t,e){var r=t.x,n=t.y,i=t.z,a=Math.pow(2,i-e);return{x:Math.floor(r/a),y:Math.floor(n/a),z:e}}var Mt=function(){function t(e){var r=e.getTileData,n=e.maxSize,i=e.maxZoom,o=e.minZoom,s=e.onTileLoad,u=e.onTileError;a()(this,t),this._getTileData=r,this._maxSize=n,this.onTileError=u,this.onTileLoad=s,this._cache=new Map,this._tiles=[],Number.isFinite(i)&&(this._maxZoom=Math.floor(i)),Number.isFinite(o)&&(this._minZoom=Math.ceil(o))}return s()(t,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(t){var e=this._cache,r=this._getTileData,n=this._maxSize,i=this._maxZoom,a=this._minZoom;this._markOldTiles();var o=function(t,e,r){var n=Math.floor(t.zoom);if(r&&n<r)return[];var i=function(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[e.reduce((function(t,e){return t<e[0]?t:e[0]}),180),e.reduce((function(t,e){return t<e[1]?t:e[1]}),90),e.reduce((function(t,e){return t>e[0]?t:e[0]}),-180),e.reduce((function(t,e){return t>e[1]?t:e[1]}),-90)]}(t=new t.constructor(Object.assign({},t,{zoom:n}))),a=Tt([i[0],i[3]],t.scale).map(xt),o=k()(a,2),s=o[0],u=o[1],c=Tt([i[2],i[1]],t.scale).map(xt),h=k()(c,2),l=h[0],f=h[1];s=Math.max(0,Math.floor(s)),l=Math.min(t.scale,Math.ceil(l)),u=Math.max(0,Math.floor(u)),f=Math.min(t.scale,Math.ceil(f));for(var y=[],v=s;v<l;v++)for(var d=u;d<f;d++)e&&n>e?y.push(Ot({x:v,y:d,z:n},e)):y.push({x:v,y:d,z:n});return y}(t,i,a);if(o&&0!==o.length){e.forEach((function(t){o.some((function(e){return t.isOverlapped(e)}))&&(t.isVisible=!0)}));for(var s=!1,u=0;u<o.length;u++){var c=o[u],h=c.x,l=c.y,f=c.z,y=this._getTile(h,l,f);y||((y=new L({getTileData:r,x:h,y:l,z:f,onTileLoad:this.onTileLoad,onTileError:this.onTileError})).isVisible=!0,s=!0);var v=this._getTileId(h,l,f);e.set(v,y)}if(s){this._resizeCache(n||5*o.length),this._tiles=Array.from(this._cache.values()).sort((function(t,e){return t.z-e.z}))}}}},{key:"_resizeCache",value:function(t){var e=this._cache;if(e.size>t){var r=e[Symbol.iterator](),n=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(e.size<=t)break;var c=u[0];u[1].isVisible||e.delete(c)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach((function(t){t.isVisible=!1}))}},{key:"_getTile",value:function(t,e,r){var n=this._getTileId(t,e,r);return this._cache.get(n)}},{key:"_getTileId",value:function(t,e,r){return"".concat(r,"-").concat(t,"-").concat(e)}},{key:"tiles",get:function(){return this._tiles}}]),t}(),Nt={renderSubLayers:{type:"function",value:function(t){return new p.GeoJsonLayer(t)}},getTileData:{type:"function",value:function(t){t.x,t.y,t.z;return Promise.resolve(null)}},onViewportLoaded:{type:"function",optional:!0,value:null},onTileError:{type:"function",value:function(t){return console.error(t)}},maxZoom:null,minZoom:0,maxCacheSize:null},Lt=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.context),n=t.changeFlags,i=this.state.tileCache;if(!i||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getTileData)){var a=e.getTileData,o=e.maxZoom,s=e.minZoom,u=e.maxCacheSize;i&&i.finalize(),i=new Mt({getTileData:a,maxSize:u,maxZoom:o,minZoom:s,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileCache:i})}else n.updateTriggersChanged&&this.state.tileCache.tiles.forEach((function(t){t.layer=null}));var c=r.viewport;if(n.viewportChanged&&"DEFAULT-INITIAL-VIEWPORT"!==c.id){var h=this.getLayerZoomLevel();i.update(c);var l=i.tiles.filter((function(t){return t.z===h}));this.setState({isLoaded:!1,tiles:l}),this._onTileLoad()}}},{key:"_onTileLoad",value:function(){var t=this.props.onViewportLoaded,e=this.state.tiles,r=e.every((function(t){return t.isLoaded}));this.state.isLoaded!==r&&(this.setState({isLoaded:r}),r&&t&&t(e.filter((function(t){return t._data})).map((function(t){return t._data}))))}},{key:"_onTileError",value:function(t){this.props.onTileError(t),this._onTileLoad()}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer;return e.sourceLayer=r,e.tile=r.props.tile,e}},{key:"getLayerZoomLevel",value:function(){var t=Math.floor(this.context.viewport.zoom),e=this.props,r=e.maxZoom,n=e.minZoom;return Number.isFinite(r)&&t>r?Math.floor(r):Number.isFinite(n)&&t<n?Math.ceil(n):t}},{key:"renderLayers",value:function(){var t=this,e=this.props,r=e.renderSubLayers,n=e.visible,i=this.getLayerZoomLevel();return this.state.tileCache.tiles.map((function(e){var a=n&&e.isVisible&&(!t.state.isLoaded||e.z===i);return e.layer?e.layer.props.visible!==a&&(e.layer=e.layer.clone({visible:a})):e.layer=r(Object.assign({},t.props,{id:"".concat(t.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.data,visible:a,tile:e})),e.layer}))}}]),e}(p.CompositeLayer);Lt.layerName="TileLayer",Lt.defaultProps=Nt;var It=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"getShaders",value:function(){var t=y()(l()(e.prototype),"getShaders",this).call(this);return t.inject={"vs:#decl":"uniform float trailLength;\nuniform bool isPath3D;\nattribute vec2 instanceTimestamps;\nvarying float vTime;\n","vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);":"vec2 timestamps = instanceTimestamps;\nif (!isPath3D) {\n  prevPosition.z = 0.0;\n  currPosition.z = 0.0;\n  nextPosition.z = 0.0;\n  timestamps.x = instanceStartPositions.z;\n  timestamps.y = instanceEndPositions.z;\n}\n","vs:#main-end":"float shiftZ = sin(timestamps.x) * 1e-4;\ngl_Position.z += shiftZ;\nvTime = timestamps.x + (timestamps.y - timestamps.x) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"color.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}},{key:"initializeState",value:function(t){y()(l()(e.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({instanceTimestamps:{size:2,update:this.calculateInstanceTimestamps}})}},{key:"draw",value:function(t){var r=this.props,n=r.trailLength,i=r.currentTime,a=r.getTimestamps;t.uniforms=Object.assign({},t.uniforms,{trailLength:n,currentTime:i,isPath3D:Boolean(a)}),y()(l()(e.prototype),"draw",this).call(this,t)}},{key:"calculateInstanceTimestamps",value:function(t,e){var r=e.startRow,n=e.endRow,i=this.props,a=i.data,o=i.getTimestamps;if(!o)return t.constant=!0,void(t.value=new Float32Array(2));for(var s=this.state.pathTesselator,u=s.bufferLayout,c=s.instanceCount,h=new Float32Array(2*c),l=Object(p.createIterable)(a,r,n),f=l.iterable,y=l.objectInfo,v=0,d=0;d<r;d++)v+=2*u[d];var m=!0,g=!1,k=void 0;try{for(var b,w=f[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var E=b.value;y.index++;for(var _=u[y.index],T=o(E,y),S=0;S<_;S++)h[v++]=T[S],h[v++]=T[S+1]}}catch(t){g=!0,k=t}finally{try{m||null==w.return||w.return()}finally{if(g)throw k}}t.constant=!1,t.value=h}}]),e}(p.PathLayer);It.layerName="TripsLayer",It.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}};var Pt=r(12),At=Object.assign({getHexagons:{type:"accessor",value:function(t){return t.hexagons}}},p.PolygonLayer.defaultProps),Ct=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.changeFlags);if(r.dataChanged||r.updateTriggers&&r.updateTriggers.getHexagons){var n=e.data,i=e.getHexagons,a=[],o=Object(p.createIterable)(n),s=o.iterable,u=o.objectInfo,c=!0,h=!1,l=void 0;try{for(var f,y=s[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){var v=f.value;u.index++;var d=i(v,u),m=Object(Pt.h3SetToMultiPolygon)(d,!0),g=!0,k=!1,b=void 0;try{for(var w,E=m[Symbol.iterator]();!(g=(w=E.next()).done);g=!0){var _=w.value;a.push(this.getSubLayerRow({polygon:_},v,u.index))}}catch(t){k=!0,b=t}finally{try{g||null==E.return||E.return()}finally{if(k)throw b}}}}catch(t){h=!0,l=t}finally{try{c||null==y.return||y.return()}finally{if(h)throw l}}this.setState({polygons:a})}}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,r=t.extruded,n=t.wireframe,i=t.filled,a=t.stroked,o=t.lineWidthScale,s=t.lineWidthMinPixels,u=t.lineWidthMaxPixels,c=t.lineJointRounded,h=t.lineMiterLimit,l=t.lineDashJustified,f=t.material,y=t.getFillColor,v=t.getLineColor,d=t.getLineWidth,m=t.getLineDashArray,g=t.getElevation,k=t.updateTriggers;return new(this.getSubLayerClass("cluster-region",p.PolygonLayer))({filled:i,wireframe:n,extruded:r,elevationScale:e,stroked:a,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:c,lineMiterLimit:h,lineDashJustified:l,material:f,getFillColor:this.getSubLayerAccessor(y),getLineColor:this.getSubLayerAccessor(v),getLineWidth:this.getSubLayerAccessor(d),getLineDashArray:this.getSubLayerAccessor(m),getElevation:this.getSubLayerAccessor(g)},this.getSubLayerProps({id:"cluster-region",updateTriggers:k}),{data:this.state.polygons,getPolygon:function(t){return t.polygon}})}}]),e}(p.CompositeLayer);Ct.defaultProps=At,Ct.layerName="H3ClusterLayer";var Rt=r(22),Dt=r.n(Rt),zt=r(2);function jt(t,e){return(jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qt(t,e,r){return(qt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&jt(i,r.prototype),i}).apply(null,arguments)}function Ut(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ft(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}var Bt=1/Math.PI*180,Vt=1/180*Math.PI,Gt={};function Wt(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?Gt.precision||4:e;return t=function(t){return Math.round(t/Gt.EPSILON)*Gt.EPSILON}(t),"".concat(parseFloat(t.toPrecision(r)))}function Ht(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function Zt(t,e,r){if(Ht(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function Yt(t){return function(t,e){return Zt(t,(function(t){return t*Vt}),e)}(t)}function Kt(t){return function(t,e){return Zt(t,(function(t){return t*Bt}),e)}(t)}function Qt(t,e,r){return Ht(t)?t.map((function(t,n){return Qt(t,e[n],r)})):r*e+(1-r)*t}function Xt(t,e,r){var n=Gt.EPSILON;r&&(Gt.EPSILON=r);try{if(t===e)return!0;if(Ht(t)&&Ht(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Xt(t[i],e[i]))return!1;return!0}return t&&"object"===Object(zt.a)(t)&&t.equals?t.equals(e):e&&"object"===Object(zt.a)(e)&&e.equals?e.equals(t):Math.abs(t-e)<=Gt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Gt.EPSILON=n}}Gt.EPSILON=1e-12,Gt.debug=!1,Gt.precision=4,Gt.printTypes=!1,Gt.printDegrees=!1,Gt.printRowMajor=!0;function Jt(t,e){e=void 0===e?t[0][0]:e;var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=s[0]-e;u>180?s[0]-=360:u<-180&&(s[0]+=360)}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}function $t(t,e,r){var n=t(e,r),i=Object(Pt.h3ToGeo)(n),a=k()(i,2),o=a[0];return[a[1],o]}function te(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=Object(Pt.h3ToGeoBoundary)(t,!0);return 1!==e?function(t,e,r){var n=Object(Pt.h3ToGeo)(t),i=k()(n,2),a=i[0],o=i[1],s=e.length;Jt(e,o);for(var u=e[0]===e[s-1]?s-1:s,c=0;c<u;c++)e[c][0]=Qt(o,e[c][0],r),e[c][1]=Qt(a,e[c][1],r)}(t,r,e):Jt(r),r}var ee=Object.assign({},p.PolygonLayer.defaultProps,{highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},getHexagon:{type:"accessor",value:function(t){return t.hexagon}},extruded:!0,getColor:null});delete ee.getLineDashArray;var re=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}return d()(e,t),s()(e,[{key:"shouldUpdateState",value:function(t){var e=t.changeFlags;return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.changeFlags);if(r.dataChanged||r.updateTriggers&&r.updateTriggers.getHexagon){var n=-1,i=!1,a=Object(p.createIterable)(e.data),o=a.iterable,s=a.objectInfo,u=!0,c=!1,h=void 0;try{for(var l,f=o[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var y=l.value;s.index++;var v=e.getHexagon(y,s);if(n=n<0?Object(Pt.h3GetResolution)(v):n,Object(Pt.h3IsPentagon)(v)){i=!0;break}}}catch(t){c=!0,h=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}this.setState({resolution:n,edgeLengthKM:n>=0?Object(Pt.edgeLength)(n,Pt.UNITS.km):0,hasPentagon:i})}this._updateVertices(this.context.viewport)}},{key:"_shouldUseHighPrecision",value:function(){var t=this.state,e=t.resolution,r=t.hasPentagon;return this.props.highPrecision||r||e>=0&&e<=5}},{key:"_updateVertices",value:function(t){if(!this._shouldUseHighPrecision()){var e=this.state,r=e.resolution,n=e.edgeLengthKM,i=e.centerHex;if(!(r<0)){var a=Object(Pt.geoToH3)(t.latitude,t.longitude,r);if(!(i===a||i&&Object(Pt.h3Distance)(i,a)*n<10)){var o=t.distanceScales.pixelsPerMeter,s=te(a),u=Object(Pt.h3ToGeo)(a),c=k()(u,2),h=c[0],l=c[1],f=t.projectFlat([l,h]),y=k()(f,2),v=y[0],d=y[1];s=s.map((function(e){var r=t.projectFlat(e);return r[0]=(r[0]-v)/o[0],r[1]=(r[1]-d)/o[1],r})),this.setState({centerHex:a,vertices:s})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var t=this.props,e=t.elevationScale,r=t.material,n=t.coverage,i=t.extruded,a=t.wireframe,o=t.stroked,s=t.filled,u=t.lineWidthUnits,c=t.lineWidthScale,h=t.lineWidthMinPixels,l=t.lineWidthMaxPixels,f=t.getColor,y=t.getFillColor,v=t.getElevation,d=t.getLineColor,p=t.getLineWidth,m=t.updateTriggers;return{elevationScale:e,extruded:i,coverage:n,wireframe:a,stroked:o,filled:s,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:l,material:r,getElevation:v,getFillColor:f||y,getLineColor:d,getLineWidth:p,updateTriggers:{getFillColor:m.getColor||m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var t=this.props,e=t.data,r=t.getHexagon,n=t.updateTriggers,i=t.coverage,a=this.getSubLayerClass("hexagon-cell-hifi",p.PolygonLayer),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(t,e){return null==t?e:"object"===Dt()(t)?Object.assign({},t,{coverage:e}):{getHexagon:t,coverage:e}}(n.getHexagon,i),new a(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,getPolygon:function(t,e){return te(r(t,e),i)}})}},{key:"_renderColumnLayer",value:function(){var t=this.props,e=t.data,r=t.getHexagon,n=t.updateTriggers,i=this.getSubLayerClass("hexagon-cell",p.ColumnLayer),a=this._getForwardProps();return a.updateTriggers.getPosition=n.getHexagon,new i(a,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:a.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:$t.bind(null,r)})}}]),e}(p.CompositeLayer);re.defaultProps=ee,re.layerName="H3HexagonLayer";var ne=r(27),ie=r.n(ne),ae=r(0),oe=r.n(ae),se=r(19),ue=r.n(se);function ce(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function he(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ce(a,n,i,o,s,"next",t)}function s(t){ce(a,n,i,o,s,"throw",t)}o(void 0)}))}}function le(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ve(t,e,r){return e&&ye(t.prototype,e),r&&ye(t,r),t}function de(t,e){return!e||"object"!==Object(zt.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function pe(t){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function me(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}function ge(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}var ke=1/Math.PI*180,be=1/180*Math.PI,we={};function Ee(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?we.precision||4:e;return t=function(t){return Math.round(t/we.EPSILON)*we.EPSILON}(t),"".concat(parseFloat(t.toPrecision(r)))}function _e(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function Te(t,e,r){if(_e(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function Se(t){return function(t,e){return Te(t,(function(t){return t*be}),e)}(t)}function xe(t){return Oe(t)}function Oe(t,e){return Te(t,(function(t){return t*ke}),e)}function Me(t,e,r){var n=we.EPSILON;r&&(we.EPSILON=r);try{if(t===e)return!0;if(_e(t)&&_e(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Me(t[i],e[i]))return!1;return!0}return t&&"object"===Object(zt.a)(t)&&t.equals?t.equals(e):e&&"object"===Object(zt.a)(e)&&e.equals?e.equals(t):Math.abs(t-e)<=we.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{we.EPSILON=n}}function Ne(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Le(t,e,r){if(we.debug&&!function(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|r," some fields set to invalid numbers'"));return t}we.EPSILON=1e-12,we.debug=!1,we.precision=4,we.printTypes=!1,we.printDegrees=!1,we.printRowMajor=!0;var Ie={};function Pe(t,e){Ie[t]||(Ie[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}function Ae(t){var e="function"==typeof Map?new Map:void 0;return(Ae=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return qt(t,arguments,pe(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),jt(n,t)})(t)}var Ce=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:_e(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(we)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Ee(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Me(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(we.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(Ae(Array)),Re=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"toString",value:function(){var t="[";if(we.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=Ne(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),e}(Ce);function De(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}function ze(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*a,t[1]=r[1]*n+r[4]*i+r[7]*a,t[2]=r[2]*n+r[5]*i+r[8]*a,t[3]=e[3],t}var je=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),qe=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Ue=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Fe={},Be=function(t){function e(t){var r;return fe(this,e),r=de(this,pe(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return me(e,t),ve(e,[{key:"INDICES",get:function(){return Ue}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return Fe.IDENTITY=Fe.IDENTITY||Object.freeze(new e(je)),Fe.IDENTITY}},{key:"ZERO",get:function(){return Fe.ZERO=Fe.ZERO||Object.freeze(new e(qe)),Fe.ZERO}}]),ve(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,y,v,d){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=y,this[14]=v,this[15]=d,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,y,v,d){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=c,this[7]=y,this[8]=r,this[9]=o,this[10]=h,this[11]=v,this[12]=n,this[13]=s,this[14]=l,this[15]=d,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(je)}},{key:"fromQuaternion",value:function(t){return J(this,t),this.check()}},{key:"frustum",value:function(t){var r=t.left,n=t.right,i=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?e._computeInfinitePerspectiveOffCenter(this,r,n,i,a,o):$(this,r,n,i,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return rt(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,a=t.near,o=void 0===a?.1:a,s=t.far;return et(this,e,r,n,i,o,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.focalDistance,s=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,y=s*Math.tan(f),v=y*a;return(new e).ortho({left:-v,right:v,bottom:-y,top:y,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.near,s=void 0===o?.1:o,u=t.far,c=void 0===u?500:u;if((e=e||n)>2*Math.PI)throw Error("radians");return tt(this,e,a,s,c),this.check()}},{key:"determinant",value:function(){return V(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*a,t}},{key:"transpose",value:function(){return F(this,this),this.check()}},{key:"invert",value:function(){return B(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return G(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return G(this,this,t),this.check()}},{key:"rotateX",value:function(t){return Y(this,this,t),this.check()}},{key:"rotateY",value:function(t){return K(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return Q(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=I(t,3),r=e[0],n=e[1],i=e[2];return this.rotateX(r).rotateY(n).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return Z(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?H(this,this,t):H(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return W(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(Le(e=z(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=it(e||[-0,-0],t,this);break;case 3:e=lt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}(e||[-0,-0],t,this);break;case 3:e=De(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return Pe("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Pe("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Pe("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,a){var o=2*a/(r-e),s=2*a/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),e}(Re),Ve=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Ne(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Ne(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return ge(t>=0&&t<this.ELEMENTS,"index is out of range"),Ne(this[t])}},{key:"setComponent",value:function(t,e){return ge(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Ne(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Ne(t)}}]),e}(Ce),Ge=[0,0,0],We=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0)),1===arguments.length&&_e(r)?t.copy(r):(we.debug&&(Ne(r),Ne(n),Ne(i)),t[0]=r,t[1]=n,t[2]=i),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return we.debug&&(Ne(t.x),Ne(t.y),Ne(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return mt(this,t)}},{key:"cross",value:function(t){return ht(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return vt(this,this,void 0===r?Ge:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return dt(this,this,void 0===r?Ge:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return pt(this,this,void 0===r?Ge:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return lt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return De(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return ft(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return yt(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ne(t)}}]),e}(Ve),He={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI},Ze=(Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Ye=new We;function Ke(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ze;return _e(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function Qe(t){return Ke(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ye,we.cartographicRadians?Ze:Se)}function Xe(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ze;return _e(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}function Je(t,e){return Xe(t,e,we.cartographicRadians?Ze:xe)}var $e=new We,tr=new We,er=new We;var rr=1e-14,nr=new We,ir={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},ar={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},or={east:new We,north:new We,up:new We,west:new We,south:new We,down:new We},sr=new We,ur=new We,cr=new We;function hr(t,e,r,n,i,a){var o,s,u,c=ir[e]&&ir[e][r];ge(c&&(!n||n===c));var h=nr.copy(i);if(Me(h.x,0,rr)&&Me(h.y,0,rr)){var l=Math.sign(h.z);o=sr.fromArray(ar[e]),"east"!==e&&"west"!==e&&o.scale(l),s=ur.fromArray(ar[r]),"east"!==r&&"west"!==r&&s.scale(l),u=cr.fromArray(ar[n]),"east"!==n&&"west"!==n&&u.scale(l)}else{var f=or.up,y=or.east,v=or.north;y.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),v.copy(f).cross(y);var d=or.down,p=or.west,m=or.south;d.copy(f).scale(-1),p.copy(y).scale(-1),m.copy(v).scale(-1),o=or[e],s=or[r],u=or[n]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=s.x,a[5]=s.y,a[6]=s.z,a[7]=0,a[8]=u.x,a[9]=u.y,a[10]=u.z,a[11]=0,a[12]=h.x,a[13]=h.y,a[14]=h.z,a[15]=1,a}var lr,fr=new We,yr=new We,vr=new We,dr=new We,pr=new We,mr=new We,gr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;fe(this,t),ge(e>=0),ge(r>=0),ge(n>=0),this.radii=new We(e,r,n),this.radiiSquared=new We(e*e,r*r,n*n),this.radiiToTheFourth=new We(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new We(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new We(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=He.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return ve(t,null,[{key:"WGS84",get:function(){return lr=lr||new t(6378137,6378137,6356752.314245179)}}]),ve(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=yr,n=vr,i=I(t,3),a=i[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var o=Math.sqrt(r.dot(n));return n.scale(1/o),r.scale(a),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];mr.from(t);var r=this.scaleToGeodeticSurface(mr,dr);if(r){var n=this.geodeticSurfaceNormal(r,yr),i=pr;i.copy(mr).subtract(r);var a=Math.atan2(n.y,n.x),o=Math.asin(n.z),s=Math.sign(ct(i,mr))*ot(i);return Je([a,o,s],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Be;return hr(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Be;return hr(this,t,e,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return fr.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Qe(t),n=r[0],i=r[1],a=Math.cos(i);return fr.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),fr.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return fr.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new We,n=e.oneOverRadii,i=e.oneOverRadiiSquared,a=e.centerToleranceSquared;$e.from(t);var o=t.x,s=t.y,u=t.z,c=n.x,h=n.y,l=n.z,f=o*o*c*c,y=s*s*h*h,v=u*u*l*l,d=f+y+v,p=Math.sqrt(1/d);if(Number.isFinite(p)){var m=tr;if(m.copy(t).scale(p),d<a)return m.to(r);var g=i.x,k=i.y,b=i.z,w=er;w.set(m.x*g*2,m.y*k*2,m.z*b*2);var E,_,T,S,x=(1-p)*t.len()/(.5*w.len()),O=0;do{var M=(E=1/(1+(x-=O)*g))*E,N=(_=1/(1+x*k))*_,L=(T=1/(1+x*b))*T;O=(S=f*M+y*N+v*L-1)/(-2*(f*(M*E)*g+y*(N*_)*k+v*(L*T)*b))}while(Math.abs(S)>He.EPSILON12);return $e.scale([E,_,T]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];dr.from(t);var r=dr.x,n=dr.y,i=dr.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return dr.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return dr.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return dr.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];ge(Me(this.radii.x,this.radii.y,He.EPSILON15)),ge(this.radii.z>0),dr.from(t);var n=dr.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return dr.set(0,0,n).to(r)}}]),t}(),kr=r(28),br=Object(kr.a)(),wr=r(14);function Er(){var t;if(br&&wr.b.performance)t=wr.b.performance.now();else if(wr.a.hrtime){var e=wr.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var _r=function(){function t(e,r){fe(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return ve(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this._lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Er(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Er()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),Tr=function(){function t(e){var r=e.id,n=e.stats;fe(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return ve(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,r=t.type;return this.stats[e]||(this.stats[e]=t instanceof _r?t:new _r(e,r)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function Sr(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function xr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Or(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xr(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xr(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Mr(t){return!!t&&(Array.isArray(t)&&(t=t[0]),t.parseTextSync||t.parseSync||t.parse||t.loadAndParse||t.parseStream||t.parseInBatches||t.worker)}function Nr(t){var e;return Sr(Mr(t)),Array.isArray(t)&&(e=t[1],t=Or({},t=t[0],{options:Or({},t.options,{},e)})),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Sr(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}var Lr=function(){function t(){fe(this,t)}return ve(t,[{key:"log",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}}]),t}();function Ir(t,e){return null===(t=Object.assign({},e&&e.DEFAULT_OPTIONS,e&&e.defaultOptions,e&&e.options,t,{dataType:"arraybuffer"})).log&&(t.log=new Lr),"log"in t||(t.log=console),t}var Pr=function(t){return"undefined"!=typeof Response&&t instanceof Response||t.arrayBuffer&&t.text&&t.json},Ar=function(t){return function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)};function Cr(t){this.wrapped=t}function Rr(t){var e,r;function n(e,r){try{var a=t[e](r),o=a.value,s=o instanceof Cr;Promise.resolve(s?o.wrapped:o).then((function(t){s?n("next",t):i(a.done?"return":"normal",t)}),(function(t){n("throw",t)}))}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise((function(a,o){var s={key:t,arg:i,resolve:a,reject:o,next:null};r?r=r.next=s:(e=r=s,n(t,i))}))},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(Rr.prototype[Symbol.asyncIterator]=function(){return this}),Rr.prototype.next=function(t){return this._invoke("next",t)},Rr.prototype.throw=function(t){return this._invoke("throw",t)},Rr.prototype.return=function(t){return this._invoke("return",t)};var Dr=r(10);var zr=function(){function t(e){fe(this,t),this._fileOrBlob=e,this.bodyUsed=!1}var e,r,n;return ve(t,[{key:"url",value:function(){return this._fileOrBlob.name||""}},{key:"arrayBuffer",value:(n=he(oe.a.mark((function t(){var e,r,n;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),r=e.reader,n=e.promise,r.readAsArrayBuffer(this._fileOrBlob),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"text",value:(r=he(oe.a.mark((function t(){var e,r,n;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),r=e.reader,n=e.promise,r.readAsText(this._fileOrBlob),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"json",value:(e=he(oe.a.mark((function t(){var e;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.text();case 2:return e=t.sent,t.abrupt("return",JSON.parse(e));case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"_getFileReader",value:function(){var t;Sr(!this.bodyUsed),this.bodyUsed=!0;var e=new Promise((function(e,r){try{(t=new FileReader).onerror=function(t){return r(new Error(t))},t.onabort=function(){return r(new Error("Read aborted."))},t.onload=function(){return e(t.result)}}catch(t){r(t)}}));return{reader:t,promise:e}}},{key:"headers",get:function(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}},{key:"ok",get:function(){return!0}},{key:"status",get:function(){return 200}}]),t}();function jr(t,e){return Promise.resolve(new zr(t,e))}function qr(t){return Ur.apply(this,arguments)}function Ur(){return(Ur=he(oe.a.mark((function t(e){var r,n;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=12;break}return r="fetch failed ".concat(e.status," "),t.prev=2,t.next=5,e.text();case 5:n=t.sent,r+=n,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(2);case 11:throw new Error(r);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))).apply(this,arguments)}var Fr="Cannot convert supplied data type";function Br(t,e){return Pr(t)?e=e||t.url:Ar(e)&&(e=e.name),"string"==typeof e?e.replace(/\?.*/,""):e}function Vr(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var r=t.buffer||t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}throw new Error(Fr)}function Gr(t,e){return Wr.apply(this,arguments)}function Wr(){return(Wr=he(oe.a.mark((function t(e,r){var n;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:if(e=t.sent,n=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!n){t.next=6;break}return t.abrupt("return",Vr(e,r));case 6:if(!Ar(e)){t.next=10;break}return t.next=9,jr(e);case 9:e=t.sent;case 10:if(!Pr(e)){t.next=23;break}return t.next=13,qr(e);case 13:if(!r.binary){t.next=19;break}return t.next=16,e.arrayBuffer();case 16:t.t0=t.sent,t.next=22;break;case 19:return t.next=21,e.text();case 21:t.t0=t.sent;case 22:return t.abrupt("return",t.t0);case 23:throw new Error(Fr);case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Hr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Zr(t,e){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Hr(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Hr(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({fetch:"undefined"!=typeof window&&window.fetch},t)}var Yr=r(23);function Kr(t){if(Yr.toArrayBuffer&&(t=Object(Yr.toArrayBuffer)(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}return Sr(!1)}function Qr(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t){if(t instanceof ArrayBuffer)r.push(t);else if(t.buffer&&t.buffer instanceof ArrayBuffer)r.push(t.buffer);else if(e&&"object"===Object(zt.a)(t))for(var n in t)Qr(t[n],e,r)}else;return r}var Xr=new Map;var Jr=0;function $r(t){var e=t.data;(0,t.resolve)(e)}var tn=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"web-worker-".concat(Jr++):n,a=e.onMessage;fe(this,t);var o=function(t){if(Sr("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")"))return t.match(/^url\((.*)\)$/)[1];var e=Xr.get(t);if(!e){var r=new Blob([t],{type:"application/javascript"});e=URL.createObjectURL(r),Xr.set(t,e)}return e}(r);this.worker=new Worker(o,{name:i}),this.name=i,this.onMessage=a||$r}var e;return ve(t,[{key:"process",value:(e=he(oe.a.mark((function t(e){var r=this;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){r.worker.onmessage=function(e){return r.onMessage({worker:r.worker,data:e.data,resolve:t,reject:n})},r.worker.onerror=function(t){return n(t)};var i=Qr(e);r.worker.postMessage(e,i)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.worker.terminate(),this.worker=null}}]),t}(),en=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"unnamed":n,a=e.maxConcurrency,o=void 0===a?1:a,s=e.onMessage,u=e.onDebug,c=void 0===u?function(){}:u;fe(this,t),this.source=r,this.name=i,this.maxConcurrency=o,this.onMessage=s,this.onDebug=c,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}var e;return ve(t,[{key:"destroy",value:function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0}},{key:"process",value:(e=he(oe.a.mark((function t(e,r){var n=this;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,i){n.jobQueue.push({data:e,jobName:r,resolve:t,reject:i}),n._startQueuedJob()})));case 1:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})},{key:"_startQueuedJob",value:function(){var t=this;if(this.jobQueue.length){var e=this._getAvailableWorker();if(e){var r=this.jobQueue.shift();this.onDebug({message:"processing",worker:e.name,job:r.jobName,backlog:this.jobQueue.length}),e.process(r.data).then((function(t){return r.resolve(t)})).catch((function(t){return r.reject(t)})).then((function(){return t._onWorkerDone(e)}))}}}},{key:"_onWorkerDone",value:function(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var t="".concat(this.name.toLowerCase(),"-worker-").concat(this.count,"-of-").concat(this.maxConcurrency);return new tn({source:this.source,onMessage:this.onMessage,name:t})}return null}}]),t}(),rn=5,nn=function(){function t(e){var r=e.maxConcurrency,n=void 0===r?rn:r,i=e.onMessage,a=e.onDebug,o=void 0===a?function(){}:a;fe(this,t),this.maxConcurrency=n,this.onMessage=i,this.onDebug=o,this.workerPools=new Map}var e;return ve(t,[{key:"setProps",value:function(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}},{key:"destroy",value:function(){this.workerPools.forEach((function(t){return t.destroy()}))}},{key:"process",value:(e=he(oe.a.mark((function t(e,r,n){var i;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this._getWorkerPool(e,r),t.abrupt("return",i.process(n));case 2:case"end":return t.stop()}}),t,this)}))),function(t,r,n){return e.apply(this,arguments)})},{key:"_getWorkerPool",value:function(t,e){var r=this.workerPools.get(e);return r||(r=new en({source:t,name:e,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,r)),r}}]),t}(),an=null;function on(t){return sn.apply(this,arguments)}function sn(){return(sn=he(oe.a.mark((function t(e){var r,n,i,a,o;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.worker,n=e.data,i=e.resolve,a=e.reject,t.t0=n.type,t.next="done"===t.t0?4:"process"===t.t0?6:"error"===t.t0?17:19;break;case 4:return i(n.result),t.abrupt("break",19);case 6:return t.prev=6,t.next=9,dn(n.arraybuffer,n.options,n.url);case 9:o=t.sent,r.postMessage({type:"process-done",id:n.id,result:o},Qr(o)),t.next=16;break;case 13:t.prev=13,t.t1=t.catch(6),r.postMessage({type:"process-error",id:n.id,message:t.t1.message});case 16:return t.abrupt("break",19);case 17:return a(n.message),t.abrupt("break",19);case 19:case"end":return t.stop()}}),t,null,[[6,13]])})))).apply(this,arguments)}function un(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency),t.onDebug&&(e.onDebug=t.onDebug),an||(an=new nn({onMessage:on})),an.setProps(e),an}(n));return n=JSON.parse(JSON.stringify(n)),i.process(t,"loaders.gl-".concat(e),{arraybuffer:Kr(r),options:n,source:"loaders.gl",type:"process"})}var cn=[];var hn=/\.([^.]+)$/,ln=/^data:(.*?)(;|,)/;function fn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).nothrow,i=void 0!==n&&n;if(e=e||"",t&&!Array.isArray(t)){var a=t;return Nr(a),a}(function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){Nr(i.value)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}})(t=t||cn),e=e.replace(/\?.*/,"");var o=null;if(!(o=(o=o||function(t,e){var r=e.match(ln),n=r&&r[1];if(n)return function(t,e){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(s.mimeTypes&&s.mimeTypes.includes(e))return s}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}(t,n);var i=(r=e.match(hn))&&r[1];return i&&function(t,e){e=e.toLowerCase();var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=!0,c=!1,h=void 0;try{for(var l,f=s.extensions[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){if(l.value.toLowerCase()===e)return s}}catch(t){c=!0,h=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}(t,i)}(t,e))||function(t,e){if(!e)return null;var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if("string"==typeof e){if(yn(e,s))return s}else if(ArrayBuffer.isView(e)){if(vn(e.buffer,e.byteOffset,s))return s}else if(e instanceof ArrayBuffer){if(vn(e,0,s))return s}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}(t,r))){if(i)return null;throw new Error("No valid loader found for ".concat(e))}return o}function yn(t,e){return e.testText&&e.testText(t)}function vn(t,e,r){switch(Array.isArray(r.test)?"array":Object(zt.a)(r.test)){case"function":return r.test(t,r);case"string":case"array":return(Array.isArray(r.test)?r.test:[r.test]).some((function(r){return r===function(t,e,r){if(t.byteLength<=e+r)return"";for(var n=new DataView(t),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}(t,e,r.length)}));default:return!1}}function dn(t,e,r,n){return pn.apply(this,arguments)}function pn(){return(pn=he(oe.a.mark((function t(e,r,n,i){var a,o,s;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!r||Array.isArray(r)||Mr(r)||(i=n,n=r,r=null),n=n||{},a=Br(e,i),o=fn(r,a,e),n=Ir(n,o),s=Zr({url:a,parse:dn}),t.next=8,mn(o,e,n,s);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mn(t,e,r,n){return gn.apply(this,arguments)}function gn(){return(gn=he(oe.a.mark((function t(e,r,n,i){return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Gr(r,e);case 2:if(r=t.sent,!e.parseTextSync||"string"!=typeof r){t.next=6;break}return n.dataType="text",t.abrupt("return",e.parseTextSync(r,n,i,e));case 6:if(!e.parse){t.next=10;break}return t.next=9,e.parse(r,n,i,e);case 9:return t.abrupt("return",t.sent);case 10:if(!e.parseSync){t.next=12;break}return t.abrupt("return",e.parseSync(r,n,i,e));case 12:if(!e.worker){t.next=16;break}return t.next=15,un(e.worker,e.name,r,n,i,e);case 15:return t.abrupt("return",t.sent);case 16:return t.abrupt("return",Sr(!1));case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var kn="",bn={};function wn(t){for(var e in bn)if(t.startsWith(e)){var r=bn[e];return t.replace(e,r)}return t+=kn}function En(t,e){return _n.apply(this,arguments)}function _n(){return(_n=he(oe.a.mark((function t(e,r){return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Ar(e)){t.next=2;break}return t.abrupt("return",jr(e,r));case 2:return e=wn(e),t.abrupt("return",fetch(e,r));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tn(t){var e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}Dr.a.TextEncoder,Dr.a.TextDecoder;function Sn(t,e){if(!t)throw new Error(e||"3d-tile loader: assertion failed.")}function xn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var On="Queued Requests",Mn="Active Requests",Nn="Cancelled Requests",Ln="Queued Requests Ever",In="Active Requests Ever",Pn={id:"request-scheduler",throttleRequests:!0,maxRequests:6},An=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fe(this,t),this.props=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xn(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xn(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},e,{},Pn),this.requestQueue=[],this.activeRequestCount=0,this.stats=new Tr({id:e.id}),this.stats.get(On),this.stats.get(Mn),this.stats.get(Nn),this.stats.get(Ln),this.stats.get(In)}return ve(t,[{key:"scheduleRequest",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve(t);var n=new Promise((function(n,i){e.requestQueue.push({handle:t,callback:r,resolve:n,reject:i})}));return this._issueNewRequests(),n}},{key:"startRequest",value:function(t){this.activeRequestCount++}},{key:"endRequest",value:function(t){this.activeRequestCount--,this._issueNewRequests()}},{key:"trackRequestPromise",value:function(t,e){var r=this;this.startRequest(t),e.then((function(){return r.endRequest(t)})).catch((function(){return r.endRequest(t)}))}},{key:"_issueNewRequests",value:function(){var t=this;this._updateNeeded=!0,setTimeout((function(){return t._issueNewRequestsAsync()}),0)}},{key:"_issueNewRequestsAsync",value:function(){this._updateNeeded=!1;var t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(var e=0;e<t;++e){if(this.requestQueue.length>0)this.requestQueue.shift().resolve(!0)}}}},{key:"_updateAllRequests",value:function(){for(var t=this.requestQueue,e=0;e<t.length;++e){var r=t[e];this._updateRequest(r)||(t.splice(e,1),e--)}t.sort((function(t,e){return t.priority-e.priority}))}},{key:"_updateRequest",value:function(t){return t.priority=t.callback(t.handle),!(t.priority<0)||(t.resolve(!1),!1)}}]),t}();function Cn(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function Rn(t,e){Cn(t),Cn(e);var r=e.rtcCenter,n=e.rotateYtoZ,i=t.computedTransform,a=t._boundingVolume.center,o=new Be(i);if(r&&o.translate(r),n){var s=(new Be).rotateX(Math.PI/2);o=o.multiplyRight(s)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);var u=new We(a);e.cartesianModelMatrix=o,e.cartesianOrigin=u;var c=gr.WGS84.cartesianToCartographic(u,new We),h=gr.WGS84.eastNorthUpToFixedFrame(u).invert();e.cartographicModelMatrix=h.multiplyRight(o),e.cartographicOrigin=c,e.modelMatrix=e.cartographicModelMatrix}var Dn=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),zn=Dn,jn=new We,qn=new We,Un=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;fe(this,t),n=n||jn.copy(e).add(r).scale(.5),this.minimum=new We(e),this.maximum=new We(r),this.center=new We(n)}ve(t,[{key:"fromPoints",value:function(t){if(!t||0===t.length)return this.minimum.set(0,0,0),this.maximum.set(0,0,0),this.center.set(0,0,0),this;var e=t[0][0],r=t[0][1],n=t[0][2],i=t[0][0],a=t[0][1],o=t[0][2],s=!0,u=!1,c=void 0;try{for(var h,l=t[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,y=f[0],v=f[1],d=f[2];e=Math.min(y,e),i=Math.max(y,i),r=Math.min(v,r),a=Math.max(v,a),n=Math.min(d,n),o=Math.max(d,o)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}return this.minimum.set(e,r,n),this.maximum.set(i,a,o),this.center.copy(this.minimum).add(this.maximum).scale(.5),this}},{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=jn.copy(this.maximum).subtract(this.minimum).scale(.5),r=qn.from(t.normal),n=e.x*Math.abs(r.x)+e.y*Math.abs(r.y)+e.z*Math.abs(r.z),i=this.center.dot(r)+t.distance;return i-n>0?zn.INSIDE:i+n<0?zn.OUTSIDE:zn.INTERSECTING}}])}(),new We),Fn=new We,Bn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fe(this,t),this.radius=-0,this.center=new We,this.fromCenterRadius(e,r)}return ve(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=Un.from(e),this.center=(new We).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.center,i=t.radius,a=Un.copy(n).subtract(e),o=a.magnitude();if(r>=o+i)return this.clone();if(i>=o+r)return t.clone();var s=.5*(r+o+i);return Fn.copy(a).scale((-r+s)/o).add(e),this.center.copy(Fn),this.radius=s,this}},{key:"expand",value:function(t){var e=(t=Un.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?zn.OUTSIDE:n<r?zn.INTERSECTING:zn.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=X(Un,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=Un.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}();function Vn(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Gn(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*o-s*c,f=-h*a+s*u,y=c*a-o*u,v=r*l+n*f+i*y;return v?(v=1/v,t[0]=l*v,t[1]=(-h*n+i*c)*v,t[2]=(s*n-i*o)*v,t[3]=f*v,t[4]=(h*r-i*u)*v,t[5]=(-s*r+i*a)*v,t[6]=y*v,t[7]=(-c*r+n*u)*v,t[8]=(o*r-n*a)*v,t):null}function Wn(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return e*(c*a-o*u)+r*(-c*i+o*s)+n*(u*i-a*s)}function Hn(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],y=r[1],v=r[2],d=r[3],p=r[4],m=r[5],g=r[6],k=r[7],b=r[8];return t[0]=f*n+y*o+v*c,t[1]=f*i+y*s+v*h,t[2]=f*a+y*u+v*l,t[3]=d*n+p*o+m*c,t[4]=d*i+p*s+m*h,t[5]=d*a+p*u+m*l,t[6]=g*n+k*o+b*c,t[7]=g*i+k*s+b*h,t[8]=g*a+k*u+b*l,t}function Zn(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],y=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*n+y*o+c,t[7]=f*i+y*s+h,t[8]=f*a+y*u+l,t}function Yn(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),y=Math.cos(r);return t[0]=y*n+f*o,t[1]=y*i+f*s,t[2]=y*a+f*u,t[3]=y*o-f*n,t[4]=y*s-f*i,t[5]=y*u-f*a,t[6]=c,t[7]=h,t[8]=l,t}function Kn(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Qn(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=n*o,l=n*s,f=i*o,y=i*s,v=i*u,d=a*o,p=a*s,m=a*u;return t[0]=1-l-v,t[3]=h-m,t[6]=f+p,t[1]=h+m,t[4]=1-c-v,t[7]=y-d,t[2]=f-p,t[5]=y+d,t[8]=1-c-l,t}var Xn=Object.freeze([1,0,0,0,1,0,0,0,1]),Jn=Object.freeze([0,0,0,0,0,0,0,0,0]),$n=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),ti={},ei=function(t){function e(t){var r;return fe(this,e),r=de(this,pe(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return me(e,t),ve(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return $n}}],[{key:"IDENTITY",get:function(){return ti.IDENTITY=ti.IDENTITY||Object.freeze(new e(Xn)),ti.IDENTITY}},{key:"ZERO",get:function(){return ti.ZERO=ti.ZERO||Object.freeze(new e(Jn)),ti.ZERO}}]),ve(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=u,this.check()}},{key:"determinant",value:function(){return Wn(this)}},{key:"identity",value:function(){return this.copy(Xn)}},{key:"fromQuaternion",value:function(t){return Qn(this,t),this.check()}},{key:"transpose",value:function(){return Vn(this,this),this.check()}},{key:"invert",value:function(){return Gn(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return Hn(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return Hn(this,this,t),this.check()}},{key:"rotate",value:function(t){return Yn(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?Kn(this,this,t):Kn(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return Zn(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=nt(e||[-0,-0],t,this);break;case 3:e=ft(e||[-0,-0,-0],t,this);break;case 4:e=ze(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Le(e,t.length),e}},{key:"transformVector",value:function(t,e){return Pe("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return Pe("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return Pe("Matrix3.transformVector"),this.transform(t,e)}}]),e}(Re),ri=new ei,ni=new ei,ii=new ei,ai=new ei,oi=new ei;function si(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=He.EPSILON20,n=0,i=0,a=ni,o=ii;a.identity(),o.copy(t);for(var s=r*function(t){for(var e=0,r=0;r<9;++r){var n=t[r];e+=n*n}return Math.sqrt(e)}(o);i<10&&hi(o)>s;)li(o,ai),oi.copy(ai).transpose(),o.multiplyRight(ai),o.multiplyLeft(oi),a.multiplyRight(ai),++n>2&&(++i,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}var ui=[1,0,0],ci=[2,2,1];function hi(t){for(var e=0,r=0;r<3;++r){var n=t[ri.getElementIndex(ci[r],ui[r])];e+=2*n*n}return Math.sqrt(e)}function li(t,e){for(var r=He.EPSILON15,n=0,i=1,a=0;a<3;++a){var o=Math.abs(t[ri.getElementIndex(ci[a],ui[a])]);o>n&&(i=a,n=o)}var s=ui[i],u=ci[i],c=1,h=0;if(Math.abs(t[ri.getElementIndex(u,s)])>r){var l,f=(t[ri.getElementIndex(u,u)]-t[ri.getElementIndex(s,s)])/2/t[ri.getElementIndex(u,s)];h=(l=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(c=1/Math.sqrt(1+l*l))}return ei.IDENTITY.to(e),e[ri.getElementIndex(s,s)]=e[ri.getElementIndex(u,u)]=c,e[ri.getElementIndex(u,s)]=h,e[ri.getElementIndex(s,u)]=-h,e}var fi=new We,yi=new We,vi=new We,di=new We,pi=new We,mi=new ei,gi={diagonal:new ei,unitary:new ei};function ki(t,e){if(!t||0===t.length)return e.halfAxes=new ei([0,0,0,0,0,0,0,0,0]),e.center=new We,e;var r=t.length,n=new We(0,0,0),i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;n.add(c)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}var h=1/r;n.multiplyByScalar(h);var l=0,f=0,y=0,v=0,d=0,p=0,m=!0,g=!1,k=void 0;try{for(var b,w=t[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var E=b.value,_=fi.copy(E).subtract(n);l+=_.x*_.x,f+=_.x*_.y,y+=_.x*_.z,v+=_.y*_.y,d+=_.y*_.z,p+=_.z*_.z}}catch(t){g=!0,k=t}finally{try{m||null==w.return||w.return()}finally{if(g)throw k}}l*=h,f*=h,y*=h,v*=h,d*=h,p*=h;var T=mi;T[0]=l,T[1]=f,T[2]=y,T[3]=f,T[4]=v,T[5]=d,T[6]=y,T[7]=d,T[8]=p;var S=si(T,gi).unitary,x=e.halfAxes.copy(S),O=x.getColumn(0,vi),M=x.getColumn(1,di),N=x.getColumn(2,pi),L=-Number.MAX_VALUE,I=-Number.MAX_VALUE,P=-Number.MAX_VALUE,A=Number.MAX_VALUE,C=Number.MAX_VALUE,R=Number.MAX_VALUE,D=!0,z=!1,j=void 0;try{for(var q,U=t[Symbol.iterator]();!(D=(q=U.next()).done);D=!0){var F=q.value;L=Math.max(F.dot(O),L),I=Math.max(F.dot(M),I),P=Math.max(F.dot(N),P),A=Math.min(F.dot(O),A),C=Math.min(F.dot(M),C),R=Math.min(F.dot(N),R)}}catch(t){z=!0,j=t}finally{try{D||null==U.return||U.return()}finally{if(z)throw j}}O=O.multiplyByScalar(.5*(A+L)),M=M.multiplyByScalar(.5*(C+I)),N=N.multiplyByScalar(.5*(R+P)),e.center.copy(O).add(M).add(N);var B=yi.set(L-A,I-C,P-R).multiplyByScalar(.5);return e.halfAxes.multiplyByScalar(B),e}var bi=new We,wi=new We,Ei=new We,_i=new We,Ti=new We,Si=new We,xi=new We,Oi=new We,Mi=new We,Ni=new We,Li=new We,Ii=0,Pi=1,Ai=2,Ci=3,Ri=4,Di=5,zi=6,ji=7,qi=8,Ui=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];fe(this,t),this.center=(new We).from(e),this.halfAxes=new ei(r)}return ve(t,[{key:"clone",value:function(e){return new t(this.center,this.halfAxes)}},{key:"fromPoints",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;return ki(e,r)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bn,e=this.halfAxes,r=e.getColumn(0,Mi),n=e.getColumn(1,Ni),i=e.getColumn(2,Li),a=bi.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=a.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,a=r.y,o=r.z,s=Math.abs(i*n[Ii]+a*n[Pi]+o*n[Ai])+Math.abs(i*n[Ci]+a*n[Ri]+o*n[Di])+Math.abs(i*n[zi]+a*n[ji]+o*n[qi]),u=r.dot(e)+t.distance;return u<=-s?zn.OUTSIDE:u>=s?zn.INSIDE:zn.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=wi.copy(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Ei),i=r.getColumn(1,_i),a=r.getColumn(2,Ti),o=n.magnitude(),s=i.magnitude(),u=a.magnitude();n.normalize(),i.normalize(),a.normalize();var c=Si;c.x=e.dot(n),c.y=e.dot(i),c.z=e.dot(a);var h,l=0;return c.x<-o?l+=(h=c.x+o)*h:c.x>o&&(l+=(h=c.x-o)*h),c.y<-s?l+=(h=c.y+s)*h:c.y>s&&(l+=(h=c.y-s)*h),c.z<-u?l+=(h=c.z+u)*h:c.z>u&&(l+=(h=c.z-u)*h),l}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,Ei),u=o.getColumn(1,_i),c=o.getColumn(2,Ti),h=xi.copy(s).add(u).add(c).add(a),l=Oi.copy(h).subtract(t),f=e.dot(l);return n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),r.start=n,r.stop=i,r}},{key:"getTransform",value:function(){}}]),t}(),Fi=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0,-0)),_e(r)&&1===arguments.length?t.copy(r):(we.debug&&(Ne(r),Ne(n),Ne(i),Ne(a)),t[0]=r,t[1]=n,t[2]=i,t[3]=a),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"fromObject",value:function(t){return we.debug&&(Ne(t.x),Ne(t.y),Ne(t.z),Ne(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}},{key:"transform",value:function(t){return lt(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return ze(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return yt(this,this,t),this.check()}},{key:"applyMatrix4",value:function(t){return t.transform(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ne(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Ne(t)}}]),e}(Ve),Bi=new We,Vi=new We,Gi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fe(this,t),this.normal=new We,this.distance=-0,this.fromNormalDistance(e,r)}return ve(t,[{key:"fromNormalDistance",value:function(t,e){return ge(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=Bi.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),ge(1===this.normal.len()),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return Me(this.distance,t.distance)&&Me(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=Vi.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=Bi.from(t);var r=this.getPointDistance(t),n=Vi.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}(),Wi=[new We([1,0,0]),new We([0,1,0]),new We([0,0,1])],Hi=new We,Zi=new We,Yi=new Gi(new We(1,0,0),0),Ki=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];fe(this,t),this.planes=e,ge(this.planes.every((function(t){return t instanceof Gi})))}return ve(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),ve(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*Wi.length;for(var e=t.center,r=t.radius,n=0,i=0,a=Wi;i<a.length;i++){var o=a[i],s=this.planes[n],u=this.planes[n+1];s||(s=this.planes[n]=new Fi),u||(u=this.planes[n+1]=new Fi);var c=Hi.copy(o).scale(-r).add(e),h=-o.dot(c);s.x=o.x,s.y=o.y,s.z=o.z,s.w=h;var l=Hi.copy(o).scale(r).add(e),f=Zi.copy(o).negate(),y=-f.dot(l);u.x=f.x,u.y=f.y,u.z=f.z,u.w=y,n+=2}return this}},{key:"computeVisibility",value:function(t){ge(t);var e=zn.INSIDE,r=!0,n=!1,i=void 0;try{for(var a,o=this.planes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=Yi.fromCoefficients.apply(Yi,Ut(s));switch(t.intersectPlane(u)){case zn.OUTSIDE:return zn.OUTSIDE;case zn.INTERSECTING:e=zn.INTERSECTING}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(ge(e,"boundingVolume is required."),ge(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,a=0;a<this.planes.length;++a){var o=a<31?1<<a:0;if(!(a<31&&0==(r&o))){var s=Yi.fromCoefficients.apply(Yi,Ut(i[a])),u=e.intersectPlane(s);if(u===zn.OUTSIDE)return t.MASK_OUTSIDE;u===zn.INTERSECTING&&(n|=o)}}return n}}]),t}();function Qi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),n.forEach((function(e){le(t,e,r[e])}))}return t}var Xi=new We,Ji=new We,$i=new We,ta=new We,ea=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fe(this,t),e=Qi({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new Ki,this._perspectiveMatrix=new Be,this._infinitePerspective=new Be}return ve(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,r){ge(t,"position is required."),ge(e,"direction is required."),ge(r,"up is required.");var n=this._cullingVolume.planes,i=Xi.copy(e).cross(r),a=Ji.copy(e).multiplyByScalar(this.near).add(t),o=$i.copy(e).multiplyByScalar(this.far).add(t),s=ta;s.copy(i).multiplyByScalar(this.left).add(a).subtract(t).normalize().cross(r).normalize(),n[0]=n[0]||new Fi;var u=n[0];return u.x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(i).multiplyByScalar(this.right).add(a).subtract(t).normalize().cross(r).normalize(),n[1]=n[1]||new Fi,(u=n[1]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(r).multiplyByScalar(this.bottom).add(a).subtract(t).normalize().cross(i).normalize(),n[2]=n[2]||new Fi,(u=n[2]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(r).multiplyByScalar(this.top).add(a).subtract(t).normalize().cross(i).normalize(),n[3]=n[3]||new Fi,(u=n[3]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s=(new We).copy(e).normalize(),n[4]=n[4]||new Fi,(u=n[4]).x=e.x,u.y=e.y,u.z=e.z,u.w=-e.dot(a),s.copy(e).negate().normalize(),n[5]=n[5]||new Fi,(u=n[5]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(o),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,r,n){ra(this),ge(Number.isFinite(t)&&Number.isFinite(e)),ge(t>0),ge(e>0),ge(r>0),ge(n);var i=1/this.near,a=this.top*i,o=2*r*a/e,s=2*r*(a=this.right*i)/t;return n.x=s,n.y=o,n}},{key:"projectionMatrix",get:function(){return ra(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return ra(this),this._infinitePerspective}}]),t}();function ra(t){ge(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,r=t.bottom,n=t.right,i=t.left,a=t.near,o=t.far;e===t._top&&r===t._bottom&&i===t._left&&n===t._right&&a===t._near&&o===t._far||(ge(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=n,t._top=e,t._bottom=r,t._near=a,t._far=o,t._perspectiveMatrix=(new Be).frustum({left:i,right:n,bottom:r,top:e,near:a,far:o}),t._infinitePerspective=(new Be).frustum({left:i,right:n,bottom:r,top:e,near:a,far:1/0}))}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fe(this,t),e=Qi({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new ea,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}ve(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(na(this),na(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,r){return na(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}},{key:"getPixelDimensions",value:function(t,e,r,n){return na(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}},{key:"projectionMatrix",get:function(){return na(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return na(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return na(this),this._fovy}},{key:"sseDenominator",get:function(){return na(this),this._sseDenominator}}])}();function na(t){ge(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(ge(t.fov>=0&&t.fov<Math.PI),ge(t.aspectRatio>0),ge(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new We,new We,new We,new We,new We,new We,new We,new We,new We,new We,new We,new We,Math.PI;var ia={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"},aa=(Object.keys(ia),{UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5}),oa={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},sa=0,ua=1;function ca(t,e,r){Cn(t instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}function ha(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t);return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}function la(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var fa,ya={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},va=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?la(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):la(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},{},ya),da=(le(fa={},ya.DOUBLE,Float64Array),le(fa,ya.FLOAT,Float32Array),le(fa,ya.UNSIGNED_SHORT,Uint16Array),le(fa,ya.UNSIGNED_INT,Uint32Array),le(fa,ya.UNSIGNED_BYTE,Uint8Array),le(fa,ya.BYTE,Int8Array),le(fa,ya.SHORT,Int16Array),le(fa,ya.INT,Int32Array),fa),pa={DOUBLE:ya.DOUBLE,FLOAT:ya.FLOAT,UNSIGNED_SHORT:ya.UNSIGNED_SHORT,UNSIGNED_INT:ya.UNSIGNED_INT,UNSIGNED_BYTE:ya.UNSIGNED_BYTE,BYTE:ya.BYTE,SHORT:ya.SHORT,INT:ya.INT},ma=function(){function t(){fe(this,t)}return ve(t,null,[{key:"fromTypedArray",value:function(t){for(var e in t=ArrayBuffer.isView(t)?t.constructor:t,da){if(da[e]===t)return e}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(t){var e=pa[t];if(!e)throw new Error("Failed to convert GL type");return e}},{key:"getArrayType",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t){case ya.UNSIGNED_SHORT_5_6_5:case ya.UNSIGNED_SHORT_4_4_4_4:case ya.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var e=da[t];if(!e)throw new Error("Failed to convert GL type");return e}}},{key:"getByteSize",value:function(e){return t.getArrayType(e).BYTES_PER_ELEMENT}},{key:"validate",value:function(e){return Boolean(t.getArrayType(e))}},{key:"createTypedArray",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(r.byteLength-n)/t.getByteSize(e));var a=t.getArrayType(e);return new a(r,n,i)}}]),t}(),ga=function(){function t(e,r){fe(this,t),this.json=e,this.buffer=r,this.featuresLength=0,this._cachedTypedArrays={}}return ve(t,[{key:"getExtension",value:function(t){return this.json.extensions&&this.json.extensions[t]}},{key:"hasProperty",value:function(t){return Boolean(this.json[t])}},{key:"getGlobalProperty",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:va.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(t,e,r){var n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=ma.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}},{key:"getProperty",value:function(t,e,r,n,i){var a=this.json[t];if(!a)return a;var o=this.getPropertyArray(t,e,r);if(1===r)return o[n];for(var s=0;s<r;++s)i[s]=o[r*n+s];return i}},{key:"_getTypedArrayFromBinary",value:function(t,e,r,n,i){var a=this._cachedTypedArrays,o=a[t];return o||(o=ma.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[t]=o),o}},{key:"_getTypedArrayFromArray",value:function(t,e,r){var n=this._cachedTypedArrays,i=n[t];return i||(i=ma.createTypedArray(e,r),n[t]=i),i}}]),t}(),ka={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ba={SCALAR:function(t,e){return t[e]},VEC2:function(t,e){return[t[2*e+0],t[2*e+1]]},VEC3:function(t,e){return[t[3*e+0],t[3*e+1],t[3*e+2]]},VEC4:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT2:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT3:function(t,e){return[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]]},MAT4:function(t,e){return[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]}},wa={SCALAR:function(t,e,r){e[r]=t},VEC2:function(t,e,r){e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:function(t,e,r){e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:function(t,e,r){e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:function(t,e,r){e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function Ea(t){throw new Error('"'+t+'" is read-only')}var _a=function(t){return void 0!==t};function Ta(t,e,r){if(!e)return null;var n=t.getExtension("3DTILES_batch_table_hierarchy"),i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(t,e){var r,n,i,a,o=t.instancesLength,s=t.classes,u=t.classIds,c=t.parentCounts,h=t.parentIds,l=o;_a(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),Ea("classIds"),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,o));if(_a(c))for(_a(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),Ea("parentCounts"),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,o)),a=new Uint16Array(o),Ea("parentIdsLength"),l=0,r=0;r<o;++r)a[r]=l,l+=(Ea("parentIdsLength"),c[r]);_a(h)&&_a(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),Ea("parentIds"),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,l));var f=s.length;for(r=0;r<f;++r){var y=s[r].length,v=s[r].instances,d=getBinaryProperties(y,v,e);s[r].instances=combine(d,v)}var p=new Array(f).fill(0),m=new Uint16Array(o);for(r=0;r<o;++r)n=u[r],m[r]=p[n],++p[n];var g={classes:s,classIds:u,classIndexes:m,parentCounts:c,parentIndexes:a,parentIds:h};return function(t){for(var e=t.classIds.length,r=0;r<e;++r)xa(t,r,stack)}(g),g}(n,r):null}function Sa(t,e,r){if(t){var n=t.parentCounts;return t.parentIds?r(t,e):n>0?function(t,e,r){var n=t.classIds,i=t.parentCounts,a=t.parentIds,o=t.parentIndexes,s=n.length,u=scratchVisited;u.length=Math.max(u.length,s);var c=++marker,h=scratchStack;h.length=0,h.push(e);for(;h.length>0;)if(e=h.pop(),u[e]!==c){u[e]=c;var l=r(t,e);if(_a(l))return l;for(var f=i[e],y=o[e],v=0;v<f;++v){var d=a[y+v];d!==e&&h.push(d)}}return null}(t,e,r):function(t,e,r){var n=!0;for(;n;){var i=r(t,e);if(_a(i))return i;var a=t.parentIds[e];n=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}(t,e,r)}}function xa(t,e,r){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=t.classIds.length;if(_a(i)){assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);for(var s=_a(n)?n[e]:1,u=_a(n)?a[e]:e,c=0;c<s;++c){var h=i[u+c];h!==e&&xa(t,h,r)}r.pop(e)}}var Oa=function(t){return void 0!==t},Ma=function(t){return t},Na={HIERARCHY:!0,extensions:!0,extras:!0},La=function(){function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var a in fe(this,t),Sn(n>=0),this.json=e||{},this.binary=r,this.featureCount=n,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)Na[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Ta(this,this.json,this.binary))}return ve(t,[{key:"getExtension",value:function(t){return this.json&&this.json.extensions&&this.json.extensions[t]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(t,e){if(this._checkBatchId(t),Sn("string"==typeof e,e),this._hierarchy){var r=Sa(this._hierarchy,t,(function(t,r){var n=t.classIds[r];return t.classes[n].name===e}));return Oa(r)}return!1}},{key:"isExactClass",value:function(t,e){return Sn("string"==typeof e,e),this.getExactClassName(t)===e}},{key:"getExactClassName",value:function(t){if(this._checkBatchId(t),this._hierarchy){var e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}},{key:"hasProperty",value:function(t,e){return this._checkBatchId(t),Sn("string"==typeof e,e),Oa(this._properties[e])||this._hasPropertyInHierarchy(t,e)}},{key:"getPropertyNames",value:function(t,e){var r;this._checkBatchId(t),(e=Oa(e)?e:[]).length=0;var n=Object.keys(this._properties);return(r=e).push.apply(r,Ut(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}},{key:"getProperty",value:function(t,e){if(this._checkBatchId(t),Sn("string"==typeof e,e),this._binaryProperties){var r=this._binaryProperties[e];if(Oa(r))return this._getBinaryProperty(r,t)}var n=this._properties[e];if(Oa(n))return Ma(n[t]);if(this._hierarchy){var i=this._getHierarchyProperty(t,e);if(Oa(i))return i}}},{key:"setProperty",value:function(t,e,r){var n=this.featureCount;if(this._checkBatchId(t,n),Sn("string"==typeof e,e),this._binaryProperties){var i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,t,e,r)){var a=this._properties[e];Oa(a)||(this._properties[e]=new Array(n),a=this._properties[e]),a[t]=Ma(r)}}},{key:"_checkBatchId",value:function(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(t,e){return t.unpack(t.typedArray,e)}},{key:"_setBinaryProperty",value:function(t,e,r){t.pack(r,t.typedArray,e)}},{key:"_initializeBinaryProperties",value:function(){var t=null;for(var e in this._properties){var r=this._properties[e],n=this._initializeBinaryProperty(e,r);n&&((t=t||{})[e]=n)}return t}},{key:"_initializeBinaryProperty",value:function(t,e){if("byteOffset"in e){var r=e;Sn(this.binary,"Property ".concat(t," requires a batch table binary.")),Sn(r.type,"Property ".concat(t," requires a type."));var n=function(t,e,r,n){var i=t.componentType;Sn(t.componentType);var a="string"==typeof i?ma.fromName(i):i,o=ka[t.type],s=ba[t.type],u=wa[t.type];return r+=t.byteOffset,{values:ma.createTypedArray(a,e,r,o*n),type:a,size:o,unpacker:s,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(t,e){if(!this._hierarchy)return!1;var r=Sa(this._hierarchy,t,(function(t,r){var n=t.classIds[r],i=t.classes[n].instances;return Oa(i[e])}));return Oa(r)}},{key:"_getPropertyNamesInHierarchy",value:function(t,e){Sa(this._hierarchy,t,(function(t,r){var n=t.classIds[r],i=t.classes[n].instances;for(var a in i)i.hasOwnProperty(a)&&-1===e.indexOf(a)&&e.push(a)}))}},{key:"_getHierarchyProperty",value:function(t,e){var r=this;return Sa(this._hierarchy,t,(function(t,n){var i=t.classIds[n],a=t.classes[i],o=t.classIndexes[n],s=a.instances[e];return Oa(s)?Oa(s.typedArray)?r._getBinaryProperty(s,o):Ma(s[o]):null}))}},{key:"_setHierarchyProperty",value:function(t,e,r,n){var i=this,a=Sa(this._hierarchy,e,(function(t,a){var o=t.classIds[a],s=t.classes[o],u=t.classIndexes[a],c=s.instances[r];return!!Oa(c)&&(Sn(a===e,'Inherited property "'.concat(r,'" is read-only.')),Oa(c.typedArray)?i._setBinaryProperty(c,u,n):c[u]=Ma(n),!0)}));return Oa(a)}}]),t}(),Ia=4;function Pa(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=Ia,t.version=n.getUint32(r,!0),r+=Ia,t.byteLength=n.getUint32(r,!0),r+=Ia,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return r}var Aa=4;function Ca(t,e,r){var n=new DataView(e);return t.featureTableJsonByteLength=n.getUint32(r,!0),r+=Aa,t.featureTableBinaryByteLength=n.getUint32(r,!0),r+=Aa,t.batchTableJsonByteLength=n.getUint32(r,!0),r+=Aa,t.batchTableBinaryByteLength=n.getUint32(r,!0),r+=Aa}function Ra(t,e,r,n){return r=function(t,e,r,n){var i=t.featureTableJsonByteLength,a=t.featureTableBinaryByteLength;if(t.featureTableJson={BATCH_LENGTH:0},i>0){var o=ca(e,r,i);t.featureTableJson=JSON.parse(o)}return r+=i,t.featureTableBinary=new Uint8Array(e,r,a),r+=a}(t,e,r),r=function(t,e,r,n){var i=t.batchTableJsonByteLength,a=t.batchTableBinaryByteLength;if(i>0){var o=ca(e,r,i);t.batchTableJson=JSON.parse(o),r+=i,a>0&&(t.batchTableBinary=new Uint8Array(e,r,a),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=a)}return r}(t,e,r)}function Da(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=t>>11&31,n=t>>5&63,i=31&t;return e[0]=r<<3,e[1]=n<<2,e[2]=i<<3,e}function za(t,e,r){if(!(e||t&&t.batchIds&&r))return null;var n=t.batchIds,i=t.isRGB565,a=t.pointCount;if(n&&r){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var u=n[s],c=r.getProperty(u,"dimensions").map((function(t){return 255*t}));o[3*s]=c[0],o[3*s+1]=c[1],o[3*s+2]=c[2]}return{type:va.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var h=new Uint8ClampedArray(3*a),l=0;l<a;l++){var f=Da(e[l]);h[3*l]=f[0],h[3*l+1]=f[1],h[3*l+2]=f[2]}return{type:va.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}return e&&e.length===3*a?{type:va.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:va.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}function ja(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}Math.PI,Math.PI;var qa={};function Ua(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?qa.precision||4:e;return t=function(t){return Math.round(t/qa.EPSILON)*qa.EPSILON}(t),"".concat(parseFloat(t.toPrecision(r)))}function Fa(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function Ba(t,e,r){if(Fa(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function Va(t,e,r){return Ba(t,(function(t){return Math.max(e,Math.min(r,t))}))}function Ga(t,e,r){var n=qa.EPSILON;r&&(qa.EPSILON=r);try{if(t===e)return!0;if(Fa(t)&&Fa(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Ga(t[i],e[i]))return!1;return!0}return t&&"object"===Object(zt.a)(t)&&t.equals?t.equals(e):e&&"object"===Object(zt.a)(e)&&e.equals?e.equals(t):Math.abs(t-e)<=qa.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{qa.EPSILON=n}}qa.EPSILON=1e-12,qa.debug=!1,qa.precision=4,qa.printTypes=!1,qa.printDegrees=!1,qa.printRowMajor=!0;var Wa=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Fa(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(qa)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Ua(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Ga(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(qa.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(Ae(Array));function Ha(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}var Za=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Ha(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Ha(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return ja(t>=0&&t<this.ELEMENTS,"index is out of range"),Ha(this[t])}},{key:"setComponent",value:function(t,e){return ja(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Ha(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Ha(t)}}]),e}(Wa);var Ya=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return fe(this,e),t=de(this,pe(e).call(this,2)),Fa(r)&&1===arguments.length?t.copy(r):(qa.debug&&(Ha(r),Ha(n)),t[0]=r,t[1]=n),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return qa.debug&&(Ha(t.x),Ha(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return it(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a}(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return nt(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5]}(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(Za),Ka=[0,0,0],Qa=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0)),1===arguments.length&&Fa(r)?t.copy(r):(qa.debug&&(Ha(r),Ha(n),Ha(i)),t[0]=r,t[1]=n,t[2]=i),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return qa.debug&&(Ha(t.x),Ha(t.y),Ha(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return mt(this,t)}},{key:"cross",value:function(t){return ht(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return vt(this,this,void 0===r?Ka:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return dt(this,this,void 0===r?Ka:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return pt(this,this,void 0===r?Ka:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return lt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o}(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return ft(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return yt(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ha(t)}}]),e}(Za);Math.PI,Math.PI,Math.PI,Math.PI;function Xa(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}new Ya,new Qa,new Ya,new Ya,new Uint8Array(1);function Ja(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Va(t,0,e)/e*2-1}function $a(t){return t<0?-1:1}function to(t,e,r,n){if(Xa(n),t<0||t>r||e<0||e>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=Ja(t,r),n.y=Ja(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*$a(i),n.y=(1-Math.abs(i))*$a(n.y)}return n.normalize()}function eo(t,e,r){return to(t,e,255,r)}var ro=new We;function no(t,e,r){return t.isQuantized?r.decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){for(var r=new We,n=new Float32Array(3*t.pointCount),i=0;i<t.pointCount;i++)r.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*i);return n}(t,e)):{type:va.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function io(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ao(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?io(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):io(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function oo(t,e,r,n,i){return so.apply(this,arguments)}function so(){return(so=he(oe.a.mark((function t(e,r,n,i,a){var o,s,u;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Pa(e,r,n,i),n=Ca(e,r,n),n=Ra(e,r,n),uo(e),o=co(e),s=o.featureTable,u=o.batchTable,t.next=7,yo(e,s,u,i,a);case 7:return ho(e,s,i),lo(e,s,u),fo(e,s),t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function uo(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function co(t){var e=new ga(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",va.FLOAT,3);var n=function(t,e){var r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",va.UNSIGNED_SHORT,1),t.batchIds)){var n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=t.batchTableJson,a=t.batchTableBinary;r=new La(i,a,n)}return r}(t,e);return{featureTable:e,batchTable:n}}function ho(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",va.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){var n=e.getPropertyArray("POSITION_QUANTIZED",va.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",va.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",va.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=no(t,n,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function lo(t,e,r){if(!t.attributes.colors){var n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",va.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",va.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",va.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=za(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",va.UNSIGNED_BYTE,4))}function fo(t,e){if(!t.attributes.normals){var r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",va.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",va.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){for(var r=new Float32Array(3*t.pointsLength),n=0;n<t.pointsLength;n++)eo(e[2*n],e[2*n+1],ro),ro.toArray(r,3*n);return{type:va.FLOAT,size:2,value:r}}return{type:va.FLOAT,size:2,value:e}}(t,r)}}function yo(t,e,r,n,i){return vo.apply(this,arguments)}function vo(){return(vo=he(oe.a.mark((function t(e,r,n,i,a){var o,s,u,c,h,l,f,y;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((c=n&&n.getExtension("3DTILES_draco_point_compression"))&&(u=c.properties),!(h=r.getExtension("3DTILES_draco_point_compression"))){t.next=15;break}if(s=h.properties,l=h.byteOffset,f=h.byteLength,s&&Number.isFinite(l)&&f){t.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=e.featureTableBinary.slice(l,l+f),e.hasPositions=Number.isFinite(s.POSITION),e.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),e.hasNormals=Number.isFinite(s.NORMAL),e.hasBatchIds=Number.isFinite(s.BATCH_ID),e.isTranslucent=Number.isFinite(s.RGBA);case 15:if(!o){t.next=19;break}return y={buffer:o,properties:ao({},s,{},u),featureTableProperties:s,batchTableProperties:u,dequantizeInShader:!1},t.next=19,po(e,y,i,a);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function po(t,e,r,n){return mo.apply(this,arguments)}function mo(){return(mo=he(oe.a.mark((function t(e,r,n,i){var a,o,s,u,c,h,l,f,y,v;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i.parse,t.next=3,a(r.buffer,n.DracoLoader);case 3:o=t.sent,s=o.attributes.POSITION&&o.attributes.POSITION.value,u=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,c=o.attributes.NORMAL&&o.attributes.NORMAL.value,h=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,l=s&&o.attributes.POSITION.value.quantization,f=c&&o.attributes.NORMAL.value.quantization,l&&(y=o.POSITION.data.quantization,v=y.range,e.quantizedVolumeScale=new We(v,v,v),e.quantizedVolumeOffset=new We(y.minValues),e.quantizedRange=(1<<y.quantizationBits)-1,e.isQuantizedDraco=!0),f&&(e.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0),e.attributes={positions:s,colors:za(e,u),normals:c,batchIds:h};case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var go={URI:0,EMBEDDED:1};function ko(t,e,r){var n=t.byteOffset+t.byteLength-r;if(0===n)throw new Error("glTF byte length must be greater than 0.");var i=new Uint8Array(e).subarray(r,r+n),a=new Uint8Array(i);return t.gltfArrayBuffer=a.buffer,t.gltfByteOffset=0,t.gltfByteLength=n,t.rotateYtoZ=!0,t.byteOffset+t.byteLength}function bo(t,e,r){switch(e){case go.URI:var n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=(new TextDecoder).decode(n);t.gltfUrl=i.replace(/[\s\0]+$/,"");break;case go.EMBEDDED:t.gltf={};break;default:throw new Error("i3dm: glTF format ".concat(e,": Must be 0 (uri) or 1 (embedded)"))}}function wo(t,e,r,n,i){return Eo.apply(this,arguments)}function Eo(){return(Eo=he(oe.a.mark((function t(e,r,n,i,a){return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_o(e,r,n,i,a),t.next=3,bo(e,go.EMBEDDED,0);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _o(t,e,r,n,i){r=ko(t,e,r=Ra(t,e,r=Ca(t,e,r=Pa(t,e,r,n))));var a=new ga(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",va.FLOAT,3),bo(t,go.EMBEDDED,0),r}function To(){var t=new A(4);return A!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function So(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function xo(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-n*c,t[2]=a*h+o*c+n*u-i*s,t[3]=o*h-n*s-i*u-a*c,t}function Oo(t,e,r,n){var i,a,o,s,u,c=e[0],h=e[1],l=e[2],f=e[3],y=r[0],v=r[1],d=r[2],p=r[3];return(a=c*y+h*v+l*d+f*p)<0&&(a=-a,y=-y,v=-v,d=-d,p=-p),1-a>P?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*c+u*y,t[1]=s*h+u*v,t[2]=s*l+u*d,t[3]=s*f+u*p,t}function Mo(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}var No,Lo,Io,Po,Ao,Co,Ro=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Do=C,zo=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},jo=function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},qo=R,Uo=D,Fo=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t},Bo=(No=at(),Lo=st(1,0,0),Io=st(0,1,0),function(t,e,r){var n=ct(e,r);return n<-.999999?(ht(No,Lo,e),gt(No)<1e-6&&ht(No,Io,e),ut(No,No),So(t,No,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ht(No,e,r),t[0]=No[0],t[1]=No[1],t[2]=No[2],t[3]=1+n,Fo(t,t))}),Vo=(Po=To(),Ao=To(),Co=function(){var t=new A(9);return A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}(),[0,0,0,1]),Go=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0,-0)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,n,i,a),t}return me(e,t),ve(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"fromMatrix3",value:function(t){return Mo(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return So(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return qo(this)}},{key:"lengthSquared",value:function(t){return Uo(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return zo(this,t)}},{key:"rotationTo",value:function(t,e){return Bo(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return Ro(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2];t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s}(this,this),this.check()}},{key:"lerp",value:function(t,e,r){return jo(this,t,e,r),this.check()}},{key:"multiplyRight",value:function(t,e){return ge(!e),xo(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return ge(!e),xo(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return Do(this,this,t),this.check()}},{key:"slerp",value:function(t,e,r){switch(arguments.length){case 1:var n=arguments[0],i=n.start;t=void 0===i?Vo:i,e=n.target,r=n.ratio;break;case 2:var a=Array.prototype.slice.call(arguments);e=a[0],r=a[1],t=this}return Oo(this,t,e,r),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return j(e,t,this),Le(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Ne(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Ne(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ne(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Ne(t)}}]),e}(Ce);function Wo(t,e,r,n,i){return Ho.apply(this,arguments)}function Ho(){return(Ho=he(oe.a.mark((function t(e,r,n,i,a){return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Zo(e,r,n,i,a),t.next=3,bo(e,e.gltfFormat,0);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Zo(t,e,r,n,i){if(r=Pa(t,e,r,n),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));r=Ca(t,e,r);var a=new DataView(e);if(t.gltfFormat=a.getUint32(r,!0),r=ko(t,e,r=Ra(t,e,r+=4)),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new ga(t.featureTableJson,t.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",va.FLOAT,3);new La(t.batchTableJson,t.batchTableBinary,s);return function(t,e,r,n){for(var i=[new Array(n),t._batchTable][0],a=new We,o=(new We,new We,new We,new ei),s=new Go,u=new We,c={},h=new Be,l=[],f=[],y=new We,v=new We,d=0;d<n;d++){var p=void 0;if(e.hasProperty("POSITION"))p=e.getProperty("POSITION",va.FLOAT,3,d,a);else if(e.hasProperty("POSITION_QUANTIZED")){p=e.getProperty("POSITION_QUANTIZED",va.UNSIGNED_SHORT,3,d,a);var m=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",va.FLOAT,3,y);if(!m)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var g=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",va.FLOAT,3,v);if(!g)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var k=0;k<3;k++)p[k]=p[k]/65535*g[k]+m[k]}if(!p)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(p),c.translation=a,t.normalUp=e.getProperty("NORMAL_UP",va.FLOAT,3,d,l),t.normalRight=e.getProperty("NORMAL_RIGHT",va.FLOAT,3,d,f);if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",va.UNSIGNED_SHORT,2,l),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",va.UNSIGNED_SHORT,2,f),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(gr.WGS84.eastNorthUpToFixedFrame(a,h),h.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),c.rotation=s,u.set(1,1,1);var b=e.getProperty("SCALE",va.FLOAT,1,d);Number.isFinite(b)&&u.multiplyByScalar(b);var w=e.getProperty("SCALE_NON_UNIFORM",va.FLOAT,3,d,l);w&&u.scale(w),c.scale=u;var E=e.getProperty("BATCH_ID",va.UNSIGNED_SHORT,1,d);void 0===E&&(E=d);var _=(new Be).fromQuaternion(c.rotation);h.identity(),h.translate(c.translation),h.multiplyRight(_),h.scale(c.scale);var T=h.clone();i[d]={modelMatrix:T,batchId:E}}t.instances=i}(t,o,0,s),r}function Yo(t,e,r,n,i,a){return Ko.apply(this,arguments)}function Ko(){return(Ko=he(oe.a.mark((function t(e,r,n,i,a,o){var s,u;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Pa(e,r,n,i),s=new DataView(r),e.tilesLength=s.getUint32(n,!0),n+=4,e.tiles=[];case 5:if(!(e.tiles.length<e.tilesLength&&e.byteLength-n>12)){t.next=13;break}return u={},e.tiles.push(u),t.next=10,o(r,n,i,a,u);case 10:n=t.sent,t.next=5;break;case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qo(t){return Xo.apply(this,arguments)}function Xo(){return(Xo=he(oe.a.mark((function t(e){var r,n,i,a,o=arguments;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=o.length>1&&void 0!==o[1]?o[1]:0,n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,(a=o.length>4&&void 0!==o[4]?o[4]:{}).byteOffset=r,a.type=ha(e,r),t.t0=a.type,t.next=t.t0===ia.COMPOSITE?9:t.t0===ia.BATCHED_3D_MODEL?12:t.t0===ia.INSTANCED_3D_MODEL?15:t.t0===ia.POINT_CLOUD?18:21;break;case 9:return t.next=11,Yo(a,e,r,n,i,Qo);case 11:return t.abrupt("return",t.sent);case 12:return t.next=14,wo(a,e,r,n,i);case 14:return t.abrupt("return",t.sent);case 15:return t.next=17,Wo(a,e,r,n,i);case 17:return t.abrupt("return",t.sent);case 18:return t.next=20,oo(a,e,r,n,i);case 20:return t.abrupt("return",t.sent);case 21:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Jo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};switch(i.byteOffset=e,i.type=ha(t,e),i.type){case ia.COMPOSITE:return function(t,e,r,n,i,a){r=Pa(t,e,r,n);var o=new DataView(e);for(t.tilesLength=o.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-r>12;){var s={};t.tiles.push(s),r=a(e,r,n,i,s)}return r}(i,t,e,r,n,Jo);case ia.BATCHED_3D_MODEL:return function(t,e,r,n,i){return r=_o(t,e,r,n,i),bo(t,go.EMBEDDED,0),r}(i,t,e,r,n);case ia.INSTANCED_3D_MODEL:return function(t,e,r,n,i){return r=Zo(t,e,r,n,i)}(i,t,e,r,n);case ia.POINT_CLOUD:return function(t,e,r,n,i){r=Ra(t,e,r=Ca(t,e,r=Pa(t,e,r,n))),uo(t);var a=co(t).featureTable;return ho(t,a,n),lo(t,a,n),fo(t,a),r}(i,t,e,r);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}function $o(){return($o=he(oe.a.mark((function t(e,r,n,i){var a;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},0,t.next=4,Qo(e,0,r,n,a);case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ts,es={name:"3D Tiles",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",test:["cmpt","pnts","b3dm","i3dm"],parse:function(t,e,r,n){return $o.apply(this,arguments)},parseSync:function(t,e,r,n){var i={};return Jo(t,0,e,r,i),i},binary:!0},rs={name:"3D Tileset",extensions:["json"],parse:(ts=he(oe.a.mark((function t(e){return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",JSON.parse((new TextDecoder).decode(e)));case 1:case"end":return t.stop()}}),t)}))),function(t){return ts.apply(this,arguments)}),parseTextSync:JSON.parse,testText:function(t){return t.indexOf(!1)}},ns=function(t){return void 0!==t},is=(new ei,new We),as=new We;new Be;function os(t,e,r){if(Sn(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){var n=new We(t[0],t[1],t[2]),i=new ei(t.slice(3,t.length));if(e.transform(n,n),i=new ei(e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]).multiplyRight(i),ns(r))return r.center=n,r.halfAxes=i,r;return new Ui(n,i)}(t.box,e,r);if(t.region){var n=I(t.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],h=new We(Oe((i+o)/2),Oe((s+a)/2),(u+c)/2),l=gr.WGS84.cartographicToCartesian(h,as),f=gr.WGS84.cartographicToCartesian([s,i,0]),y=gr.WGS84.cartographicToCartesian([s,o,0]),v=gr.WGS84.cartographicToCartesian([a,i,0]),d=8*(Math.abs(y[0]-f[0])+Math.abs(v[1]-f[1]));return ss([l[0],l[1],l[2],d],new Be)}if(t.sphere)return ss(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ss(t,e,r){var n=new We(t[0],t[1],t[2]);e.transform(n,n);var i=e.getScale(is),a=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*a;return ns(r)?(r.center=n,r.radius=o,r):new Bn(n,o)}var us=function(t){return null!=t},cs=new Date,hs=new We,ls=new Gi;var fs=function(){function t(e,r,n,i){fe(this,t),Sn("object"===Object(zt.a)(r)),this._tileset=e,this._header=r,this._basePath=i,this._content=null,this._contentState=aa.UNLOADED,this._gpuMemoryUsageInBytes=0,this.parent=n,this.children=[],this.refine=this._getRefine(r.refine),this.cacheNode=void 0,this.userData={},"geometricError"in r?this.geometricError=r.geometricError:(this.geometricError=this.parent&&this.parent.geometricError||e.geometricError,console.warn("3D Tile: Required prop geometricError is undefined. Using parent error")),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeCache(r),this._optimChildrenWithinParent=oa.NOT_COMPUTED,this._initializeRenderingState(),Object.seal(this)}var e;return ve(t,[{key:"destroy",value:function(){this._header=null}},{key:"isDestroyed",value:function(){return null===this._header}},{key:"getScreenSpaceError",value:function(t,e){var r=this._tileset,n=this.parent&&this.parent.geometricError||r.geometricError,i=e?n:this.geometricError;if(0===i)return 0;var a=Math.max(this._distanceToCamera,1e-7),o=i*t.height/(a*t.sseDenominator);return o-=this._getDynamicScreenSpaceError(a)}},{key:"_getDynamicScreenSpaceError",value:function(t){var e=this._tileset;if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){var r=e._dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return function(t,e){var r=t*e;return 1-Math.exp(-r*r)}(t,r)*n}return 0}},{key:"loadContent",value:(e=he(oe.a.mark((function t(){var e,r,i;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=function(t){return t._visible?t._contentState===aa.UNLOADED?-1:Math.max(1e7-t._priority,0)||0:-1},!this.hasEmptyContent){t.next=3;break}return t.abrupt("return",!1);case 3:if(!this._content){t.next=5;break}return t.abrupt("return",!0);case 5:return this.contentExpired&&(this.expireDate=void 0),this._contentState=aa.LOADING,t.next=10,this.tileset._requestScheduler.scheduleRequest(this,e);case 10:if(t.sent){t.next=14;break}return this._contentState=aa.UNLOADED,t.abrupt("return",!1);case 14:return t.prev=14,r=this.uri,t.prev=16,this.tileset._requestScheduler.startRequest(this),t.next=20,En(r,this.tileset.options.fetchOptions);case 20:i=t.sent;case 21:return t.prev=21,this.tileset._requestScheduler.endRequest(this),t.finish(21);case 24:return t.next=26,dn(i,[es,rs]);case 26:return this._content=t.sent,-1!==r.indexOf(".json")&&this._tileset._initializeTileHeaders(this._content,this,n.dirname(this.uri)),this._contentState=aa.READY,this._contentLoaded(),t.abrupt("return",!0);case 33:throw t.prev=33,t.t0=t.catch(14),this._contentState=aa.FAILED,t.t0;case 37:case"end":return t.stop()}}),t,this,[[14,33],[16,,21,24]])}))),function(){return e.apply(this,arguments)})},{key:"unloadContent",value:function(){return!!this.hasRenderContent&&(this._content&&this._content.destroy&&this._content.destroy(),this._content=null,this._contentState=aa.UNLOADED,!0)}},{key:"updateVisibility",value:function(t){var e=this._tileset;if(this._updatedVisibilityFrame!==e._updatedVisibilityFrame){var r=this.parent,n=r?r.computedTransform:this._tileset.modelMatrix,i=r?r._visibilityPlaneMask:Ki.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==Ki.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._updatedVisibilityFrame=e._updatedVisibilityFrame}}},{key:"updateExpiration",value:function(){if(us(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var t=Date.now(cs);Date.lessThan(this.expireDate,t)&&(this._contentState=aa.EXPIRED,this._expiredContent=this._content)}}},{key:"visibility",value:function(t,e){var r=t.cullingVolume,n=this.boundingVolume,i=this.tileset,a=i.clippingPlanes,o=i.clippingPlanesOriginMatrix;if(a&&a.enabled){var s=a.computeIntersectionWithBoundingVolume(n,o);if(this._isClipped=s!==Dn.INSIDE,s===Dn.OUTSIDE)return Ki.MASK_OUTSIDE}return function(t,e,r){if(Sn(e,"boundingVolume is required."),Sn(Number.isFinite(r),"parentPlaneMask is required."),r===Ki.MASK_OUTSIDE||r===Ki.MASK_INSIDE)return r;for(var n=Ki.MASK_INSIDE,i=t.planes,a=0;a<t.planes.length;++a){var o=a<31?1<<a:0;if(!(a<31&&0==(r&o))){var s=ls.fromNormalDistance(i[a].normal,i[a].distance),u=e.intersectPlane(s);if(u===Dn.OUTSIDE)return Ki.MASK_OUTSIDE;u===Dn.INTERSECTING&&(n|=o)}}return n}(r,n,e)}},{key:"contentVisibility",value:function(t){return!0}},{key:"distanceToTile",value:function(t){var e=this._boundingVolume;return Math.sqrt(e.distanceSquaredTo(t.camera.position))}},{key:"cameraSpaceZDepth",value:function(t){var e=t.camera,r=this.boundingVolume;return hs.subVectors(r.center,e.position),e.direction.dot(hs)}},{key:"insideViewerRequestVolume",value:function(t){var e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}},{key:"_initializeCache",value:function(t){this.cacheNode=void 0;var e,r,n=t.expire;n&&(e=n.duration,n.date&&(r=Date.fromIso8601(n.date))),this.expireDuration=e,this.expireDate=r}},{key:"_initializeTransforms",value:function(t){this.transform=t.transform?new Be(t.transform):new Be;var e=this.parent,r=this._tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Be(n).multiplyRight(this.transform);var i=e&&e._initialTransform?e._initialTransform.clone():new Be;this._initialTransform=new Be(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(t){this._boundingVolume=os(t.boundingVolume,this.computedTransform),this._contentBoundingVolume=null,this._viewerRequestVolume=null,t.content&&t.content.boundingVolume&&(this._contentBoundingVolume=os(t.boundingVolume,this.computedTransform)),t.viewerRequestVolume&&(this._viewerRequestVolume=os(t.viewerRequestVolume,this.computedTransform))}},{key:"_initializeContent",value:function(t){this._content={_tileset:this._tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=aa.UNLOADED,this._expiredContent=void 0,this._serverKey=null,this.hasTilesetContent=!1,t.content&&(this.contentUri=t.content.uri||t.content.url,"url"in t&&(console.warn('Tileset 3D: "content.url" property deprecated. Use "content.uri" instead.'),this.contentUri=t.url),this._content=null,this.hasEmptyContent=!1,this.contentState=aa.UNLOADED,this.fullUri=this._basePath+"/"+this.contentUri)}},{key:"_initializeRenderingState",value:function(){this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Ki.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._priority=0}},{key:"_getRefine",value:function(t){switch(t){case"REPLACE":case"replace":return ua;case"ADD":case"add":return sa;default:return this.parent?this.parent.refine:ua}}},{key:"_isTileset",value:function(t){return Boolean(t.asset)}},{key:"_contentLoaded",value:function(){switch(this._content&&this._content.type){case"vctr":case"geom":tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset(this._content)&&(this.hasTilesetContent=!0)}},{key:"_updateTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Be,e=t.clone().multiplyRight(this.transform),r=!e.equals(this.computedTransform);if(r){this.computedTransform=e;var n=this._header,i=this._header.content;this._boundingVolume=os(n.boundingVolume,this.computedTransform,this._boundingVolume),this._contentBoundingVolume&&(this._contentBoundingVolume=os(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),this._viewerRequestVolume&&(this._viewerRequestVolume=os(n.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume))}}},{key:"gpuMemoryUsageInBytes",get:function(){return this._gpuMemoryUsageInBytes}},{key:"tileset",get:function(){return this._tileset}},{key:"depth",get:function(){return this._depth}},{key:"selectedFrame",get:function(){return this._selectedFrame}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"content",get:function(){return this._content}},{key:"contentReady",get:function(){return this._contentState===aa.READY}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"contentAvailable",get:function(){return this.contentReady&&this.hasRenderContent||us(this._expiredContent)&&!this.contentFailed}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this._contentState===aa.UNLOADED}},{key:"contentExpired",get:function(){return this._contentState===aa.EXPIRED}},{key:"contentFailed",get:function(){return this._contentState===aa.FAILED}},{key:"url",get:function(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}},{key:"uri",get:function(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}},{key:"boundingVolume",get:function(){return this._boundingVolume}},{key:"contentBoundingVolume",get:function(){return this._contentBoundingVolume||this._boundingVolume}},{key:"boundingSphere",get:function(){return this._boundingVolume.boundingSphere}},{key:"extras",get:function(){return this._header.extras}}]),t}();var ys=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;fe(this,t),this._array=new Array(e),this._length=e}return ve(t,[{key:"get",value:function(t){return Sn(t<this._array.length),this._array[t]}},{key:"set",value:function(t,e){Sn(t>=0),t>=this.length&&(this.length=t+1),this._array[t]=e}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(t){var e=this.length++;this._array[e]=t}},{key:"pop",value:function(){return this._array[--this.length]}},{key:"reserve",value:function(t){Sn(t>=0),t>this._array.length&&(this._array.length=t)}},{key:"resize",value:function(t){Sn(t>=0),this.length=t}},{key:"trim",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.length;this._array.length=t}},{key:"length",get:function(){return this._length},set:function(t){this._length=t,t>this._array.length&&(this._array.length=t)}},{key:"values",get:function(){return this._array}}]),t}(),vs=function(){function t(){fe(this,t),this.traversal={stack:new ys,stackMaximumLength:0},this.emptyTraversal={stack:new ys,stackMaximumLength:0},this.result={_requestedTiles:[],selectedTiles:[],_emptyTiles:[],_hasMixedContent:!1},this._disableSkipLevelOfDetail=!1}return ve(t,[{key:"traverse",value:function(t,e,r){if(this.root=t,this.options=r,this.result._requestedTiles.length=0,this.result.selectedTiles.length=0,this.result._emptyTiles.length=0,this.result._hasMixedContent=!1,this.updateTile(t,e),!t.isVisibleAndInRequestVolume)return!1;if(t.getScreenSpaceError(e,!0)<=r.maximumScreenSpaceError)return!1;var n=r.maximumScreenSpaceError;return this.executeTraversal(t,n,e),this.traversal.stack.trim(this.traversal.stackMaximumLength),this.emptyTraversal.stack.trim(this.emptyTraversal.stackMaximumLength),!0}},{key:"selectTile",value:function(t,e){t._selectedFrame=e.frameNumber,this.result.selectedTiles.push(t)}},{key:"selectDesiredTile",value:function(t,e){if(this.options.skipLevelOfDetail){var r=t.contentAvailable?t:t._ancestorWithContentAvailable;r?r._shouldSelect=!0:this.selectDescendants(t,e)}else t.contentAvailable&&this.selectTile(t,e)}},{key:"visitTile",value:function(t,e,r){++t._statistics.visited,e._visitedFrame=r.frameNumber}},{key:"touchTile",value:function(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}},{key:"getPriority",value:function(t,e){switch(t.refine){case sa:return t._distanceToCamera;case ua:var r=t.parent,n=r&&(!e.skipLevelOfDetail||0===t._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-n;default:return Sn(!1)}}},{key:"loadTile",value:function(t,e){(t.hasUnloadedContent||t.contentExpired)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t,this.options),this.result._requestedTiles.push(t))}},{key:"updateTileVisibility",value:function(t,e){t.updateVisibility(e)}},{key:"updateTile",value:function(t,e){this.updateTileVisibility(t,e),t.updateExpiration()}},{key:"updateAndPushChildren",value:function(t,e,r){var n=t.children,i=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;this.updateTile(c,r),e.push(c)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return!0}},{key:"canTraverse",value:function(t,e){return!(0===t.children.length||e.depthLimit<t.depth)&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e.maximumScreenSpaceError)}},{key:"executeTraversal",value:function(t,e,r){var n=this.traversal,i=n.stack;for(i.push(t);i.length>0;){n.stackMaximumLength=Math.max(n.stackMaximumLength,i.length);var a=i.pop(),o=a.refine===sa,s=a.refine===ua,u=a.parent,c=!u||u._refines,h=!1;this.canTraverse(a,this.options)&&(h=this.updateAndPushChildren(a,i,r)&&c);var l=!h&&c;a.hasRenderContent?o?(this.loadTile(a,r),this.selectDesiredTile(a,r)):s&&(this.loadTile(a,r),l&&this.selectDesiredTile(a,r)):(this.result._emptyTiles.push(a),this.loadTile(a,r),l&&this.selectDesiredTile(a,r)),this.touchTile(a,r),a._refines=h}}}]),t}(),ds=function t(e,r,n){fe(this,t),this.item=e,this.previous=r,this.next=n},ps=function(t){return void 0!==t},ms=function(){function t(){fe(this,t),this.head=void 0,this.tail=void 0,this._length=0}return ve(t,[{key:"add",value:function(t){var e=new ds(t,this.tail,void 0);return ps(this.tail)?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}},{key:"remove",value:function(t){ps(t)&&(ps(t.previous)&&ps(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):ps(t.previous)?(t.previous.next=void 0,this.tail=t.previous):ps(t.next)?(t.next.previous=void 0,this.head=t.next):(this.head=void 0,this.tail=void 0),t.next=void 0,t.previous=void 0,--this._length)}},{key:"splice",value:function(t,e){if(t!==e){this.remove(e);var r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t}}},{key:"length",get:function(){return this._length}}]),t}(),gs=function(t){return void 0!==t},ks=function(){function t(){fe(this,t),this._list=new ms,this._sentinel=this._list.add(),this._trimTiles=!1}return ve(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(t){var e=t.cacheNode;gs(e)&&this._list.splice(this._sentinel,e)}},{key:"add",value:function(t,e,r){gs(e.cacheNode)||(e.cacheNode=this._list.add(e),r&&r(t,e))}},{key:"unloadTile",value:function(t,e,r){var n=e.cacheNode;gs(n)&&(this._list.remove(n),e.cacheNode=void 0,r&&r(t,e))}},{key:"unloadTiles",value:function(t,e){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*t.maximumMemoryUsage*1024,a=this._sentinel,o=n.head;o!==a&&(t.gpuMemoryUsageInBytes>i||r);){var s=o.item;o=o.next,this.unloadTile(t,s,e)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}();function bs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var ws=6378137,Es=6378137,_s=6356752.314245179;var Ts={basePath:"",ellipsoid:gr.WGS84,modelMatrix:new Be,throttleRequests:!1,maximumScreenSpaceError:16,maximumMemoryUsage:32,dynamicScreenSpaceError:!1,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:4,skipLevelOfDetail:!1,baseScreenSpaceError:1024,onTileLoad:function(){},onTileUnload:function(){},onTileLoadFail:function(t,e,r){return console.error("A 3D tile failed to load: ".concat(r," ").concat(e))}};var Ss=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};fe(this,t),Sn(e),this.options=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bs(r,!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bs(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},Ts,{},i),this.url=r,this.basePath=n.dirname(r),this.modelMatrix=this.options.modelMatrix,this.stats=new Tr({id:r}),this._initializeStats(),this.gpuMemoryUsageInBytes=0,this.geometricError=void 0,this.userData={},this._queryParams={},this._requestScheduler=new An({throttleRequests:this.options.throttleRequests}),this._traverser=new vs,this._cache=new ks,this._processingQueue=[],this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.asset={},this.credits={},this._root=void 0,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._extras=void 0,this._allTilesAdditive=!0,this._hasMixedContent=!1,this._maximumScreenSpaceError=i.maximumScreenSpaceError,this._maximumMemoryUsage=i.maximumMemoryUsage,this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._readyPromise=Promise.resolve(),this._classificationType=this.options.classificationType,this._ellipsoid=this.options.ellipsoid,this._dynamicScreenSpaceErrorComputedDensity=0,this._initializeTileSet(e,this.options)}var e;return ve(t,[{key:"destroy",value:function(){this._destroy()}},{key:"getTileUrl",value:function(t,e){return t.startsWith("data:")?t:"".concat(e||this.basePath,"/").concat(t).concat(this.queryParams)}},{key:"hasExtension",value:function(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}},{key:"update",value:function(t){this._updatedVisibilityFrame++,this._cache.reset(),this._traverser.traverse(this.root,t,this.options),Object.assign(this,this._traverser.result);var e=this._requestedTiles,r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;this._loadTile(s)}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}this._unloadTiles();var u=0,c=0,h=!0,l=!1,f=void 0;try{for(var y,v=this.selectedTiles[Symbol.iterator]();!(h=(y=v.next()).done);h=!0){var d=y.value;d.contentAvailable&&(u++,d.content.pointCount&&(c+=d.content.pointCount))}}catch(t){l=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(l)throw f}}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=u,this.stats.get("Points").count=c}},{key:"trimLoadedTiles",value:function(){this._cache.trim()}},{key:"addTileToCache",value:function(t){this._cache.add(this,t,(function(t,e){return t._addTileToCache(e)}))}},{key:"_initializeTileSet",value:function(t,e){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:e.attributions||[]},this._properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this._extras=t.extras,this._root=this._initializeTileHeaders(t,null,this.basePath),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var t=this._root,e=t.boundingVolume.center;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new We,void(this.zoom=16);this.cartographicCenter=gr.WGS84.cartesianToCartographic(e,new We),this.zoom=function(t){var e=t.halfAxes,r=t.radius,n=t.width,i=t.height;if(e){var a=I(e,9),o=a[0],s=a[4],u=a[8];return(Math.log2(ws/o/2)+Math.log2(Es/s/2)+Math.log2(_s/u/2))/3}return r?Math.log2(_s/r):i&&n?(Math.log2(ws/n)+Math.log2(Es/i))/2:18}(t.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(t,e,r){var n=new fs(this,t.root,e,r);e&&(e.children.push(n),n._depth=e._depth+1);var i=[];for(i.push(n);i.length>0;){var a=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var o=a._header.children||[],s=!0,u=!1,c=void 0;try{for(var h,l=o[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,y=new fs(this,f,a,r);a.children.push(y),y._depth=a._depth+1,i.push(y)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}}return n}},{key:"_destroyTileHeaders",value:function(t){this._destroySubtree(t)}},{key:"_loadTile",value:(e=he(oe.a.mark((function t(e){var r;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.stats.get("Tiles Loading").incrementCount(),t.prev=1,t.next=4,e.loadContent();case 4:r=t.sent,t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(1),this.stats.get("Tiles Loading").decrementCount(),this.stats.get("Failed Tile Loads").incrementCount(),this.options.onTileLoadFail(e,t.t0.message||t.t0.toString(),e.url),t.abrupt("return");case 13:if(this.stats.get("Tiles Loading").decrementCount(),r){t.next=16;break}return t.abrupt("return");case 16:e&&e._content&&Rn(e,e._content),this.options.onTileLoad(e);case 18:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t){return e.apply(this,arguments)})},{key:"_addTileToCache",value:function(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t._content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(t){this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.gpuMemoryUsageInBytes-=t._content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(t,e){return t._unloadTile(e)}))}},{key:"_destroy",value:function(){var t=[];for(this._root&&t.push(this._root);t.length>0;){var e=!0,r=!1,n=void 0;try{for(var i,a=s.children[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;t.push(o)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}var s=t.pop();s.destroy()}this._root=null}},{key:"_destroySubtree",value:function(t){var e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();var n=!0,i=!1,a=void 0;try{for(var o,s=t.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;r.push(u)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}t!==e&&this._destroyTile(t)}e.children=[]}},{key:"_destroyTile",value:function(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}},{key:"properties",get:function(){return this._properties}},{key:"ready",get:function(){return Boolean(this._root)}},{key:"readyPromise",get:function(){return this._readyPromise.promise}},{key:"tilesLoaded",get:function(){return this._tilesLoaded}},{key:"queryParams",get:function(){return function(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push("".concat(i,"=").concat(t[i]))}switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)}},{key:"root",get:function(){return this._root}},{key:"boundingSphere",get:function(){return this._checkReady(),this._root.updateTransform(this.modelMatrix),this._root.boundingSphere}},{key:"timeSinceLoad",get:function(){return this._timeSinceLoad}},{key:"maximumMemoryUsage",get:function(){return this._maximumMemoryUsage},set:function(t){Sn(t>0),this._maximumMemoryUsage=t}},{key:"ellipsoid",get:function(){return this.options.ellipsoid}},{key:"extras",get:function(){return this._extras}}]),t}();function xs(t){return Os.apply(this,arguments)}function Os(){return(Os=he(oe.a.mark((function t(e){var r;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): "),t.prev=1,!e.headers.get("Content-Type").includes("application/json")){t.next=10;break}return t.t0=r,t.next=7,e.text();case 7:r=t.t0+=t.sent,t.next=11;break;case 10:r+=e.statusText;case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(1),t.abrupt("return",r);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}var Ms="https://api.cesium.com/v1/assets";function Ns(t,e){return Ls.apply(this,arguments)}function Ls(){return(Ls=he(oe.a.mark((function t(e,r){var n,i,a,o,s,u,c,h,l,f;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=23;break}return t.next=3,Is(e);case 3:for(n=t.sent,i=!0,a=!1,o=void 0,t.prev=7,s=n.items[Symbol.iterator]();!(i=(u=s.next()).done);i=!0)"3DTILES"===(c=u.value).type&&(r=c.id);t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),a=!0,o=t.t0;case 15:t.prev=15,t.prev=16,i||null==s.return||s.return();case 18:if(t.prev=18,!a){t.next=21;break}throw o;case 21:return t.finish(18);case 22:return t.finish(15);case 23:return t.next=25,As(e,r);case 25:return h=t.sent,l=h.type,f=h.url,Sn("3DTILES"===l&&f),h.headers={Authorization:"Bearer ".concat(h.accessToken)},t.abrupt("return",h);case 30:case"end":return t.stop()}}),t,null,[[7,11,15,23],[16,,18,22]])})))).apply(this,arguments)}function Is(t){return Ps.apply(this,arguments)}function Ps(){return(Ps=he(oe.a.mark((function t(e){var r,n,i;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Sn(e),r=Ms,n={Authorization:"Bearer ".concat(e)},t.next=5,fetch(r,{headers:n});case 5:if((i=t.sent).ok){t.next=12;break}return t.t0=Error,t.next=10,xs(i);case 10:throw t.t1=t.sent,new t.t0(t.t1);case 12:return t.next=14,i.json();case 14:return t.abrupt("return",t.sent);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function As(t,e){return Cs.apply(this,arguments)}function Cs(){return(Cs=he(oe.a.mark((function t(e,r){var n,i,a;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Sn(e,r),n="".concat(Ms,"/").concat(r,"/endpoint"),i={Authorization:"Bearer ".concat(e)},t.next=5,fetch(n,{headers:i});case 5:if((a=t.sent).ok){t.next=12;break}return t.t0=Error,t.next=10,xs(a);case 10:throw t.t1=t.sent,new t.t0(t.t1);case 12:return t.next=14,a.json();case 14:return t.abrupt("return",t.sent);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Rs=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Ht(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(Gt)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Wt(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Xt(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(Gt.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}(Ae(Array));function Ds(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function zs(t,e,r){if(Gt.debug&&!function(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|r," some fields set to invalid numbers'"));return t}var js={};function qs(t,e){js[t]||(js[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}var Us=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Ds(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Ds(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Ft(t>=0&&t<this.ELEMENTS,"index is out of range"),Ds(this[t])}},{key:"setComponent",value:function(t,e){return Ft(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Ds(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Ds(t)}}]),e}(Rs);function Fs(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}function Bs(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*a,t[1]=r[1]*n+r[4]*i+r[7]*a,t[2]=r[2]*n+r[5]*i+r[8]*a,t[3]=e[3],t}var Vs=[0,0,0],Gs=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0)),1===arguments.length&&Ht(r)?t.copy(r):(Gt.debug&&(Ds(r),Ds(n),Ds(i)),t[0]=r,t[1]=n,t[2]=i),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return Gt.debug&&(Ds(t.x),Ds(t.y),Ds(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return mt(this,t)}},{key:"cross",value:function(t){return ht(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return vt(this,this,void 0===r?Vs:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return dt(this,this,void 0===r?Vs:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return pt(this,this,void 0===r?Vs:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return lt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Fs(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return ft(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return yt(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ds(t)}}]),e}(Us),Ws=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),Hs=new Gs,Zs=new Gs,Ys=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;fe(this,t),n=n||Hs.copy(e).add(r).scale(.5),this.minimum=new Gs(e),this.maximum=new Gs(r),this.center=new Gs(n)}ve(t,[{key:"fromPoints",value:function(t){if(!t||0===t.length)return this.minimum.set(0,0,0),this.maximum.set(0,0,0),this.center.set(0,0,0),this;var e=t[0][0],r=t[0][1],n=t[0][2],i=t[0][0],a=t[0][1],o=t[0][2],s=!0,u=!1,c=void 0;try{for(var h,l=t[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var f=h.value,y=f[0],v=f[1],d=f[2];e=Math.min(y,e),i=Math.max(y,i),r=Math.min(v,r),a=Math.max(v,a),n=Math.min(d,n),o=Math.max(d,o)}}catch(t){u=!0,c=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}return this.minimum.set(e,r,n),this.maximum.set(i,a,o),this.center.copy(this.minimum).add(this.maximum).scale(.5),this}},{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=Hs.copy(this.maximum).subtract(this.minimum).scale(.5),r=Zs.from(t.normal),n=e.x*Math.abs(r.x)+e.y*Math.abs(r.y)+e.z*Math.abs(r.z),i=this.center.dot(r)+t.distance;return i-n>0?Ws.INSIDE:i+n<0?Ws.OUTSIDE:Ws.INTERSECTING}}])}(),new Gs),Ks=new Gs,Qs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fe(this,t),this.radius=-0,this.center=new Gs,this.fromCenterRadius(e,r)}return ve(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=Ys.from(e),this.center=(new Gs).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.center,i=t.radius,a=Ys.copy(n).subtract(e),o=a.magnitude();if(r>=o+i)return this.clone();if(i>=o+r)return t.clone();var s=.5*(r+o+i);return Ks.copy(a).scale((-r+s)/o).add(e),this.center.copy(Ks),this.radius=s,this}},{key:"expand",value:function(t){var e=(t=Ys.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?Ws.OUTSIDE:n<r?Ws.INTERSECTING:Ws.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=X(Ys,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=Ys.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}(),Xs=function(t){function e(){return fe(this,e),de(this,pe(e).apply(this,arguments))}return me(e,t),ve(e,[{key:"toString",value:function(){var t="[";if(Gt.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=Ds(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),e}(Rs),Js=Object.freeze([1,0,0,0,1,0,0,0,1]),$s=Object.freeze([0,0,0,0,0,0,0,0,0]),tu=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),eu={},ru=function(t){function e(t){var r;return fe(this,e),r=de(this,pe(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return me(e,t),ve(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return tu}}],[{key:"IDENTITY",get:function(){return eu.IDENTITY=eu.IDENTITY||Object.freeze(new e(Js)),eu.IDENTITY}},{key:"ZERO",get:function(){return eu.ZERO=eu.ZERO||Object.freeze(new e($s)),eu.ZERO}}]),ve(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=u,this.check()}},{key:"determinant",value:function(){return Wn(this)}},{key:"identity",value:function(){return this.copy(Js)}},{key:"fromQuaternion",value:function(t){return Qn(this,t),this.check()}},{key:"transpose",value:function(){return Vn(this,this),this.check()}},{key:"invert",value:function(){return Gn(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return Hn(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return Hn(this,this,t),this.check()}},{key:"rotate",value:function(t){return Yn(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?Kn(this,this,t):Kn(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return Zn(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=nt(e||[-0,-0],t,this);break;case 3:e=ft(e||[-0,-0,-0],t,this);break;case 4:e=Bs(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return zs(e,t.length),e}},{key:"transformVector",value:function(t,e){return qs("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return qs("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return qs("Matrix3.transformVector"),this.transform(t,e)}}]),e}(Xs),nu={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI},iu=new ru,au=new ru,ou=new ru,su=new ru,uu=new ru;function cu(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=nu.EPSILON20,n=0,i=0,a=au,o=ou;a.identity(),o.copy(t);for(var s=r*function(t){for(var e=0,r=0;r<9;++r){var n=t[r];e+=n*n}return Math.sqrt(e)}(o);i<10&&fu(o)>s;)yu(o,su),uu.copy(su).transpose(),o.multiplyRight(su),o.multiplyLeft(uu),a.multiplyRight(su),++n>2&&(++i,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}var hu=[1,0,0],lu=[2,2,1];function fu(t){for(var e=0,r=0;r<3;++r){var n=t[iu.getElementIndex(lu[r],hu[r])];e+=2*n*n}return Math.sqrt(e)}function yu(t,e){for(var r=nu.EPSILON15,n=0,i=1,a=0;a<3;++a){var o=Math.abs(t[iu.getElementIndex(lu[a],hu[a])]);o>n&&(i=a,n=o)}var s=hu[i],u=lu[i],c=1,h=0;if(Math.abs(t[iu.getElementIndex(u,s)])>r){var l,f=(t[iu.getElementIndex(u,u)]-t[iu.getElementIndex(s,s)])/2/t[iu.getElementIndex(u,s)];h=(l=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(c=1/Math.sqrt(1+l*l))}return ru.IDENTITY.to(e),e[iu.getElementIndex(s,s)]=e[iu.getElementIndex(u,u)]=c,e[iu.getElementIndex(u,s)]=h,e[iu.getElementIndex(s,u)]=-h,e}var vu=new Gs,du=new Gs,pu=new Gs,mu=new Gs,gu=new Gs,ku=new ru,bu={diagonal:new ru,unitary:new ru};function wu(t,e){if(!t||0===t.length)return e.halfAxes=new ru([0,0,0,0,0,0,0,0,0]),e.center=new Gs,e;var r=t.length,n=new Gs(0,0,0),i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;n.add(c)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}var h=1/r;n.multiplyByScalar(h);var l=0,f=0,y=0,v=0,d=0,p=0,m=!0,g=!1,k=void 0;try{for(var b,w=t[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var E=b.value,_=vu.copy(E).subtract(n);l+=_.x*_.x,f+=_.x*_.y,y+=_.x*_.z,v+=_.y*_.y,d+=_.y*_.z,p+=_.z*_.z}}catch(t){g=!0,k=t}finally{try{m||null==w.return||w.return()}finally{if(g)throw k}}l*=h,f*=h,y*=h,v*=h,d*=h,p*=h;var T=ku;T[0]=l,T[1]=f,T[2]=y,T[3]=f,T[4]=v,T[5]=d,T[6]=y,T[7]=d,T[8]=p;var S=cu(T,bu).unitary,x=e.halfAxes.copy(S),O=x.getColumn(0,pu),M=x.getColumn(1,mu),N=x.getColumn(2,gu),L=-Number.MAX_VALUE,I=-Number.MAX_VALUE,P=-Number.MAX_VALUE,A=Number.MAX_VALUE,C=Number.MAX_VALUE,R=Number.MAX_VALUE,D=!0,z=!1,j=void 0;try{for(var q,U=t[Symbol.iterator]();!(D=(q=U.next()).done);D=!0){var F=q.value;L=Math.max(F.dot(O),L),I=Math.max(F.dot(M),I),P=Math.max(F.dot(N),P),A=Math.min(F.dot(O),A),C=Math.min(F.dot(M),C),R=Math.min(F.dot(N),R)}}catch(t){z=!0,j=t}finally{try{D||null==U.return||U.return()}finally{if(z)throw j}}O=O.multiplyByScalar(.5*(A+L)),M=M.multiplyByScalar(.5*(C+I)),N=N.multiplyByScalar(.5*(R+P)),e.center.copy(O).add(M).add(N);var B=du.set(L-A,I-C,P-R).multiplyByScalar(.5);return e.halfAxes.multiplyByScalar(B),e}var Eu=new Gs,_u=new Gs,Tu=new Gs,Su=new Gs,xu=new Gs,Ou=new Gs,Mu=new Gs,Nu=new Gs,Lu=new Gs,Iu=new Gs,Pu=new Gs,Au=0,Cu=1,Ru=2,Du=3,zu=4,ju=5,qu=6,Uu=7,Fu=8,Bu=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];fe(this,t),this.center=(new Gs).from(e),this.halfAxes=new ru(r)}ve(t,[{key:"clone",value:function(e){return new t(this.center,this.halfAxes)}},{key:"fromPoints",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;return wu(e,r)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qs,e=this.halfAxes,r=e.getColumn(0,Lu),n=e.getColumn(1,Iu),i=e.getColumn(2,Pu),a=Eu.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=a.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,a=r.y,o=r.z,s=Math.abs(i*n[Au]+a*n[Cu]+o*n[Ru])+Math.abs(i*n[Du]+a*n[zu]+o*n[ju])+Math.abs(i*n[qu]+a*n[Uu]+o*n[Fu]),u=r.dot(e)+t.distance;return u<=-s?Ws.OUTSIDE:u>=s?Ws.INSIDE:Ws.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=_u.copy(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Tu),i=r.getColumn(1,Su),a=r.getColumn(2,xu),o=n.magnitude(),s=i.magnitude(),u=a.magnitude();n.normalize(),i.normalize(),a.normalize();var c=Ou;c.x=e.dot(n),c.y=e.dot(i),c.z=e.dot(a);var h,l=0;return c.x<-o?l+=(h=c.x+o)*h:c.x>o&&(l+=(h=c.x-o)*h),c.y<-s?l+=(h=c.y+s)*h:c.y>s&&(l+=(h=c.y-s)*h),c.z<-u?l+=(h=c.z+u)*h:c.z>u&&(l+=(h=c.z-u)*h),l}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,Tu),u=o.getColumn(1,Su),c=o.getColumn(2,xu),h=Mu.copy(s).add(u).add(c).add(a),l=Nu.copy(h).subtract(t),f=e.dot(l);return n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(a).add(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),a.copy(h).subtract(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),r.start=n,r.stop=i,r}},{key:"getTransform",value:function(){}}])}(),function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return fe(this,e),t=de(this,pe(e).call(this,-0,-0,-0,-0)),Ht(r)&&1===arguments.length?t.copy(r):(Gt.debug&&(Ds(r),Ds(n),Ds(i),Ds(a)),t[0]=r,t[1]=n,t[2]=i,t[3]=a),t}return me(e,t),ve(e,[{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"fromObject",value:function(t){return Gt.debug&&(Ds(t.x),Ds(t.y),Ds(t.z),Ds(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}},{key:"transform",value:function(t){return lt(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return Bs(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return yt(this,this,t),this.check()}},{key:"applyMatrix4",value:function(t){return t.transform(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Ds(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Ds(t)}}]),e}(Us)),Vu=new Gs,Gu=new Gs,Wu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fe(this,t),this.normal=new Gs,this.distance=-0,this.fromNormalDistance(e,r)}return ve(t,[{key:"fromNormalDistance",value:function(t,e){return Ft(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=Vu.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),Ft(1===this.normal.len()),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return Xt(this.distance,t.distance)&&Xt(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=Gu.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=Vu.from(t);var r=this.getPointDistance(t),n=Gu.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}(),Hu=[new Gs([1,0,0]),new Gs([0,1,0]),new Gs([0,0,1])],Zu=new Gs,Yu=new Gs,Ku=new Wu(new Gs(1,0,0),0),Qu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];fe(this,t),this.planes=e,Ft(this.planes.every((function(t){return t instanceof Wu})))}return ve(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),ve(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*Hu.length;for(var e=t.center,r=t.radius,n=0,i=0,a=Hu;i<a.length;i++){var o=a[i],s=this.planes[n],u=this.planes[n+1];s||(s=this.planes[n]=new Bu),u||(u=this.planes[n+1]=new Bu);var c=Zu.copy(o).scale(-r).add(e),h=-o.dot(c);s.x=o.x,s.y=o.y,s.z=o.z,s.w=h;var l=Zu.copy(o).scale(r).add(e),f=Yu.copy(o).negate(),y=-f.dot(l);u.x=f.x,u.y=f.y,u.z=f.z,u.w=y,n+=2}return this}},{key:"computeVisibility",value:function(t){Ft(t);var e=Ws.INSIDE,r=!0,n=!1,i=void 0;try{for(var a,o=this.planes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,u=Ku.fromCoefficients.apply(Ku,Ut(s));switch(t.intersectPlane(u)){case Ws.OUTSIDE:return Ws.OUTSIDE;case Ws.INTERSECTING:e=Ws.INTERSECTING}}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return e}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(Ft(e,"boundingVolume is required."),Ft(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,a=0;a<this.planes.length;++a){var o=a<31?1<<a:0;if(!(a<31&&0==(r&o))){var s=Ku.fromCoefficients.apply(Ku,Ut(i[a])),u=e.intersectPlane(s);if(u===Ws.OUTSIDE)return t.MASK_OUTSIDE;u===Ws.INTERSECTING&&(n|=o)}}return n}}]),t}(),Xu=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ju=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),$u=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),tc={},ec=function(t){function e(t){var r;return fe(this,e),r=de(this,pe(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return me(e,t),ve(e,[{key:"INDICES",get:function(){return $u}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return tc.IDENTITY=tc.IDENTITY||Object.freeze(new e(Xu)),tc.IDENTITY}},{key:"ZERO",get:function(){return tc.ZERO=tc.ZERO||Object.freeze(new e(Ju)),tc.ZERO}}]),ve(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,y,v,d){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=y,this[14]=v,this[15]=d,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u,c,h,l,f,y,v,d){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=c,this[7]=y,this[8]=r,this[9]=o,this[10]=h,this[11]=v,this[12]=n,this[13]=s,this[14]=l,this[15]=d,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(Xu)}},{key:"fromQuaternion",value:function(t){return J(this,t),this.check()}},{key:"frustum",value:function(t){var r=t.left,n=t.right,i=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?e._computeInfinitePerspectiveOffCenter(this,r,n,i,a,o):$(this,r,n,i,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return rt(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,a=t.near,o=void 0===a?.1:a,s=t.far;return et(this,e,r,n,i,o,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.focalDistance,s=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,y=s*Math.tan(f),v=y*a;return(new e).ortho({left:-v,right:v,bottom:-y,top:y,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,n=void 0===r?45*Math.PI/180:r,i=t.aspect,a=void 0===i?1:i,o=t.near,s=void 0===o?.1:o,u=t.far,c=void 0===u?500:u;if((e=e||n)>2*Math.PI)throw Error("radians");return tt(this,e,a,s,c),this.check()}},{key:"determinant",value:function(){return V(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*a,t}},{key:"transpose",value:function(){return F(this,this),this.check()}},{key:"invert",value:function(){return B(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return G(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return G(this,this,t),this.check()}},{key:"rotateX",value:function(t){return Y(this,this,t),this.check()}},{key:"rotateY",value:function(t){return K(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return Q(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=I(t,3),r=e[0],n=e[1],i=e[2];return this.rotateX(r).rotateY(n).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return Z(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?H(this,this,t):H(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return W(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(zs(e=z(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=it(e||[-0,-0],t,this);break;case 3:e=lt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return zs(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}(e||[-0,-0],t,this);break;case 3:e=Fs(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return zs(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return qs("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return qs("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return qs("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,a){var o=2*a/(r-e),s=2*a/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),e}(Xs),rc=new Gs,nc=new Gs,ic=new Gs,ac=new Gs,oc=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fe(this,t),e=Qi({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new Qu,this._perspectiveMatrix=new ec,this._infinitePerspective=new ec}return ve(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,r){Ft(t,"position is required."),Ft(e,"direction is required."),Ft(r,"up is required.");var n=this._cullingVolume.planes,i=rc.copy(e).cross(r),a=nc.copy(e).multiplyByScalar(this.near).add(t),o=ic.copy(e).multiplyByScalar(this.far).add(t),s=ac;s.copy(i).multiplyByScalar(this.left).add(a).subtract(t).normalize().cross(r).normalize(),n[0]=n[0]||new Bu;var u=n[0];return u.x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(i).multiplyByScalar(this.right).add(a).subtract(t).normalize().cross(r).normalize(),n[1]=n[1]||new Bu,(u=n[1]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(r).multiplyByScalar(this.bottom).add(a).subtract(t).normalize().cross(i).normalize(),n[2]=n[2]||new Bu,(u=n[2]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s.copy(r).multiplyByScalar(this.top).add(a).subtract(t).normalize().cross(i).normalize(),n[3]=n[3]||new Bu,(u=n[3]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(t),s=(new Gs).copy(e).normalize(),n[4]=n[4]||new Bu,(u=n[4]).x=e.x,u.y=e.y,u.z=e.z,u.w=-e.dot(a),s.copy(e).negate().normalize(),n[5]=n[5]||new Bu,(u=n[5]).x=s.x,u.y=s.y,u.z=s.z,u.w=-s.dot(o),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,r,n){sc(this),Ft(Number.isFinite(t)&&Number.isFinite(e)),Ft(t>0),Ft(e>0),Ft(r>0),Ft(n);var i=1/this.near,a=this.top*i,o=2*r*a/e,s=2*r*(a=this.right*i)/t;return n.x=s,n.y=o,n}},{key:"projectionMatrix",get:function(){return sc(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return sc(this),this._infinitePerspective}}]),t}();function sc(t){Ft(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,r=t.bottom,n=t.right,i=t.left,a=t.near,o=t.far;e===t._top&&r===t._bottom&&i===t._left&&n===t._right&&a===t._near&&o===t._far||(Ft(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=n,t._top=e,t._bottom=r,t._near=a,t._far=o,t._perspectiveMatrix=(new ec).frustum({left:i,right:n,bottom:r,top:e,near:a,far:o}),t._infinitePerspective=(new ec).frustum({left:i,right:n,bottom:r,top:e,near:a,far:1/0}))}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fe(this,t),e=Qi({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new oc,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}ve(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(uc(this),uc(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,r){return uc(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}},{key:"getPixelDimensions",value:function(t,e,r,n){return uc(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}},{key:"projectionMatrix",get:function(){return uc(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return uc(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return uc(this),this._fovy}},{key:"sseDenominator",get:function(){return uc(this),this._sseDenominator}}])}();function uc(t){Ft(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(Ft(t.fov>=0&&t.fov<Math.PI),Ft(t.aspectRatio>0),Ft(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,new Gs,Math.PI;Math.max(6378137,6378137,6356752.314245179);var cc=function(t){return t},hc=new Gs;function lc(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cc;return Ht(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function fc(t){return lc(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:hc,Gt.cartographicRadians?cc:Yt)}function yc(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cc;return Ht(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}function vc(t,e){return yc(t,e,Gt.cartographicRadians?cc:Kt)}var dc=new Gs,pc=new Gs,mc=new Gs;var gc=1e-14,kc=new Gs,bc={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},wc={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ec={east:new Gs,north:new Gs,up:new Gs,west:new Gs,south:new Gs,down:new Gs},_c=new Gs,Tc=new Gs,Sc=new Gs;function xc(t,e,r,n,i,a){var o,s,u,c=bc[e]&&bc[e][r];Ft(c&&(!n||n===c));var h=kc.copy(i);if(Xt(h.x,0,gc)&&Xt(h.y,0,gc)){var l=Math.sign(h.z);o=_c.fromArray(wc[e]),"east"!==e&&"west"!==e&&o.scale(l),s=Tc.fromArray(wc[r]),"east"!==r&&"west"!==r&&s.scale(l),u=Sc.fromArray(wc[n]),"east"!==n&&"west"!==n&&u.scale(l)}else{var f=Ec.up,y=Ec.east,v=Ec.north;y.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),v.copy(f).cross(y);var d=Ec.down,p=Ec.west,m=Ec.south;d.copy(f).scale(-1),p.copy(y).scale(-1),m.copy(v).scale(-1),o=Ec[e],s=Ec[r],u=Ec[n]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=s.x,a[5]=s.y,a[6]=s.z,a[7]=0,a[8]=u.x,a[9]=u.y,a[10]=u.z,a[11]=0,a[12]=h.x,a[13]=h.y,a[14]=h.z,a[15]=1,a}var Oc,Mc=new Gs,Nc=new Gs,Lc=new Gs,Ic=new Gs,Pc=new Gs,Ac=new Gs,Cc=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;fe(this,t),Ft(e>=0),Ft(r>=0),Ft(n>=0),this.radii=new Gs(e,r,n),this.radiiSquared=new Gs(e*e,r*r,n*n),this.radiiToTheFourth=new Gs(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new Gs(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new Gs(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=nu.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return ve(t,null,[{key:"WGS84",get:function(){return Oc=Oc||new t(6378137,6378137,6356752.314245179)}}]),ve(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Nc,n=Lc,i=I(t,3),a=i[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var o=Math.sqrt(r.dot(n));return n.scale(1/o),r.scale(a),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Ac.from(t);var r=this.scaleToGeodeticSurface(Ac,Ic);if(r){var n=this.geodeticSurfaceNormal(r,Nc),i=Pc;i.copy(Ac).subtract(r);var a=Math.atan2(n.y,n.x),o=Math.asin(n.z),s=Math.sign(ct(i,Ac))*ot(i);return vc([a,o,s],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ec;return xc(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ec;return xc(this,t,e,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Mc.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=fc(t),n=r[0],i=r[1],a=Math.cos(i);return Mc.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),Mc.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Mc.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gs,n=e.oneOverRadii,i=e.oneOverRadiiSquared,a=e.centerToleranceSquared;dc.from(t);var o=t.x,s=t.y,u=t.z,c=n.x,h=n.y,l=n.z,f=o*o*c*c,y=s*s*h*h,v=u*u*l*l,d=f+y+v,p=Math.sqrt(1/d);if(Number.isFinite(p)){var m=pc;if(m.copy(t).scale(p),d<a)return m.to(r);var g=i.x,k=i.y,b=i.z,w=mc;w.set(m.x*g*2,m.y*k*2,m.z*b*2);var E,_,T,S,x=(1-p)*t.len()/(.5*w.len()),O=0;do{var M=(E=1/(1+(x-=O)*g))*E,N=(_=1/(1+x*k))*_,L=(T=1/(1+x*b))*T;O=(S=f*M+y*N+v*L-1)/(-2*(f*(M*E)*g+y*(N*_)*k+v*(L*T)*b))}while(Math.abs(S)>nu.EPSILON12);return dc.scale([E,_,T]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Ic.from(t);var r=Ic.x,n=Ic.y,i=Ic.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return Ic.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Ic.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Ic.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Ft(Xt(this.radii.x,this.radii.y,nu.EPSILON15)),Ft(this.radii.z>0),Ic.from(t);var n=Ic.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return Ic.set(0,0,n).to(r)}}]),t}(),Rc=new Wu,Dc=new Gs,zc=new Qu([new Wu,new Wu,new Wu,new Wu,new Wu,new Wu]);function jc(t,e){var r=t.cameraDirection,n=t.cameraUp,i=t.height,a=t.distanceScales.metersPerPixel,o=[t.longitude,t.latitude,0],s=Cc.WGS84.cartographicToCartesian(o,new Gs),u=Cc.WGS84.eastNorthUpToFixedFrame(s),c=t.unprojectPosition(t.cameraPosition),h=Cc.WGS84.cartographicToCartesian(c,new Gs),l=new Gs(u.transformAsVector(new Gs(r).scale(a))).normalize(),f=new Gs(u.transformAsVector(new Gs(n).scale(a))).normalize();return function(t){var e=[t.longitude,t.latitude,0],r=Cc.WGS84.cartographicToCartesian(e,new Gs),n=t.getFrustumPlanes(),i=0;for(var a in n){var o=n[a],s=o.normal.dot(t.center);Dc.copy(o.normal).scale(o.distance-s).add(t.center);var u=t.unprojectPosition(Dc),c=Cc.WGS84.cartographicToCartesian(u,new Gs);Rc.normal.copy(c).subtract(r).scale(-1).normalize(),Rc.distance=Math.abs(Rc.normal.dot(c)),zc.planes[i].normal.copy(Rc.normal),zc.planes[i].distance=Rc.distance,i+=1}}(t),{camera:{position:h,direction:l,up:f},height:i,cullingVolume:zc,frameNumber:e,sseDenominator:1.15}}function qc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Uc(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qc(r,!0).forEach((function(e){ie()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qc(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Fc=function(t){function e(){return a()(this,e),c()(this,l()(e).apply(this,arguments))}var r,n,i;return d()(e,t),s()(e,[{key:"initializeState",value:function(){this.state={layerMap:{},tileset3d:null}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:(i=ue()(oe.a.mark((function t(e){var r,n,i;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.props,n=e.oldProps,!r.data||r.data===n.data){t.next=6;break}return t.next=4,this._loadTileset(r.data);case 4:t.next=9;break;case 6:if(!r._ionAccessToken&&!r._ionAssetId||r._ionAccessToken===n._ionAccessToken&&r._ionAssetId===n._ionAssetId){t.next=9;break}return t.next=9,this._loadTilesetFromIon(r._ionAccessToken,r._ionAssetId);case 9:return i=this.state.tileset3d,t.next=12,this._updateTileset(i);case 12:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"_loadTileset",value:(n=ue()(oe.a.mark((function t(e,r,n){var i,a,o,s,u=this;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,r);case 2:return i=t.sent,t.next=5,i.json();case 5:a=t.sent,o=this.getLoadOptions(),s=new Ss(a,e,Uc({onTileLoad:function(t){u.props.onTileLoad(t),u._updateTileset(s),u.setNeedsUpdate()},onTileUnload:this.props.onTileUnload,onTileLoadFail:this.props.onTileLoadFail,fetchOptions:r},n,{},o)),this.setState({tileset3d:s,layerMap:{}}),s&&this.props.onTilesetLoad(s);case 10:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return n.apply(this,arguments)})},{key:"_loadTilesetFromIon",value:(r=ue()(oe.a.mark((function t(e,r){var n,i,a;return oe.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ns(e,r);case 2:return n=t.sent,i=n.url,a=n.headers,t.next=6,this._loadTileset(i,{headers:a},n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"_updateTileset",value:function(t){var e=this.context,r=e.timeline,n=e.viewport;if(r&&n&&t){var i=jc(n,Date.now());t.update(i),this._updateLayerMap(i.frameNumber)}}},{key:"_updateLayerMap",value:function(t){var e=this.state,r=e.tileset3d,n=e.layerMap,i=r.selectedTiles.filter((function(t){return!n[t.fullUri]})),a=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var h=u.value;r.addTileToCache(h),n[h.fullUri]={layer:this._create3DTileLayer(h),tile:h}}}catch(t){o=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}this._selectLayers(t)}},{key:"_selectLayers",value:function(t){for(var e=this.state.layerMap,r=0,n=Object.values(e);r<n.length;r++){var i=n[r],a=i.tile,o=i.layer;a.selectedFrame===t?o&&o.props&&!o.props.visible&&(o=o.clone({visible:!0}),e[a.fullUri].layer=o):a.contentUnloaded?delete e[a.fullUri]:o&&o.props&&o.props.visible&&(o=o.clone({visible:!1}),e[a.fullUri].layer=o)}this.setState({layers:Object.values(e).map((function(t){return t.layer}))})}},{key:"_create3DTileLayer",value:function(t){if(!t.content)return null;switch(t.content.type){case"pnts":return this._createPointCloudTileLayer(t);case"i3dm":case"b3dm":return this._create3DModelTileLayer(t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}},{key:"_create3DModelTileLayer",value:function(t){var e=t.content,r=e.gltf,n=e.instances,i=e.cartographicOrigin,a=e.modelMatrix;return new(this.getSubLayerClass("scenegraph",p.ScenegraphLayer))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.fullUri),data:n||[{}],scenegraph:r,coordinateSystem:p.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,_composeModelMatrix:!0,getTransformMatrix:function(t){return t.modelMatrix},getPosition:function(t){return[0,0,0]}})}},{key:"_createPointCloudTileLayer",value:function(t){var e=t.content,r=e.attributes,n=e.pointCount,i=e.constantRGBA,a=e.cartographicOrigin,o=e.modelMatrix,s=r.positions,u=r.normals,c=r.colors;if(!s)return null;var h=this.props,l=h.pointSize,f=h.getPointColor;return new(this.getSubLayerClass("pointcloud",p.PointCloudLayer))({pointSize:l},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.fullUri),data:{header:{vertexCount:n},attributes:{POSITION:s,NORMAL:u,COLOR_0:c}},coordinateSystem:p.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:i||f})}},{key:"renderLayers",value:function(){return this.state.layers}}]),e}(p.CompositeLayer);Fc.layerName="Tile3DLayer",Fc.defaultProps={getPointColor:[0,0,0],pointSize:1,opacity:1,data:null,_ionAssetId:null,_ionAccessToken:null,loadOptions:{throttleRequests:!0},onTilesetLoad:function(t){},onTileLoad:function(t){},onTileUnload:function(t){},onTileLoadFail:function(t,e,r){}},r.d(e,"GreatCircleLayer",(function(){return m})),r.d(e,"S2Layer",(function(){return M})),r.d(e,"TileLayer",(function(){return Lt})),r.d(e,"TripsLayer",(function(){return It})),r.d(e,"H3ClusterLayer",(function(){return Ct})),r.d(e,"H3HexagonLayer",(function(){return re})),r.d(e,"Tile3DLayer",(function(){return Fc}))}])}));