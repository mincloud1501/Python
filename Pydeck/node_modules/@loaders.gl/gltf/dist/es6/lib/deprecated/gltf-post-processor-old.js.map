{"version":3,"sources":["../../../../src/lib/deprecated/gltf-post-processor-old.js"],"names":["getFullUri","COMPONENTS","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","BYTES","GL_SAMPLER","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","REPEAT","LINEAR","NEAREST_MIPMAP_LINEAR","SAMPLER_PARAMETER_GLTF_TO_GL","magFilter","minFilter","wrapS","wrapT","DEFAULT_SAMPLER","TEXTURE_WRAP_","getBytesFromComponentType","componentType","getSizeFromAccessorType","type","GLTFPostProcessorOld","postProcess","gltf","glbParser","options","_resolveToTree","bufferViews","forEach","bufView","i","_resolveBufferView","images","image","_resolveImage","samplers","sampler","_resolveSampler","textures","texture","_resolveTexture","accessors","accessor","_resolveAccessor","materials","material","_resolveMaterial","meshes","mesh","_resolveMesh","nodes","node","_resolveNode","skins","skin","_resolveSkin","scenes","scene","_resolveScene","undefined","_process_extension_KHR_lights_punctual","getScene","index","_get","getNode","getSkin","getMesh","getMaterial","getAccessor","getCamera","getTexture","getSampler","getImage","getBufferView","getBuffer","array","object","console","warn","id","map","children","child","camera","inverseBindMatrices","primitive","primitives","attribute","attributes","indices","normalTexture","occlusionTexture","emissiveTexture","pbrMetallicRoughness","mr","baseColorTexture","metallicRoughnessTexture","bufferView","bytesPerComponent","components","bytesPerElement","source","parameters","key","glEnum","_enumSamplerParameter","createImages","getImageAsync","uri","Promise","resolve","img","Image","crossOrigin","onload","src","buffer","data","byteOffset","Uint8Array","byteLength","_resolveCamera","perspective","orthographic","extension","extensions","KHR_lights_punctual","lights","_removeExtension","nodeExtension","light","extensionName","extensionsRequired","_removeStringFromArray","extensionsUsed","string","found","indexOf","splice"],"mappings":"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","sourcesContent":["import {getFullUri} from '../gltf-utils/gltf-utils';\n\n// This is a post processor for loaded glTF files\n// The goal is to make the loaded data easier to use in WebGL applications\n//\n// Functions:\n// * Resolve indexed arrays structure of glTF into a linked tree.\n// * Translate stringified enum keys and values into WebGL constants.\n// * Load images (optional)\n\n// ENUM LOOKUP\n\nconst COMPONENTS = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4,\n  MAT2: 4,\n  MAT3: 9,\n  MAT4: 16\n};\n\nconst BYTES = {\n  5120: 1, // BYTE\n  5121: 1, // UNSIGNED_BYTE\n  5122: 2, // SHORT\n  5123: 2, // UNSIGNED_SHORT\n  5125: 4, // UNSIGNED_INT\n  5126: 4 // FLOAT\n};\n\nconst GL_SAMPLER = {\n  // Sampler parameters\n  TEXTURE_MAG_FILTER: 0x2800,\n  TEXTURE_MIN_FILTER: 0x2801,\n  TEXTURE_WRAP_S: 0x2802,\n  TEXTURE_WRAP_T: 0x2803,\n\n  // Sampler default values\n  REPEAT: 0x2901,\n  LINEAR: 0x2601,\n  NEAREST_MIPMAP_LINEAR: 0x2702\n};\n\nconst SAMPLER_PARAMETER_GLTF_TO_GL = {\n  magFilter: GL_SAMPLER.TEXTURE_MAG_FILTER,\n  minFilter: GL_SAMPLER.TEXTURE_MIN_FILTER,\n  wrapS: GL_SAMPLER.TEXTURE_WRAP_S,\n  wrapT: GL_SAMPLER.TEXTURE_WRAP_T\n};\n\n// When undefined, a sampler with repeat wrapping and auto filtering should be used.\n// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#texture\nconst DEFAULT_SAMPLER = {\n  [GL_SAMPLER.TEXTURE_MAG_FILTER]: GL_SAMPLER.LINEAR,\n  [GL_SAMPLER.TEXTURE_MIN_FILTER]: GL_SAMPLER.NEAREST_MIPMAP_LINEAR,\n  [GL_SAMPLER.TEXTURE_WRAP_S]: GL_SAMPLER.REPEAT,\n  [GL_SAMPLER.TEXTURE_WRAP_]: GL_SAMPLER.REPEAT\n};\n\nfunction getBytesFromComponentType(componentType) {\n  return BYTES[componentType];\n}\n\nfunction getSizeFromAccessorType(type) {\n  return COMPONENTS[type];\n}\n\nexport default class GLTFPostProcessorOld {\n  postProcess(gltf, glbParser, options = {}) {\n    this.gltf = gltf;\n    this.glbParser = glbParser;\n\n    this._resolveToTree(options);\n    return this.gltf;\n  }\n\n  // Convert indexed glTF structure into tree structure\n  // PREPARATION STEP: CROSS-LINK INDEX RESOLUTION, ENUM LOOKUP, CONVENIENCE CALCULATIONS\n  /* eslint-disable complexity */\n  _resolveToTree(options = {}) {\n    const {gltf} = this;\n\n    (gltf.bufferViews || []).forEach((bufView, i) => this._resolveBufferView(bufView, i));\n\n    (gltf.images || []).forEach((image, i) => this._resolveImage(image, i, options));\n    (gltf.samplers || []).forEach((sampler, i) => this._resolveSampler(sampler, i));\n    (gltf.textures || []).forEach((texture, i) => this._resolveTexture(texture, i));\n\n    (gltf.accessors || []).forEach((accessor, i) => this._resolveAccessor(accessor, i));\n    (gltf.materials || []).forEach((material, i) => this._resolveMaterial(material, i));\n    (gltf.meshes || []).forEach((mesh, i) => this._resolveMesh(mesh, i));\n\n    (gltf.nodes || []).forEach((node, i) => this._resolveNode(node, i));\n\n    (gltf.skins || []).forEach((skin, i) => this._resolveSkin(skin, i));\n\n    (gltf.scenes || []).forEach((scene, i) => this._resolveScene(scene, i));\n\n    if (gltf.scene !== undefined) {\n      gltf.scene = gltf.scenes[this.gltf.scene];\n    }\n\n    // EXTENSIONS\n    this._process_extension_KHR_lights_punctual();\n\n    return gltf;\n  }\n  /* eslint-enable complexity */\n\n  getScene(index) {\n    return this._get('scenes', index);\n  }\n\n  getNode(index) {\n    return this._get('nodes', index);\n  }\n\n  getSkin(index) {\n    return this._get('skins', index);\n  }\n\n  getMesh(index) {\n    return this._get('meshes', index);\n  }\n\n  getMaterial(index) {\n    return this._get('materials', index);\n  }\n\n  getAccessor(index) {\n    return this._get('accessors', index);\n  }\n\n  getCamera(index) {\n    return null; // TODO: fix this\n  }\n\n  getTexture(index) {\n    return this._get('textures', index);\n  }\n\n  getSampler(index) {\n    return this._get('samplers', index);\n  }\n\n  getImage(index) {\n    return this._get('images', index);\n  }\n\n  getBufferView(index) {\n    return this._get('bufferViews', index);\n  }\n\n  getBuffer(index) {\n    return this._get('buffers', index);\n  }\n\n  _get(array, index) {\n    // check if already resolved\n    if (typeof index === 'object') {\n      return index;\n    }\n    const object = this.gltf[array] && this.gltf[array][index];\n    if (!object) {\n      console.warn(`glTF file error: Could not find ${array}[${index}]`); // eslint-disable-line\n    }\n    return object;\n  }\n\n  // PARSING HELPERS\n\n  _resolveScene(scene, index) {\n    scene.id = `scene-${index}`;\n    scene.nodes = (scene.nodes || []).map(node => this.getNode(node));\n  }\n\n  _resolveNode(node, index) {\n    node.id = `node-${index}`;\n    node.children = (node.children || []).map(child => this.getNode(child));\n    if (node.mesh !== undefined) {\n      node.mesh = this.getMesh(node.mesh);\n    }\n    if (node.camera !== undefined) {\n      node.camera = this.getCamera(node.camera);\n    }\n    if (node.skin !== undefined) {\n      node.skin = this.getSkin(node.skin);\n    }\n  }\n\n  _resolveSkin(skin, index) {\n    skin.id = `skin-${index}`;\n    skin.inverseBindMatrices = this.getAccessor(skin.inverseBindMatrices);\n  }\n\n  _resolveMesh(mesh, index) {\n    mesh.id = `mesh-${index}`;\n    for (const primitive of mesh.primitives) {\n      for (const attribute in primitive.attributes) {\n        primitive.attributes[attribute] = this.getAccessor(primitive.attributes[attribute]);\n      }\n      if (primitive.indices !== undefined) {\n        primitive.indices = this.getAccessor(primitive.indices);\n      }\n      if (primitive.material !== undefined) {\n        primitive.material = this.getMaterial(primitive.material);\n      }\n    }\n  }\n\n  _resolveMaterial(material, index) {\n    material.id = `material-${index}`;\n    if (material.normalTexture) {\n      material.normalTexture.texture = this.getTexture(material.normalTexture.index);\n    }\n    if (material.occlusionTexture) {\n      material.occlusionTexture.texture = this.getTexture(material.occlusionTexture.index);\n    }\n    if (material.emissiveTexture) {\n      material.emissiveTexture.texture = this.getTexture(material.emissiveTexture.index);\n    }\n\n    if (material.pbrMetallicRoughness) {\n      const mr = material.pbrMetallicRoughness;\n      if (mr.baseColorTexture) {\n        mr.baseColorTexture.texture = this.getTexture(mr.baseColorTexture.index);\n      }\n      if (mr.metallicRoughnessTexture) {\n        mr.metallicRoughnessTexture.texture = this.getTexture(mr.metallicRoughnessTexture.index);\n      }\n    }\n  }\n\n  _resolveAccessor(accessor, index) {\n    accessor.id = `accessor-${index}`;\n    if (accessor.bufferView !== undefined) {\n      // Draco encoded meshes don't have bufferView\n      accessor.bufferView = this.getBufferView(accessor.bufferView);\n    }\n\n    // Look up enums\n    accessor.bytesPerComponent = getBytesFromComponentType(accessor);\n    accessor.components = getSizeFromAccessorType(accessor);\n    accessor.bytesPerElement = accessor.bytesPerComponent * accessor.components;\n  }\n\n  _resolveTexture(texture, index) {\n    texture.id = `texture-${index}`;\n    texture.sampler = 'sampler' in texture ? this.getSampler(texture.sampler) : DEFAULT_SAMPLER;\n    texture.source = this.getImage(texture.source);\n  }\n\n  _resolveSampler(sampler, index) {\n    sampler.id = `sampler-${index}`;\n    // Map textual parameters to GL parameter values\n    sampler.parameters = {};\n    for (const key in sampler) {\n      const glEnum = this._enumSamplerParameter(key);\n      if (glEnum !== undefined) {\n        sampler.parameters[glEnum] = sampler[key];\n      }\n    }\n  }\n\n  _enumSamplerParameter(key) {\n    return SAMPLER_PARAMETER_GLTF_TO_GL[key];\n  }\n\n  _resolveImage(image, index, options) {\n    image.id = `image-${index}`;\n    if (image.bufferView !== undefined) {\n      image.bufferView = this.getBufferView(image.bufferView);\n    }\n\n    // TODO - Handle non-binary-chunk images, data URIs, URLs etc\n    // TODO - Image creation could be done on getImage instead of during load\n    const {createImages = true} = options;\n    if (createImages) {\n      image.image = this.glbParser.getImage(image);\n    } else {\n      image.getImageAsync = () => {\n        if (this.glbParser) {\n          return this.glbParser.getImageAsync(image);\n        } else if (image.uri) {\n          // TODO: Maybe just return the URL?\n          // TODO: Maybe use loaders.gl/core loadImage?\n          return new Promise(resolve => {\n            /* global Image */\n            const img = new Image();\n            img.crossOrigin = 'anonymous';\n            img.onload = () => resolve(img);\n            img.src = getFullUri(image.uri, options.uri);\n          });\n        }\n\n        // cannot get image\n        return null;\n      };\n    }\n  }\n\n  _resolveBufferView(bufferView, index) {\n    bufferView.id = `bufferView-${index}`;\n    bufferView.buffer = this.getBuffer(bufferView.buffer);\n\n    if (this.glbParser) {\n      bufferView.data = this.glbParser.getBufferView(bufferView);\n    } else {\n      const byteOffset = bufferView.byteOffset || 0;\n      bufferView.data = new Uint8Array(bufferView.buffer.data, byteOffset, bufferView.byteLength);\n    }\n  }\n\n  _resolveCamera(camera) {\n    // TODO - create 4x4 matrices\n    if (camera.perspective) {\n      // camera.matrix = createPerspectiveMatrix(camera.perspective);\n    }\n    if (camera.orthographic) {\n      // camera.matrix = createOrthographicMatrix(camera.orthographic);\n    }\n  }\n\n  // EXTENSIONS\n\n  // eslint-disable-next-line camelcase\n  _process_extension_KHR_lights_punctual() {\n    const {gltf} = this;\n\n    // Move the light array out of the extension and remove the extension\n    const extension = gltf.extensions && gltf.extensions.KHR_lights_punctual;\n    if (extension) {\n      gltf.lights = extension.lights;\n    }\n\n    this._removeExtension('KHR_lights_punctual');\n\n    // Any nodes that have the extension, add lights field pointing to light object\n    // and remove the extension\n    for (const node of gltf.nodes || []) {\n      const nodeExtension = node.extensions && node.extensions.KHR_lights_punctual;\n      if (nodeExtension) {\n        node.light = this._get('lights', nodeExtension.light);\n        delete node.extensions.KHR_lights_punctual;\n      }\n    }\n\n    delete gltf.lights;\n  }\n\n  // Removes an extension from the top-level list\n  _removeExtension(extensionName) {\n    if (this.gltf.extensionsRequired) {\n      this._removeStringFromArray(this.gltf.extensionsRequired, extensionName);\n    }\n    if (this.gltf.extensionsUsed) {\n      this._removeStringFromArray(this.gltf.extensionsUsed, extensionName);\n    }\n    if (this.gltf.extensions) {\n      delete this.gltf.extensions[extensionName];\n    }\n  }\n\n  _removeStringFromArray(array, string) {\n    let found = true;\n    while (found) {\n      const index = array.indexOf(string);\n      if (index > -1) {\n        array.splice(index, 1);\n      } else {\n        found = false;\n      }\n    }\n  }\n}\n"],"file":"gltf-post-processor-old.js"}