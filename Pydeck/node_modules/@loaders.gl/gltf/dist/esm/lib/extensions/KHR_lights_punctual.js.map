{"version":3,"sources":["../../../../src/lib/extensions/KHR_lights_punctual.js"],"names":["GLTFScenegraph","KHR_LIGHTS_PUNCTUAL","assert","KHR_lights_punctual","gltfData","options","gltfScenegraph","extension","getExtension","json","lights","removeExtension","nodes","node","nodeExtension","extensions","light","_get","addExtensions","addObjectExtension"],"mappings":";;AAAA,OAAOA,cAAP,MAA2B,oBAA3B;AACA,SAAQC,mBAAR,QAAkC,mBAAlC;AACA,OAAOC,MAAP,MAAmB,iBAAnB;;IAKqBC,mB;;;;;;;2BAKLC,Q,EAAUC,O,EAAS;AAC/B,UAAMC,cAAc,GAAG,IAAIN,cAAJ,CAAmBI,QAAnB,CAAvB;AAGA,UAAMG,SAAS,GAAGD,cAAc,CAACE,YAAf,CAA4BP,mBAA5B,CAAlB;;AACA,UAAIM,SAAJ,EAAe;AACbD,QAAAA,cAAc,CAACG,IAAf,CAAoBC,MAApB,GAA6BH,SAAS,CAACG,MAAvC;AACAJ,QAAAA,cAAc,CAACK,eAAf,CAA+BV,mBAA/B;AACD;;AAR8B;AAAA;AAAA;;AAAA;AAY/B,8BAAmBK,cAAc,CAACM,KAAf,IAAwB,EAA3C,+HAA+C;AAAA,cAApCC,IAAoC;AAC7C,cAAMC,aAAa,GAAGD,IAAI,CAACE,UAAL,IAAmBF,IAAI,CAACE,UAAL,CAAgBZ,mBAAzD;;AACA,cAAIW,aAAJ,EAAmB;AACjBD,YAAAA,IAAI,CAACG,KAAL,GAAaV,cAAc,CAACW,IAAf,CAAoB,QAApB,EAA8BH,aAAa,CAACE,KAA5C,CAAb;AACA,mBAAOH,IAAI,CAACE,UAAL,CAAgBZ,mBAAvB;AACD;AACF;AAlB8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBhC;;;2BAGaC,Q,EAAUC,O,EAAS;AAC/B,UAAMC,cAAc,GAAG,IAAIN,cAAJ,CAAmBI,QAAnB,CAAvB;AAD+B,UAExBK,IAFwB,GAEhBH,cAFgB,CAExBG,IAFwB;;AAI/B,UAAIA,IAAI,CAACC,MAAT,EAAiB;AACf,YAAMH,SAAS,GAAGD,cAAc,CAACY,aAAf,CAA6BjB,mBAA7B,CAAlB;AACAC,QAAAA,MAAM,CAAC,CAACK,SAAS,CAACG,MAAZ,CAAN;AACAH,QAAAA,SAAS,CAACG,MAAV,GAAmBD,IAAI,CAACC,MAAxB;AACA,eAAOD,IAAI,CAACC,MAAZ;AACD;;AAID,UAAIJ,cAAc,CAACG,IAAf,CAAoBC,MAAxB,EAAgC;AAAA;AAAA;AAAA;;AAAA;AAC9B,gCAAoBJ,cAAc,CAACG,IAAf,CAAoBC,MAAxC,mIAAgD;AAAA,gBAArCM,KAAqC;AAC9C,gBAAMH,IAAI,GAAGG,KAAK,CAACH,IAAnB;AACAP,YAAAA,cAAc,CAACa,kBAAf,CAAkCN,IAAlC,EAAwCZ,mBAAxC,EAA6De,KAA7D;AACD;AAJ6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAK9B,eAAOV,cAAc,CAACG,IAAf,CAAoBC,MAA3B;AACD;AACF;;;wBA9CiB;AAChB,aAAOT,mBAAP;AACD;;;;;;SAHkBE,mB","sourcesContent":["import GLTFScenegraph from '../gltf-scenegraph';\nimport {KHR_LIGHTS_PUNCTUAL} from '../gltf-constants';\nimport assert from '../utils/assert';\n\n// GLTF EXTENSION: KHR_lights_punctual\n// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n// eslint-disable-next-line camelcase\nexport default class KHR_lights_punctual {\n  static get name() {\n    return KHR_LIGHTS_PUNCTUAL;\n  }\n\n  static decode(gltfData, options) {\n    const gltfScenegraph = new GLTFScenegraph(gltfData);\n\n    // Move the light array out of the extension and remove the extension\n    const extension = gltfScenegraph.getExtension(KHR_LIGHTS_PUNCTUAL);\n    if (extension) {\n      gltfScenegraph.json.lights = extension.lights;\n      gltfScenegraph.removeExtension(KHR_LIGHTS_PUNCTUAL);\n    }\n\n    // Any nodes that have the extension, add lights field pointing to light object\n    // and remove the extension\n    for (const node of gltfScenegraph.nodes || []) {\n      const nodeExtension = node.extensions && node.extensions.KHR_lights_punctual;\n      if (nodeExtension) {\n        node.light = gltfScenegraph._get('lights', nodeExtension.light);\n        delete node.extensions.KHR_lights_punctual;\n      }\n    }\n  }\n\n  // Move the light ar ray out of the extension and remove the extension\n  static encode(gltfData, options) {\n    const gltfScenegraph = new GLTFScenegraph(gltfData);\n    const {json} = gltfScenegraph;\n\n    if (json.lights) {\n      const extension = gltfScenegraph.addExtensions(KHR_LIGHTS_PUNCTUAL);\n      assert(!extension.lights);\n      extension.lights = json.lights;\n      delete json.lights;\n    }\n\n    // Any nodes that have lights field pointing to light object\n    // add the extension\n    if (gltfScenegraph.json.lights) {\n      for (const light of gltfScenegraph.json.lights) {\n        const node = light.node;\n        gltfScenegraph.addObjectExtension(node, KHR_LIGHTS_PUNCTUAL, light);\n      }\n      delete gltfScenegraph.json.lights;\n    }\n  }\n}\n"],"file":"KHR_lights_punctual.js"}