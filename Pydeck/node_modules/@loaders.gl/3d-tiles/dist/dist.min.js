!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([,function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)})(t)}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";(function(t,r){n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"c",function(){return u});const i="object"!=typeof t||"[object process]"!==String(t)||t.browser,s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==r&&r,document:"undefined"!=typeof document&&document},o=s.global||s.self||s.window,a=void 0!==t&&t.version&&t.version.match(/v([0-9]*)/),u=a&&parseFloat(a[1])||0}).call(this,n(7),n(9))},,function(t,e,n){"use strict";(function(t,r){n.d(e,"b",function(){return o}),n.d(e,"a",function(){return a});var i=n(1),s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===r?"undefined":Object(i.a)(r))&&r},o=s.window||s.self||s.global,a=s.process||{};console}).call(this,n(9),n(7))},,,function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var u,h=[],c=!1,l=-1;function f(){c&&u&&(c=!1,u.length?h=u.concat(h):l=-1,h.length&&y())}function y(){if(!c){var t=a(f);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new d(t,e)),1!==h.length||c||a(y)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},,function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){},,,function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return s});var r=n(1),i=n(14);function s(){return!("object"===(void 0===t?"undefined":Object(r.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(i.a)()}}).call(this,n(7))},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return i});var r=n(1);function i(e){if("undefined"!=typeof window&&"object"===Object(r.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(r.a)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(r.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||n;return!!(i&&i.indexOf("Electron")>=0)}}).call(this,n(7))},function(t,e,n){(function(e){const r=n(20),i="undefined"==typeof window?e:window;i.loaders=i.loaders||{},t.exports=Object.assign(i.loaders,r)}).call(this,n(9))},,,,,function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"dirname",function(){return vr});const i={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"},s=(Object.keys(i),{BATCHED_MODEL:[98,51,100,109],INSTANCED_MODEL:[105,51,100,109],POINT_CLOUD:[112,110,116,115],COMPOSITE:[99,109,112,116]}),o={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},a={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},u={ADD:0,REPLACE:1};var h={name:"3D Tileset",extensions:["json"],parse:async t=>JSON.parse((new TextDecoder).decode(t)),parseTextSync:JSON.parse,testText:t=>t.indexOf(!1)};function c(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function l(t,e,n){c(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return r.decode(i)}function f(t,e=0){const n=new DataView(t);return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),t}var p=n(1);function v(t,e){return!e||"object"!==Object(p.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}function b(t,e,n){return(b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&_(i,n.prototype),i}).apply(null,arguments)}function w(t){var e="function"==typeof Map?new Map:void 0;return(w=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return b(t,arguments,g(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_(r,t)})(t)}function E(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function S(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}var k=1/Math.PI*180,O=1/180*Math.PI,N={};function A(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===e?N.precision||4:e;return t=function(t){return Math.round(t/N.EPSILON)*N.EPSILON}(t),"".concat(parseFloat(t.toPrecision(n)))}function M(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function I(t,e,n){if(M(t)){n=n||((i=t).clone?i.clone():new Array(i.length));for(var r=0;r<n.length&&r<t.length;++r)n[r]=e(t[r],r,n);return n}var i;return e(t)}function x(t){return function(t,e){return I(t,function(t){return t*O},e)}(t)}function L(t){return P(t)}function P(t,e){return I(t,function(t){return t*k},e)}function C(t,e,n){return I(t,function(t){return Math.max(e,Math.min(n,t))})}function D(t,e,n){var r=N.EPSILON;n&&(N.EPSILON=n);try{if(t===e)return!0;if(M(t)&&M(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!D(t[i],e[i]))return!1;return!0}return t&&"object"===Object(p.a)(t)&&t.equals?t.equals(e):e&&"object"===Object(p.a)(e)&&e.equals?e.equals(t):Math.abs(t-e)<=N.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{N.EPSILON=r}}N.EPSILON=1e-12,N.debug=!1,N.precision=4,N.printTypes=!1,N.printDegrees=!1,N.printRowMajor=!0;var R=function(t){function e(){return y(this,e),v(this,g(e).apply(this,arguments))}return T(e,w(Array)),m(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:M(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(N)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+A(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!D(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]+=s[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]-=s[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(N.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"elements",get:function(){return this}}]),e}();function U(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function B(t,e,n){if(N.debug&&!function(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(""|n," some fields set to invalid numbers'"));return t}var z={};function q(t,e){z[t]||(z[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}var V=function(t){function e(){return y(this,e),v(this,g(e).apply(this,arguments))}return T(e,R),m(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return U(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return U(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]*=s[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]/=s[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return S(t>=0&&t<this.ELEMENTS,"index is out of range"),U(this[t])}},{key:"setComponent",value:function(t,e){return S(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=U(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=U(t)}}]),e}(),F=1e-6,j="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function G(){var t=new j(3);return j!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function H(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function W(t,e,n){var r=new j(3);return r[0]=t,r[1]=e,r[2]=n,r}function Q(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Y(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function Z(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function K(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function J(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],u=e[1],h=e[2],c=i*h-s*u,l=s*a-r*h,f=r*u-i*a,y=i*f-s*l,d=s*c-r*f,m=r*l-i*c,p=2*o;return c*=p,l*=p,f*=p,y*=2,d*=2,m*=2,t[0]=a+c+y,t[1]=u+l+d,t[2]=h+f+m,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var X,tt=H;X=G();function et(t,e,n){var r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function nt(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function rt(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,t[3]=e[3],t}var it=[0,0,0],st=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),t=v(this,g(e).call(this,-0,-0,-0)),1===arguments.length&&M(n)?t.copy(n):(N.debug&&(U(n),U(r),U(i)),t[0]=n,t[1]=r,t[2]=i),t}return T(e,V),m(e,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return N.debug&&(U(t.x),U(t.y),U(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return function(t,e){var n=W(t[0],t[1],t[2]),r=W(e[0],e[1],e[2]);Q(n,n),Q(r,r);var i=Y(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}(this,t)}},{key:"cross",value:function(t){return $(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e,n,r,i,s,o,a=t.radians,u=t.origin;return e=this,r=void 0===u?it:u,i=a,o=[],(s=[])[0]=(n=this)[0]-r[0],s[1]=n[1]-r[1],s[2]=n[2]-r[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],this.check()}},{key:"rotateY",value:function(t){var e,n,r,i,s,o,a=t.radians,u=t.origin;return e=this,r=void 0===u?it:u,i=a,o=[],(s=[])[0]=(n=this)[0]-r[0],s[1]=n[1]-r[1],s[2]=n[2]-r[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],this.check()}},{key:"rotateZ",value:function(t){var e,n,r,i,s,o,a=t.radians,u=t.origin;return e=this,r=void 0===u?it:u,i=a,o=[],(s=[])[0]=(n=this)[0]-r[0],s[1]=n[1]-r[1],s[2]=n[2]-r[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return Z(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return nt(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return K(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){var e,n,r,i,s;return e=this,r=t,i=(n=this)[0],s=n[1],e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e[2]=n[2],this.check()}},{key:"transformByQuaternion",value:function(t){return J(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=U(t)}}]),e}();const ot={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},at={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...ot},ut={[ot.DOUBLE]:Float64Array,[ot.FLOAT]:Float32Array,[ot.UNSIGNED_SHORT]:Uint16Array,[ot.UNSIGNED_INT]:Uint32Array,[ot.UNSIGNED_BYTE]:Uint8Array,[ot.BYTE]:Int8Array,[ot.SHORT]:Int16Array,[ot.INT]:Int32Array},ht={DOUBLE:ot.DOUBLE,FLOAT:ot.FLOAT,UNSIGNED_SHORT:ot.UNSIGNED_SHORT,UNSIGNED_INT:ot.UNSIGNED_INT,UNSIGNED_BYTE:ot.UNSIGNED_BYTE,BYTE:ot.BYTE,SHORT:ot.SHORT,INT:ot.INT},ct="Failed to convert GL type";class lt{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in ut){if(ut[e]===t)return e}throw new Error(ct)}static fromName(t){const e=ht[t];if(!e)throw new Error(ct);return e}static getArrayType(t,e=!1){switch(t){case ot.UNSIGNED_SHORT_5_6_5:case ot.UNSIGNED_SHORT_4_4_4_4:case ot.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=ut[t];if(!e)throw new Error(ct);return e}}static getByteSize(t){return lt.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(lt.getArrayType(t))}static createTypedArray(t,e,n=0,r){return void 0===r&&(r=(e.byteLength-n)/lt.getByteSize(t)),new(lt.getArrayType(t))(e,n,r)}}class ft{constructor(t,e){this.json=t,this.buffer=e,this.featuresLength=0,this._cachedTypedArrays={}}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=at.UNSIGNED_INT,n=1){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,r.byteOffset):r}getPropertyArray(t,e,n){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(e=lt.fromName(r.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,e,r)}getProperty(t,e,n,r,i){const s=this.json[t];if(!s)return s;const o=this.getPropertyArray(t,e,n);if(1===n)return o[r];for(let t=0;t<n;++t)i[t]=o[n*r+t];return i}_getTypedArrayFromBinary(t,e,n,r,i){const s=this._cachedTypedArrays;let o=s[t];return o||(o=lt.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,r*n),s[t]=o),o}_getTypedArrayFromArray(t,e,n){const r=this._cachedTypedArrays;let i=r[t];return i||(i=lt.createTypedArray(e,n),r[t]=i),i}}function yt(t,e){if(!t)throw new Error(e||"3d-tile loader: assertion failed.")}const dt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mt={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},pt={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};const vt=t=>void 0!==t;function gt(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,r=i),r?function(t,e){let n,r,i;const s=t.instancesLength,o=t.classes,a=t.classIds,u=t.parentCounts,h=t.parentIds,c=s;vt(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let l;if(vt(u))for(vt(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,s)),l=new Uint16Array(s),c=0,n=0;n<s;++n)l[n]=c,c+=u[n];vt(h)&&vt(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,c));const f=o.length;for(n=0;n<f;++n){const t=o[n].length,r=o[n].instances,i=getBinaryProperties(t,r,e);o[n].instances=combine(i,r)}const y=new Array(f).fill(0),d=new Uint16Array(s);for(n=0;n<s;++n)r=a[n],d[n]=y[r],++y[r];const m={classes:o,classIds:a,classIndexes:d,parentCounts:u,parentIndexes:l,parentIds:h};return function(t){const e=t.classIds.length;for(let n=0;n<e;++n)Tt(t,n,stack)}(m),m}(r,n):null}function _t(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?function(t,e,n){const r=t.classIds,i=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=r.length,u=scratchVisited;u.length=Math.max(u.length,a);const h=++marker,c=scratchStack;c.length=0,c.push(e);for(;c.length>0;){if(e=c.pop(),u[e]===h)continue;u[e]=h;const r=n(t,e);if(vt(r))return r;const a=i[e],l=o[e];for(let t=0;t<a;++t){const n=s[l+t];n!==e&&c.push(n)}}return null}(t,e,n):function(t,e,n){let r=!0;for(;r;){const i=n(t,e);if(vt(i))return i;const s=t.parentIds[e];r=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}(t,e,n)}function Tt(t,e,n){const r=t.parentCounts,i=t.parentIds,s=t.parentIndexes,o=t.classIds.length;if(!vt(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(-1===n.indexOf(e),"Circular dependency detected in the batch table hierarchy."),n.push(e);const a=vt(r)?r[e]:1,u=vt(r)?s[e]:e;for(let r=0;r<a;++r){const s=i[u+r];s!==e&&Tt(t,s,n)}n.pop(e)}const bt=t=>void 0!==t,wt=t=>t,Et={HIERARCHY:!0,extensions:!0,extras:!0};class St{constructor(t,e,n,r={}){yt(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=this.json&&this.json.extensions||{},this._properties={};for(const t in this.json)Et[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=gt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),yt("string"==typeof e,e),this._hierarchy){const n=_t(this._hierarchy,t,(t,n)=>{const r=t.classIds[n];return t.classes[r].name===e});return bt(n)}return!1}isExactClass(t,e){return yt("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),yt("string"==typeof e,e),bt(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=bt(e)?e:[]).length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),yt("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(bt(n))return this._getBinaryProperty(n,t)}const n=this._properties[e];if(bt(n))return wt(n[t],!0);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(bt(n))return n}}setProperty(t,e,n){const r=this.featureCount;if(this._checkBatchId(t,r),yt("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(r)return void this._setBinaryProperty(r,t,n)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let i=this._properties[e];bt(i)||(this._properties[e]=new Array(r),i=this._properties[e]),i[t]=wt(n,!0)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],r=this._initializeBinaryProperty(e,n);r&&((t=t||{})[e]=r)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;yt(this.binary,`Property ${t} requires a batch table binary.`),yt(n.type,`Property ${t} requires a type.`);const r=function(t,e,n,r){const{componentType:i}=t;yt(t.componentType);const s="string"==typeof i?lt.fromName(i):i,o=dt[t.type],a=mt[t.type],u=pt[t.type];return n+=t.byteOffset,{values:lt.createTypedArray(s,e,n,o*r),type:s,size:o,unpacker:a,packer:u}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=_t(this._hierarchy,t,(t,n)=>{const r=t.classIds[n],i=t.classes[r].instances;return bt(i[e])});return bt(n)}_getPropertyNamesInHierarchy(t,e){_t(this._hierarchy,t,(t,n)=>{const r=t.classIds[n],i=t.classes[r].instances;for(const t in i)i.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)})}_getHierarchyProperty(t,e){return _t(this._hierarchy,t,(t,n)=>{const r=t.classIds[n],i=t.classes[r],s=t.classIndexes[n],o=i.instances[e];return bt(o)?bt(o.typedArray)?this._getBinaryProperty(o,s):wt(o[s],!0):null})}_setHierarchyProperty(t,e,n,r){const i=_t(this._hierarchy,e,(t,i)=>{const s=t.classIds[i],o=t.classes[s],a=t.classIndexes[i],u=o.instances[n];return!!bt(u)&&(yt(i===e,`Inherited property "${n}" is read-only.`),bt(u.typedArray)?this._setBinaryProperty(u,a,r):u[a]=wt(r,!0),!0)});return bt(i)}}const kt=4;function Ot(t,e,n=0){const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=kt,t.version=r.getUint32(n,!0),n+=kt,t.byteLength=r.getUint32(n,!0),n+=kt,1!==t.version)throw new Error(`3D Tile Version ${t.version} not supported`);return n}const Nt=4;function At(t,e,n){const r=new DataView(e);return t.featureTableJsonByteLength=r.getUint32(n,!0),n+=Nt,t.featureTableBinaryByteLength=r.getUint32(n,!0),n+=Nt,t.batchTableJsonByteLength=r.getUint32(n,!0),n+=Nt,t.batchTableBinaryByteLength=r.getUint32(n,!0),n+=Nt}function Mt(t,e,n,r){return n=function(t,e,n,r){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s}=t;if(t.featureTableJson={BATCH_LENGTH:0},i>0){const r=l(e,n,i);t.featureTableJson=JSON.parse(r)}return n+=i,t.featureTableBinary=new Uint8Array(e,n,s),n+=s}(t,e,n),n=function(t,e,n,r){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=t;if(i>0){const r=l(e,n,i);t.batchTableJson=JSON.parse(r),n+=i,s>0&&(t.batchTableBinary=new Uint8Array(e,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}(t,e,n)}function It(t,e=[0,0,0]){const n=t>>11&31,r=t>>5&63,i=31&t;return e[0]=n<<3,e[1]=r<<2,e[2]=i<<3,e}function xt(t,e,n){if(!(e||t&&t.batchIds&&n))return null;const{batchIds:r,isRGB565:i,pointCount:s}=t;if(r&&n){const t=new Uint8ClampedArray(3*s);for(let e=0;e<s;e++){const i=r[e],s=n.getProperty(i,"dimensions").map(t=>255*t);t[3*e]=s[0],t[3*e+1]=s[1],t[3*e+2]=s[2]}return{type:at.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(i){const t=new Uint8ClampedArray(3*s);for(let n=0;n<s;n++){const r=It(e[n]);t[3*n]=r[0],t[3*n+1]=r[1],t[3*n+2]=r[2]}return{type:at.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*s?{type:at.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:at.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}function Lt(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Pt(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}!function(){var t,e=(t=new j(2),j!=Float32Array&&(t[0]=0,t[1]=0),t)}();var Ct=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y(this,e),t=v(this,g(e).call(this,2)),M(n)&&1===arguments.length?t.copy(n):(N.debug&&(U(n),U(r)),t[0]=n,t[1]=r),t}return T(e,V),m(e,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return N.debug&&(U(t.x),U(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return Pt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return et(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return Lt(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){var e,n,r,i,s;return e=this,r=t,i=(n=this)[0],s=n[1],e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],this.check()}},{key:"transformByMatrix2",value:function(t){var e,n,r,i,s;return e=this,r=t,i=(n=this)[0],s=n[1],e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(),Dt={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI};function Rt(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}new Ct,new st,new Ct,new Ct,new Uint8Array(1);function Ut(t,e=255){return C(t,0,e)/e*2-1}function Bt(t){return t<0?-1:1}function zt(t,e,n,r){if(Rt(r),t<0||t>n||e<0||e>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(r.x=Ut(t,n),r.y=Ut(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const t=r.x;r.x=(1-Math.abs(r.y))*Bt(t),r.y=(1-Math.abs(t))*Bt(r.y)}return r.normalize()}function qt(t,e,n){return zt(t,e,255,n)}const Vt=new st;function Ft(t,e,n){return t.isQuantized?n.decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const n=new st,r=new Float32Array(3*t.pointCount);for(let i=0;i<t.pointCount;i++)n.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,3*i);return r}(t,e)):{type:at.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}async function jt(t,e,n,r,i){n=Mt(t,e,n=At(t,e,n=Ot(t,e,n))),Gt(t);const{featureTable:s,batchTable:o}=Ht(t);return await async function(t,e,n,r,i){let s,o,a;const u=n&&n.getExtension("3DTILES_draco_point_compression");u&&(a=u.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const e=h.byteOffset,n=h.byteLength;if(!o||!Number.isFinite(e)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=t.featureTableBinary.slice(e,e+n),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(s){const e={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};await async function(t,e,n,r){const{parse:i}=r,s=await i(e.buffer,n.DracoLoader),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,u=s.attributes.NORMAL&&s.attributes.NORMAL.value,h=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,c=o&&s.attributes.POSITION.value.quantization,l=u&&s.attributes.NORMAL.value.quantization;if(c){const e=s.POSITION.data.quantization,n=e.range;t.quantizedVolumeScale=new st(n,n,n),t.quantizedVolumeOffset=new st(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}l&&(t.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);t.attributes={positions:o,colors:xt(t,a),normals:u,batchIds:h}}(t,e,r,i)}}(t,s,o,r,i),Wt(t,s,r),Qt(t,s,o),Yt(t,s),n}function Gt(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Ht(t){const e=new ft(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",at.FLOAT,3);const r=function(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",at.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=t;n=new St(i,s,r)}return n}(t,e);return{featureTable:e,batchTable:r}}function Wt(t,e,n){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",at.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",at.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",at.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",at.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Ft(t,r,n)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Qt(t,e,n){if(!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",at.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",at.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",at.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=xt(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",at.UNSIGNED_BYTE,4))}function Yt(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",at.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",at.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(3*t.pointsLength);for(let r=0;r<t.pointsLength;r++)qt(e[2*r],e[2*r+1],Vt),Vt.toArray(n,3*r);return{type:at.FLOAT,size:2,value:n}}return{type:at.FLOAT,size:2,value:e}}(t,n)}}const $t={URI:0,EMBEDDED:1};function Zt(t,e,n){const r=t.byteOffset+t.byteLength-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");const i=new Uint8Array(e).subarray(n,n+r),s=new Uint8Array(i);return t.gltfArrayBuffer=s.buffer,t.gltfByteOffset=0,t.gltfByteLength=r,t.rotateYtoZ=!0,t.byteOffset+t.byteLength}function Kt(t,e,n){switch(e){case $t.URI:const n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),r=(new TextDecoder).decode(n);t.gltfUrl=r.replace(/[\s\0]+$/,"");break;case $t.EMBEDDED:t.gltf={};break;default:throw new Error(`i3dm: glTF format ${e}: Must be 0 (uri) or 1 (embedded)`)}}function Jt(t,e,n,r,i){n=Zt(t,e,n=Mt(t,e,n=At(t,e,n=Ot(t,e,n))));const s=new ft(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",at.FLOAT,3),Kt(t,$t.EMBEDDED,0),n}var Xt=function(t){function e(){return y(this,e),v(this,g(e).apply(this,arguments))}return T(e,R),m(e,[{key:"toString",value:function(){var t="[";if(N.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=U(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,r=0;r<this.RANK;++r)e[r]=this[n+r];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,r=0;r<this.RANK;++r)this[n+r]=e[r];return this}}]),e}();function te(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],y=n[1],d=n[2],m=n[3],p=n[4],v=n[5],g=n[6],_=n[7],T=n[8];return t[0]=f*r+y*o+d*h,t[1]=f*i+y*a+d*c,t[2]=f*s+y*u+d*l,t[3]=m*r+p*o+v*h,t[4]=m*i+p*a+v*c,t[5]=m*s+p*u+v*l,t[6]=g*r+_*o+T*h,t[7]=g*i+_*a+T*c,t[8]=g*s+_*u+T*l,t}function ee(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var ne=Object.freeze([1,0,0,0,1,0,0,0,1]),re=Object.freeze([0,0,0,0,0,0,0,0,0]),ie=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),se={},oe=function(t){function e(t){var n;return y(this,e),n=v(this,g(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return T(e,Xt),m(e,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return ie}}],[{key:"IDENTITY",get:function(){return se.IDENTITY=se.IDENTITY||Object.freeze(new e(ne)),se.IDENTITY}},{key:"ZERO",get:function(){return se.ZERO=se.ZERO||Object.freeze(new e(re)),se.ZERO}}]),m(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,n,r,i,s,o,a,u){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,s,o,a,u){return this[0]=t,this[1]=r,this[2]=o,this[3]=e,this[4]=i,this[5]=a,this[6]=n,this[7]=s,this[8]=u,this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],e*(h*s-o*u)+n*(-h*i+o*a)+r*(u*i-s*a);var t,e,n,r,i,s,o,a,u,h}},{key:"identity",value:function(){return this.copy(ne)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,h=n*o,c=r*o,l=r*a,f=i*o,y=i*a,d=i*u,m=s*o,p=s*a,v=s*u;t[0]=1-l-d,t[3]=c-v,t[6]=f+p,t[1]=c+v,t[4]=1-h-d,t[7]=y-m,t[2]=f-p,t[5]=y+m,t[8]=1-h-l}(this,t),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}},{key:"invert",value:function(){var t,e,n,r,i,s,o,a,u,h,c,l,f,y,d;return t=this,n=(e=this)[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],(d=n*(l=c*o-a*h)+r*(f=-c*s+a*u)+i*(y=h*s-o*u))&&(d=1/d,t[0]=l*d,t[1]=(-c*r+i*h)*d,t[2]=(a*r-i*o)*d,t[3]=f*d,t[4]=(c*n-i*u)*d,t[5]=(-a*n+i*s)*d,t[6]=y*d,t[7]=(-h*n+r*u)*d,t[8]=(o*n-r*s)*d),this.check()}},{key:"multiplyLeft",value:function(t){return te(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return te(this,this,t),this.check()}},{key:"rotate",value:function(t){var e,n,r,i,s,o,a,u,h,c,l,f,y,d;return e=this,r=t,i=(n=this)[0],s=n[1],o=n[2],a=n[3],u=n[4],h=n[5],c=n[6],l=n[7],f=n[8],y=Math.sin(r),d=Math.cos(r),e[0]=d*i+y*a,e[1]=d*s+y*u,e[2]=d*o+y*h,e[3]=d*a-y*i,e[4]=d*u-y*s,e[5]=d*h-y*o,e[6]=c,e[7]=l,e[8]=f,this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?ee(this,this,t):ee(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){var e,n,r,i,s,o,a,u,h,c,l,f,y,d;return e=this,r=t,i=(n=this)[0],s=n[1],o=n[2],a=n[3],u=n[4],h=n[5],c=n[6],l=n[7],f=n[8],y=r[0],d=r[1],e[0]=i,e[1]=s,e[2]=o,e[3]=a,e[4]=u,e[5]=h,e[6]=y*i+d*a+c,e[7]=y*s+d*u+l,e[8]=y*o+d*h+f,this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=Lt(e||[-0,-0],t,this);break;case 3:e=K(e||[-0,-0,-0],t,this);break;case 4:e=rt(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return B(e,t.length),e}},{key:"transformVector",value:function(t,e){return q("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return q("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return q("Matrix3.transformVector"),this.transform(t,e)}}]),e}();function ae(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function ue(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function he(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2],h=n[3],c=h*r+a*s-u*i,l=h*i+u*r-o*s,f=h*s+o*i-a*r,y=-o*r-a*i-u*s;return t[0]=c*h+y*-o+l*-u-f*-a,t[1]=l*h+y*-a+f*-o-c*-u,t[2]=f*h+y*-u+c*-a-l*-o,t[3]=e[3],t}!function(){var t,e=(t=new j(4),j!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function ce(){var t=new j(4);return j!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function le(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function fe(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],h=n[2],c=n[3];return t[0]=r*c+o*a+i*h-s*u,t[1]=i*c+o*u+s*a-r*h,t[2]=s*c+o*h+r*u-i*a,t[3]=o*c-r*a-i*u-s*h,t}function ye(t,e,n,r){var i,s,o,a,u,h=e[0],c=e[1],l=e[2],f=e[3],y=n[0],d=n[1],m=n[2],p=n[3];return(s=h*y+c*d+l*m+f*p)<0&&(s=-s,y=-y,d=-d,m=-m,p=-p),1-s>F?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(a=1-r,u=r),t[0]=a*h+u*y,t[1]=a*c+u*d,t[2]=a*l+u*m,t[3]=a*f+u*p,t}function de(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+i]+e[3*i+s])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t}var me,pe,ve,ge,_e,Te,be,we=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ee=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Se=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ke=function(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t},Oe=ae,Ne=ue,Ae=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t},Me=(me=G(),pe=W(1,0,0),ve=W(0,1,0),function(t,e,n){var r=Y(e,n);return r<-.999999?($(me,pe,e),tt(me)<1e-6&&$(me,ve,e),Q(me,me),le(t,me,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):($(me,e,n),t[0]=me[0],t[1]=me[1],t[2]=me[2],t[3]=1+r,Ae(t,t))}),Ie=(ge=ce(),_e=ce(),Te=new j(9),j!=Float32Array&&(Te[1]=0,Te[2]=0,Te[3]=0,Te[5]=0,Te[6]=0,Te[7]=0),Te[0]=1,Te[4]=1,Te[8]=1,be=Te,[0,0,0,1]),xe=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return y(this,e),t=v(this,g(e).call(this,-0,-0,-0,-0)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,i,s),t}return T(e,R),m(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}},{key:"fromMatrix3",value:function(t){return de(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return le(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return Oe(this)}},{key:"lengthSquared",value:function(t){return Ne(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return Se(this,t)}},{key:"rotationTo",value:function(t,e){return Me(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return we(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2];t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a}(this,this),this.check()}},{key:"lerp",value:function(t,e,n){return ke(this,t,e,n),this.check()}},{key:"multiplyRight",value:function(t,e){return S(!e),fe(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return S(!e),fe(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*a,t[1]=i*u+s*a,t[2]=s*u-i*a,t[3]=o*u-r*a}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u-s*a,t[1]=i*u+o*a,t[2]=s*u+r*a,t[3]=o*u-i*a}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a}(this,this,t),this.check()}},{key:"scale",value:function(t){return Ee(this,this,t),this.check()}},{key:"slerp",value:function(t,e,n){switch(arguments.length){case 1:var r=arguments[0],i=r.start;t=void 0===i?Ie:i,e=r.target,n=r.ratio;break;case 2:var s=Array.prototype.slice.call(arguments);e=s[0],n=s[1],t=this}return ye(this,t,e,n),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return he(e,t,this),B(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=U(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=U(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=U(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=U(t)}}]),e}();function Le(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,s=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pe(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],y=e[10],d=e[11],m=e[12],p=e[13],v=e[14],g=e[15],_=n[0],T=n[1],b=n[2],w=n[3];return t[0]=_*r+T*a+b*l+w*m,t[1]=_*i+T*u+b*f+w*p,t[2]=_*s+T*h+b*y+w*v,t[3]=_*o+T*c+b*d+w*g,_=n[4],T=n[5],b=n[6],w=n[7],t[4]=_*r+T*a+b*l+w*m,t[5]=_*i+T*u+b*f+w*p,t[6]=_*s+T*h+b*y+w*v,t[7]=_*o+T*c+b*d+w*g,_=n[8],T=n[9],b=n[10],w=n[11],t[8]=_*r+T*a+b*l+w*m,t[9]=_*i+T*u+b*f+w*p,t[10]=_*s+T*h+b*y+w*v,t[11]=_*o+T*c+b*d+w*g,_=n[12],T=n[13],b=n[14],w=n[15],t[12]=_*r+T*a+b*l+w*m,t[13]=_*i+T*u+b*f+w*p,t[14]=_*s+T*h+b*y+w*v,t[15]=_*o+T*c+b*d+w*g,t}function Ce(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function De(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,h,c),t}function Re(t,e,n,r,i){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function Ue(t,e,n,r){var i,s,o,a,u,h,c,l,f,y,d=e[0],m=e[1],p=e[2],v=r[0],g=r[1],_=r[2],T=n[0],b=n[1],w=n[2];return Math.abs(d-T)<F&&Math.abs(m-b)<F&&Math.abs(p-w)<F?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(c=d-T,l=m-b,f=p-w,i=g*(f*=y=1/Math.hypot(c,l,f))-_*(l*=y),s=_*(c*=y)-v*f,o=v*l-g*c,(y=Math.hypot(i,s,o))?(i*=y=1/y,s*=y,o*=y):(i=0,s=0,o=0),a=l*o-f*s,u=f*i-c*o,h=c*s-l*i,(y=Math.hypot(a,u,h))?(a*=y=1/y,u*=y,h*=y):(a=0,u=0,h=0),t[0]=i,t[1]=a,t[2]=c,t[3]=0,t[4]=s,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=h,t[10]=f,t[11]=0,t[12]=-(i*d+s*m+o*p),t[13]=-(a*d+u*m+h*p),t[14]=-(c*d+l*m+f*p),t[15]=1,t)}var Be=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ze=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),qe=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Ve={},Fe=function(t){function e(t){var n;return y(this,e),n=v(this,g(e).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return T(e,Xt),m(e,[{key:"INDICES",get:function(){return qe}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return Ve.IDENTITY=Ve.IDENTITY||Object.freeze(new e(Be)),Ve.IDENTITY}},{key:"ZERO",get:function(){return Ve.ZERO=Ve.ZERO||Object.freeze(new e(ze)),Ve.ZERO}}]),m(e,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,r,i,s,o,a,u,h,c,l,f,y,d,m){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this[9]=h,this[10]=c,this[11]=l,this[12]=f,this[13]=y,this[14]=d,this[15]=m,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,s,o,a,u,h,c,l,f,y,d,m){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=s,this[6]=h,this[7]=y,this[8]=n,this[9]=o,this[10]=c,this[11]=d,this[12]=r,this[13]=a,this[14]=l,this[15]=m,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(Be)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,h=n*o,c=r*o,l=r*a,f=i*o,y=i*a,d=i*u,m=s*o,p=s*a,v=s*u;t[0]=1-l-d,t[1]=c+v,t[2]=f-p,t[3]=0,t[4]=c-v,t[5]=1-h-d,t[6]=y+m,t[7]=0,t[8]=f+p,t[9]=y-m,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var n=t.left,r=t.right,i=t.bottom,s=t.top,o=t.near,a=t.far;return a===1/0?e._computeInfinitePerspectiveOffCenter(this,n,r,i,s,o):function(t,e,n,r,i,s,o){var a=1/(n-e),u=1/(i-r),h=1/(s-o);t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0}(this,n,r,i,s,o,a),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var r=t;t=r.eye,e=r.center,n=r.up}return Ue(this,t,e=e||[0,0,0],n=n||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,s=t.near,o=void 0===s?.1:s,a=t.far;return function(t,e,n,r,i,s,o){var a=1/(e-n),u=1/(r-i),h=1/(s-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(o+s)*h,t[15]=1}(this,e,n,r,i,o,void 0===a?500:a),this.check()}},{key:"orthographic",value:function(t){var n=t.fovy,r=void 0===n?45*Math.PI/180:n,i=t.aspect,s=void 0===i?1:i,o=t.focalDistance,a=void 0===o?1:o,u=t.near,h=void 0===u?.1:u,c=t.far,l=void 0===c?500:c;if(r>2*Math.PI)throw Error("radians");var f=r/2,y=a*Math.tan(f),d=y*s;return(new e).ortho({left:-d,right:d,bottom:-y,top:y,near:h,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=t.fov,r=void 0===n?45*Math.PI/180:n,i=t.aspect,s=void 0===i?1:i,o=t.near,a=void 0===o?.1:o,u=t.far,h=void 0===u?500:u;if((e=e||r)>2*Math.PI)throw Error("radians");return Re(this,e,s,a,h),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],y=t[12],d=t[13],m=t[14],p=t[15],(e*o-n*s)*(l*p-f*m)-(e*a-r*s)*(c*p-f*d)+(e*u-i*s)*(c*m-l*d)+(n*a-r*o)*(h*p-f*y)-(n*u-i*o)*(h*m-l*y)+(r*u-i*a)*(h*d-c*y);var t,e,n,r,i,s,o,a,u,h,c,l,f,y,d,m,p}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*s,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*s,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],y=e[11],d=e[12],m=e[13],p=e[14],v=e[15],g=n*a-r*o,_=n*u-i*o,T=n*h-s*o,b=r*u-i*a,w=r*h-s*a,E=i*h-s*u,S=c*m-l*d,k=c*p-f*d,O=c*v-y*d,N=l*p-f*m,A=l*v-y*m,M=f*v-y*p,I=g*M-_*A+T*N+b*O-w*k+E*S;I&&(I=1/I,t[0]=(a*M-u*A+h*N)*I,t[1]=(i*A-r*M-s*N)*I,t[2]=(m*E-p*w+v*b)*I,t[3]=(f*w-l*E-y*b)*I,t[4]=(u*O-o*M-h*k)*I,t[5]=(n*M-i*O+s*k)*I,t[6]=(p*T-d*E-v*_)*I,t[7]=(c*E-f*T+y*_)*I,t[8]=(o*A-a*O+h*S)*I,t[9]=(r*O-n*A-s*S)*I,t[10]=(d*w-m*T+v*g)*I,t[11]=(l*T-c*w-y*g)*I,t[12]=(a*k-o*N-u*S)*I,t[13]=(n*N-r*k+i*S)*I,t[14]=(m*_-d*b-p*g)*I,t[15]=(c*b-l*_+f*g)*I)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return Pe(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return Pe(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+h*r,t[5]=o*i+c*r,t[6]=a*i+l*r,t[7]=u*i+f*r,t[8]=h*i-s*r,t[9]=c*i-o*r,t[10]=l*i-a*r,t[11]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-h*r,t[1]=o*i-c*r,t[2]=a*i-l*r,t[3]=u*i-f*r,t[8]=s*r+h*i,t[9]=o*r+c*i,t[10]=a*r+l*i,t[11]=u*r+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+h*r,t[1]=o*i+c*r,t[2]=a*i+l*r,t[3]=u*i+f*r,t[4]=h*i-s*r,t[5]=c*i-o*r,t[6]=l*i-a*r,t[7]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Le(t,3),n=e[0],r=e[1],i=e[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,n,r){var i,s,o,a,u,h,c,l,f,y,d,m,p,v,g,_,T,b,w,E,S,k,O,N,A=r[0],M=r[1],I=r[2],x=Math.hypot(A,M,I);x<F||(A*=x=1/x,M*=x,I*=x,i=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],u=e[1],h=e[2],c=e[3],l=e[4],f=e[5],y=e[6],d=e[7],m=e[8],p=e[9],v=e[10],g=e[11],_=A*A*o+s,T=M*A*o+I*i,b=I*A*o-M*i,w=A*M*o-I*i,E=M*M*o+s,S=I*M*o+A*i,k=A*I*o+M*i,O=M*I*o-A*i,N=I*I*o+s,t[0]=a*_+l*T+m*b,t[1]=u*_+f*T+p*b,t[2]=h*_+y*T+v*b,t[3]=c*_+d*T+g*b,t[4]=a*w+l*E+m*S,t[5]=u*w+f*E+p*S,t[6]=h*w+y*E+v*S,t[7]=c*w+d*E+g*S,t[8]=a*k+l*O+m*N,t[9]=u*k+f*O+p*N,t[10]=h*k+y*O+v*N,t[11]=c*k+d*O+g*N,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?Ce(this,this,t):Ce(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,n){var r,i,s,o,a,u,h,c,l,f,y,d,m=n[0],p=n[1],v=n[2];e===t?(t[12]=e[0]*m+e[4]*p+e[8]*v+e[12],t[13]=e[1]*m+e[5]*p+e[9]*v+e[13],t[14]=e[2]*m+e[6]*p+e[10]*v+e[14],t[15]=e[3]*m+e[7]*p+e[11]*v+e[15]):(r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],y=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=y,t[11]=d,t[12]=r*m+a*p+l*v+e[12],t[13]=i*m+u*p+f*v+e[13],t[14]=s*m+h*p+y*v+e[14],t[15]=o*m+c*p+d*v+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(B(e=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=Pt(e||[-0,-0],t,this);break;case 3:e=Z(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return B(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=et(e||[-0,-0],t,this);break;case 3:e=nt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return B(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return q("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return q("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return q("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,r,i,s){var o=2*s/(n-e),a=2*s/(i-r),u=(n+e)/(n-e),h=(i+r)/(i-r),c=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=c,t[15]=0,t}}]),e}(),je=(Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Ge=new st;function He(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:je;return M(t)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z),e}function We(t){return He(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ge,N.cartographicRadians?je:x)}function Qe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:je;return M(e)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]),e}function Ye(t,e){return Qe(t,e,N.cartographicRadians?je:L)}var $e=new st,Ze=new st,Ke=new st;var Je=1e-14,Xe=new st,tn={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},en={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},nn={east:new st,north:new st,up:new st,west:new st,south:new st,down:new st},rn=new st,sn=new st,on=new st;function an(t,e,n,r,i,s){var o,a,u,h=tn[e]&&tn[e][n];S(h&&(!r||r===h));var c=Xe.copy(i);if(D(c.x,0,Je)&&D(c.y,0,Je)){var l=Math.sign(c.z);o=rn.fromArray(en[e]),"east"!==e&&"west"!==e&&o.scale(l),a=sn.fromArray(en[n]),"east"!==n&&"west"!==n&&a.scale(l),u=on.fromArray(en[r]),"east"!==r&&"west"!==r&&u.scale(l)}else{var f=nn.up,y=nn.east,d=nn.north;y.set(-c.y,c.x,0).normalize(),t.geodeticSurfaceNormal(c,f),d.copy(f).cross(y);var m=nn.down,p=nn.west,v=nn.south;m.copy(f).scale(-1),p.copy(y).scale(-1),v.copy(d).scale(-1),o=nn[e],a=nn[n],u=nn[r]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=a.x,s[5]=a.y,s[6]=a.z,s[7]=0,s[8]=u.x,s[9]=u.y,s[10]=u.z,s[11]=0,s[12]=c.x,s[13]=c.y,s[14]=c.z,s[15]=1,s}var un,hn=new st,cn=new st,ln=new st,fn=new st,yn=new st,dn=new st,mn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y(this,t),S(e>=0),S(n>=0),S(r>=0),this.radii=new st(e,n,r),this.radiiSquared=new st(e*e,n*n,r*r),this.radiiToTheFourth=new st(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new st(0===e?0:1/e,0===n?0:1/n,0===r?0:1/r),this.oneOverRadiiSquared=new st(0===e?0:1/(e*e),0===n?0:1/(n*n),0===r?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.centerToleranceSquared=Dt.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return m(t,null,[{key:"WGS84",get:function(){return un=un||new t(6378137,6378137,6356752.314245179)}}]),m(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=cn,r=ln,i=Le(t,3),s=i[2];this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);var o=Math.sqrt(n.dot(r));return r.scale(1/o),n.scale(s),r.add(n),r.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];dn.from(t);var n=this.scaleToGeodeticSurface(dn,fn);if(n){var r=this.geodeticSurfaceNormal(n,cn),i=yn;i.copy(dn).subtract(n);var s=Math.atan2(r.y,r.x),o=Math.asin(r.z),a=Math.sign(Y(i,dn))*H(i);return Ye([s,o,a],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fe;return an(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Fe;return an(this,t,e,n,r,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return hn.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=We(t),r=n[0],i=n[1],s=Math.cos(i);return hn.set(s*Math.cos(r),s*Math.sin(r),Math.sin(i)).normalize(),hn.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return hn.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new st,r=e.oneOverRadii,i=e.oneOverRadiiSquared,s=e.centerToleranceSquared;$e.from(t);var o=t.x,a=t.y,u=t.z,h=r.x,c=r.y,l=r.z,f=o*o*h*h,y=a*a*c*c,d=u*u*l*l,m=f+y+d,p=Math.sqrt(1/m);if(Number.isFinite(p)){var v=Ze;if(v.copy(t).scale(p),m<s)return v.to(n);var g=i.x,_=i.y,T=i.z,b=Ke;b.set(v.x*g*2,v.y*_*2,v.z*T*2);var w,E,S,k,O=(1-p)*t.len()/(.5*b.len()),N=0;do{var A=(w=1/(1+(O-=N)*g))*w,M=(E=1/(1+O*_))*E,I=(S=1/(1+O*T))*S;N=(k=f*A+y*M+d*I-1)/(-2*(f*(A*w)*g+y*(M*E)*_+d*(I*S)*T))}while(Math.abs(k)>Dt.EPSILON12);return $e.scale([w,E,S]).to(n)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];fn.from(t);var n=fn.x,r=fn.y,i=fn.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*s.x+r*r*s.y+i*i*s.z);return fn.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return fn.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return fn.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];S(D(this.radii.x,this.radii.y,Dt.EPSILON15)),S(this.radii.z>0),fn.from(t);var r=fn.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-e))return fn.set(0,0,r).to(n)}}]),t}();function pn(t,e,n,r,i){if(n=Ot(t,e,n),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);n=At(t,e,n);const s=new DataView(e);if(t.gltfFormat=s.getUint32(n,!0),n=Zt(t,e,n=Mt(t,e,n+=4)),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new ft(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",at.FLOAT,3);new St(t.batchTableJson,t.batchTableBinary,a);return function(t,e,n,r){const i=[new Array(r),t._batchTable][0],s=new st,o=new st,a=new st,u=new st,h=new oe,c=new xe,l=new st,f={},y=new Fe,d=[],m=[],p=new st,v=new st;for(let n=0;n<r;n++){let r;if(e.hasProperty("POSITION"))r=e.getProperty("POSITION",at.FLOAT,3,n,s);else if(e.hasProperty("POSITION_QUANTIZED")){r=e.getProperty("POSITION_QUANTIZED",at.UNSIGNED_SHORT,3,n,s);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",at.FLOAT,3,p);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",at.FLOAT,3,v);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)r[e]=r[e]/o*i[e]+t[e]}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(r),f.translation=s,t.normalUp=e.getProperty("NORMAL_UP",at.FLOAT,3,n,d),t.normalRight=e.getProperty("NORMAL_RIGHT",at.FLOAT,3,n,m);const g=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",at.UNSIGNED_SHORT,2,d),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",at.UNSIGNED_SHORT,2,m),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(mn.WGS84.eastNorthUpToFixedFrame(s,y),y.getRotationMatrix3(h)):h.identity()}g&&(u.copy(o).cross(a).normalize(),h.setColumn(0,o),h.setColumn(1,a),h.setColumn(2,u)),c.fromMatrix3(h),f.rotation=c,l.set(1,1,1);const _=e.getProperty("SCALE",at.FLOAT,1,n);Number.isFinite(_)&&l.multiplyByScalar(_);const T=e.getProperty("SCALE_NON_UNIFORM",at.FLOAT,3,n,d);T&&l.scale(T),f.scale=l;let b=e.getProperty("BATCH_ID",at.UNSIGNED_SHORT,1,n);void 0===b&&(b=n);const w=(new Fe).fromQuaternion(f.rotation);y.identity(),y.translate(f.translation),y.multiplyRight(w),y.scale(f.scale);const E=y.clone();i[n]={modelMatrix:E,batchId:b}}t.instances=i}(t,o,0,a),n}async function vn(t,e=0,n,r,s={}){switch(s.byteOffset=e,s.type=f(t,e),s.type){case i.COMPOSITE:return await async function(t,e,n,r,i,s){n=Ot(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const o={};t.tiles.push(o),n=await s(e,n,r,i,o)}return n}(s,t,e,n,r,vn);case i.BATCHED_3D_MODEL:return await async function(t,e,n,r,i){return n=Jt(t,e,n,r,i),await Kt(t,$t.EMBEDDED,0),n}(s,t,e,n,r);case i.INSTANCED_3D_MODEL:return await async function(t,e,n,r,i){return n=pn(t,e,n,r,i),await Kt(t,t.gltfFormat,0),n}(s,t,e,n,r);case i.POINT_CLOUD:return await jt(s,t,e,n,r);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}function gn(t,e=0,n,r,s={}){switch(s.byteOffset=e,s.type=f(t,e),s.type){case i.COMPOSITE:return function(t,e,n,r,i,s){n=Ot(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const o={};t.tiles.push(o),n=s(e,n,r,i,o)}return n}(s,t,e,n,r,gn);case i.BATCHED_3D_MODEL:return function(t,e,n,r,i){return n=Jt(t,e,n,r,i),Kt(t,$t.EMBEDDED,0),n}(s,t,e,n,r);case i.INSTANCED_3D_MODEL:return function(t,e,n,r,i){return n=pn(t,e,n,r,i)}(s,t,e,n,r);case i.POINT_CLOUD:return function(t,e,n,r,i){n=Mt(t,e,n=At(t,e,n=Ot(t,e,n))),Gt(t);const{featureTable:s}=Ht(t);return Wt(t,s,r),Qt(t,s,r),Yt(t,s),n}(s,t,e,n);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}var _n={name:"3D Tiles",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",test:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,n,r){const i={};return await vn(t,0,e,n,i),i},parseSync:function(t,e,n,r){const i={};return gn(t,0,e,n,i),i},binary:!0};function Tn(t,e,n){if(!e)return n+12;const{magic:r,version:i=1,byteLength:s=12}=t;return c(Array.isArray(r)&&Number.isFinite(i)&&Number.isFinite(s)),e.setUint8(n+0,r[0]),e.setUint8(n+1,r[1]),e.setUint8(n+2,r[2]),e.setUint8(n+3,r[3]),e.setUint32(n+4,i,!0),e.setUint32(n+8,s,!0),n+=12}function bn(t,e,n){t&&t.setUint32(e+8,n,!0)}function wn(t,e,n,r){if(t)for(let i=0;i<r;i++)t.setUint8(e+i,n.charCodeAt(i));return e+r}const En={POINTS_LENGTH:1,POSITIONS:{byteOffset:0}};function Sn(t,e,n,r){const{featureTableJson:i=En}=t;let o=JSON.stringify(i);o=function(t,e){const n=t.length,r=Math.ceil(n/e)*e-n;let i="";for(let t=0;t<r;++t)i+=" ";return t+i}(o,4);const{featureTableJsonByteLength:a=o.length}=t,u=new ArrayBuffer(12),h=u.byteLength,c=n;return n+=Tn(t={magic:s.POINT_CLOUD,...t},e,0),e&&(e.setUint32(n+0,a,!0),e.setUint32(n+4,h,!0),e.setUint32(n+8,0,!0),e.setUint32(n+12,0,!0)),n+=16,n+=wn(e,n,o,a),n+=function(t,e,n,r){if(t)for(let i=0;i<r;i++)t.setUint8(e+i,n[i]),e++;return e+r}(e,n,u,h),bn(e,c,n-c),n}function kn(t,e,n,r){switch(yt("string"==typeof t.type),t.type){case i.COMPOSITE:return function(t,e,n,r,i){const o=n;n+=Tn(t={magic:s.COMPOSITE,tiles:[],...t},e,n),e&&e.setUint32(n,t.tiles.length,!0),n+=4;for(let s=0;s<t.tiles.length;++s)n+=i(t.tiles[s],e,n,r);return bn(e,o,n-o),n}(t,e,n,r,kn);case i.POINT_CLOUD:return Sn(t,e,n);case i.BATCHED_3D_MODEL:return function(t,e,n,r){const{featuresLength:i=1}=t,o={BATCH_LENGTH:i},a=JSON.stringify(o),u=a.length,h=n;return n=Tn(t={magic:s.BATCHED_MODEL,...t},e,n),e&&(e.setUint32(12,u,!0),e.setUint32(16,0,!0),e.setUint32(20,0,!0),e.setUint32(24,0,!0)),n+=16,bn(e,h,(n+=wn(e,n,a,u))-h),n}(t,e,n);case i.INSTANCED_3D_MODEL:return function(t,e,n,r){const{featuresLength:i=1,gltfFormat:o=1,gltfUri:a=""}=t,u=a.length,h={INSTANCES_LENGTH:i,POSITION:new Array(3*i).fill(0)},c=JSON.stringify(h),l=c.length,f=n;return Tn(t={magic:s.INSTANCED_MODEL,...t},e,0),e&&(e.setUint32(12,l,!0),e.setUint32(16,0,!0),e.setUint32(20,0,!0),e.setUint32(24,0,!0),e.setUint32(28,o,!0)),n+=wn(e,n,c,l),bn(e,f,(n+=wn(e,n,a,u))-f),n}(t,e,n);default:throw new Error("3D Tiles: unknown tile type")}}var On={name:"GLB",extensions:["cmpt","pnts","b3dm","i3dm"],mimeType:"application/octet-stream",encodeSync:function(t,e){return function(t,e){const n=kn(t,null,0,e),r=new ArrayBuffer(n);return kn(t,new DataView(r),0,e),r}(t,e)},binary:!0};var Nn=n(13),An=Object(Nn.a)(),Mn=n(4);function In(){var t;if(An&&Mn.b.performance)t=Mn.b.performance.now();else if(Mn.a.hrtime){var e=Mn.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var xn=function(){function t(e,n){y(this,t),this.name=e,this.type=n,this.sampleSize=1,this.reset()}return m(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this._lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=In(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(In()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),Ln=function(){function t(e){var n=e.id,r=e.stats;y(this,t),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return m(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach(function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach(function(e){return t._getOrCreate(e)})}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,n=t.type;return this.stats[e]||(this.stats[e]=t instanceof xn?t:new xn(e,n)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function Pn(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function Cn(t){if(!t)return!1;return Array.isArray(t)&&(t=t[0]),t.parseTextSync||t.parseSync||t.parse||t.loadAndParse||t.parseStream||t.parseInBatches||t.worker}function Dn(t){let e;return Pn(Cn(t)),Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Pn(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}class Rn{log(){}info(){}warn(){}error(){}}function Un(t,e){return null===(t=Object.assign({},e&&e.DEFAULT_OPTIONS,e&&e.defaultOptions,e&&e.options,t,{dataType:"arraybuffer"})).log&&(t.log=new Rn),"log"in t||(t.log=console),t}const Bn=t=>"undefined"!=typeof Response&&t instanceof Response||t.arrayBuffer&&t.text&&t.json,zn=t=>(t=>"undefined"!=typeof File&&t instanceof File)(t)||(t=>"undefined"!=typeof Blob&&t instanceof Blob)(t);var qn=n(2);class Vn{constructor(t){this._fileOrBlob=t,this.bodyUsed=!1}get headers(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}get ok(){return!0}get status(){return 200}url(){return this._fileOrBlob.name||""}async arrayBuffer(){const{reader:t,promise:e}=this._getFileReader();return t.readAsArrayBuffer(this._fileOrBlob),e}async text(){const{reader:t,promise:e}=this._getFileReader();return t.readAsText(this._fileOrBlob),e}async json(){const t=await this.text();return JSON.parse(t)}_getFileReader(){let t;Pn(!this.bodyUsed),this.bodyUsed=!0;const e=new Promise((e,n)=>{try{(t=new FileReader).onerror=t=>n(new Error(t)),t.onabort=()=>n(new Error("Read aborted.")),t.onload=()=>e(t.result)}catch(t){n(t)}});return{reader:t,promise:e}}}function Fn(t,e){return Promise.resolve(new Vn(t,e))}const jn="Cannot convert supplied data type";function Gn(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){const n=t.buffer||t;if(e.text&&!e.binary){return new TextDecoder("utf8").decode(n)}return n}throw new Error(jn)}async function Hn(t,e){const n=(t=await t)instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||n)return Gn(t,e);if(zn(t)&&(t=await Fn(t)),Bn(t))return await async function(t){if(!t.ok){let e=`fetch failed ${t.status} `;try{e+=await t.text()}catch(t){}throw new Error(e)}}(t),e.binary?await t.arrayBuffer():await t.text();throw new Error(jn)}function Wn(t,e){return{fetch:"undefined"!=typeof window&&window.fetch,...t}}var Qn=n(10);function Yn(t){if(Qn.toArrayBuffer&&(t=Object(Qn.toArrayBuffer)(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}return Pn(!1)}function $n(t,e=!0,n=[]){if(t){if(t instanceof ArrayBuffer)n.push(t);else if(t.buffer&&t.buffer instanceof ArrayBuffer)n.push(t.buffer);else if(e&&"object"==typeof t)for(const r in t)$n(t[r],e,n)}else;return n}const Zn=new Map;let Kn=0;function Jn({data:t,resolve:e}){e(t)}class Xn{constructor({source:t,name:e=`web-worker-${Kn++}`,onMessage:n}){const r=function(t){if(Pn("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")"))return t.match(/^url\((.*)\)$/)[1];let e=Zn.get(t);if(!e){const n=new Blob([t],{type:"application/javascript"});e=URL.createObjectURL(n),Zn.set(t,e)}return e}(t);this.worker=new Worker(r,{name:e}),this.name=e,this.onMessage=n||Jn}async process(t){return new Promise((e,n)=>{this.worker.onmessage=t=>this.onMessage({worker:this.worker,data:t.data,resolve:e,reject:n}),this.worker.onerror=t=>n(t);const r=$n(t);this.worker.postMessage(t,r)})}destroy(){this.worker.terminate(),this.worker=null}}class tr{constructor({source:t,name:e="unnamed",maxConcurrency:n=1,onMessage:r,onDebug:i=(()=>{})}){this.source=t,this.name=e,this.maxConcurrency=n,this.onMessage=r,this.onDebug=i,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}async process(t,e){return new Promise((n,r)=>{this.jobQueue.push({data:t,jobName:e,resolve:n,reject:r}),this._startQueuedJob()})}_startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();this.onDebug({message:"processing",worker:t.name,job:e.jobName,backlog:this.jobQueue.length}),t.process(e.data).then(t=>e.resolve(t)).catch(t=>e.reject(t)).then(()=>this._onWorkerDone(t))}_onWorkerDone(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;const t=`${this.name.toLowerCase()}-worker-${this.count}-of-${this.maxConcurrency}`;return new Xn({source:this.source,onMessage:this.onMessage,name:t})}return null}}const er=5;class nr{constructor({maxConcurrency:t=er,onMessage:e,onDebug:n=(()=>{})}){this.maxConcurrency=t,this.onMessage=e,this.onDebug=n,this.workerPools=new Map}setProps(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}destroy(){this.workerPools.forEach(t=>t.destroy())}async process(t,e,n){return this._getWorkerPool(t,e).process(n)}_getWorkerPool(t,e){let n=this.workerPools.get(e);return n||(n=new tr({source:t,name:e,onMessage:this.onMessage,maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,n)),n}}let rr=null;async function ir({worker:t,data:e,resolve:n,reject:r}){switch(e.type){case"done":n(e.result);break;case"process":try{const n=await fr(e.arraybuffer,e.options,e.url);t.postMessage({type:"process-done",id:e.id,result:n},$n(n))}catch(n){t.postMessage({type:"process-error",id:e.id,message:n.message})}break;case"error":r(e.message)}}function sr(t,e,n,r={},i={}){const s=function(t={}){const e={};return t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency),t.onDebug&&(e.onDebug=t.onDebug),rr||(rr=new nr({onMessage:ir})),rr.setProps(e),rr}(r);return r=JSON.parse(JSON.stringify(r)),s.process(t,`loaders.gl-${e}`,{arraybuffer:Yn(n),options:r,source:"loaders.gl",type:"process"})}let or=[];const ar=/\.([^.]+)$/,ur=/^data:(.*?)(;|,)/;function hr(t,e="",n=null,{nothrow:r=!1}={}){if(e=e||"",t&&!Array.isArray(t)){const e=t;return Dn(e),e}(function(t){for(const e of t)Dn(e)})(t=t||or),e=e.replace(/\?.*/,"");let i=null;if(!(i=(i=i||function(t,e){let n=e.match(ur);const r=n&&n[1];if(r)return function(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e))return n;return null}(t,r);const i=(n=e.match(ar))&&n[1];return i&&function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i)}(t,e))||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(cr(e,n))return n}else if(ArrayBuffer.isView(e)){if(lr(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(lr(e,0,n))return n}return null}(t,n))){if(r)return null;throw new Error(`No valid loader found for ${e}`)}return i}function cr(t,e){return e.testText&&e.testText(t)}function lr(t,e,n){switch(Array.isArray(n.test)?"array":typeof n.test){case"function":return n.test(t,n);case"string":case"array":return(Array.isArray(n.test)?n.test:[n.test]).some(n=>{return n===function(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let i="";for(let t=0;t<n;t++)i+=String.fromCharCode(r.getUint8(e+t));return i}(t,e,n.length)});default:return!1}}async function fr(t,e,n,r){!e||Array.isArray(e)||Cn(e)||(r=n,n=e,e=null),n=n||{};const i=function(t,e){return Bn(t)?e=e||t.url:zn(e)&&(e=e.name),"string"==typeof e?e.replace(/\?.*/,""):e}(t,r),s=hr(e,i,t);n=Un(n,s);const o=Wn({url:i,parse:fr});return await async function(t,e,n,r){if(e=await Hn(e,t),t.parseTextSync&&"string"==typeof e)return n.dataType="text",t.parseTextSync(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);if(t.parseSync)return t.parseSync(e,n,r,t);if(t.worker)return await sr(t.worker,t.name,e,n,r);return Pn(!1)}(s,t,n,o)}let yr="";const dr={};function mr(t){for(const e in dr)if(t.startsWith(e)){const n=dr[e];return t.replace(e,n)}return t+=yr}async function pr(t,e){return zn(t)?Fn(t,e):(t=mr(t),fetch(t,e))}function vr(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}qn.a.TextEncoder,qn.a.TextDecoder;const gr="Queued Requests",_r="Active Requests",Tr="Cancelled Requests",br="Queued Requests Ever",wr="Active Requests Ever",Er={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Sr{constructor(t={}){this.props={...t,...Er},this.requestQueue=[],this.activeRequestCount=0,this.stats=new Ln({id:t.id}),this.stats.get(gr),this.stats.get(_r),this.stats.get(Tr),this.stats.get(br),this.stats.get(wr)}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve(t);const n=new Promise((n,r)=>{this.requestQueue.push({handle:t,callback:e,resolve:n,reject:r})});return this._issueNewRequests(),n}startRequest(t){this.activeRequestCount++}endRequest(t){this.activeRequestCount--,this._issueNewRequests()}trackRequestPromise(t,e){this.startRequest(t),e.then(()=>this.endRequest(t)).catch(()=>this.endRequest(t))}_issueNewRequests(){this._updateNeeded=!0,setTimeout(()=>this._issueNewRequestsAsync(),0)}_issueNewRequestsAsync(){this._updateNeeded=!1;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e)if(this.requestQueue.length>0){this.requestQueue.shift().resolve(!0)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),e--)}t.sort((t,e)=>t.priority-e.priority)}_updateRequest(t){return t.priority=t.callback(t.handle),!(t.priority<0)||(t.resolve(!1),!1)}}var kr=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),Or=kr,Nr=new st,Ar=new st,Mr=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y(this,t),r=r||Nr.copy(e).add(n).scale(.5),this.minimum=new st(e),this.maximum=new st(n),this.center=new st(r)}m(t,[{key:"fromPoints",value:function(t){if(!t||0===t.length)return this.minimum.set(0,0,0),this.maximum.set(0,0,0),this.center.set(0,0,0),this;var e=t[0][0],n=t[0][1],r=t[0][2],i=t[0][0],s=t[0][1],o=t[0][2],a=!0,u=!1,h=void 0;try{for(var c,l=t[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value,y=f[0],d=f[1],m=f[2];e=Math.min(y,e),i=Math.max(y,i),n=Math.min(d,n),s=Math.max(d,s),r=Math.min(m,r),o=Math.max(m,o)}}catch(t){u=!0,h=t}finally{try{a||null==l.return||l.return()}finally{if(u)throw h}}return this.minimum.set(e,n,r),this.maximum.set(i,s,o),this.center.copy(this.minimum).add(this.maximum).scale(.5),this}},{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=Nr.copy(this.maximum).subtract(this.minimum).scale(.5),n=Ar.from(t.normal),r=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),i=this.center.dot(n)+t.distance;return i-r>0?Or.INSIDE:i+r<0?Or.OUTSIDE:Or.INTERSECTING}}])}(),new st),Ir=new st,xr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this.radius=-0,this.center=new st,this.fromCenterRadius(e,n)}return m(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=Mr.from(e),this.center=(new st).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,n=this.radius,r=t.center,i=t.radius,s=Mr.copy(r).subtract(e),o=s.magnitude();if(n>=o+i)return this.clone();if(i>=o+n)return t.clone();var a=.5*(n+o+i);return Ir.copy(s).scale((-n+a)/o).add(e),this.center.copy(Ir),this.radius=a,this}},{key:"expand",value:function(t){var e=(t=Mr.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,n=this.radius,r=t.normal.dot(e)+t.distance;return r<-n?Or.OUTSIDE:r<n?Or.INTERSECTING:Or.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=De(Mr,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=Mr.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}(),Lr=new oe,Pr=new oe,Cr=new oe,Dr=new oe,Rr=new oe;function Ur(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Dt.EPSILON20,r=0,i=0,s=Pr,o=Cr;s.identity(),o.copy(t);for(var a=n*function(t){for(var e=0,n=0;n<9;++n){var r=t[n];e+=r*r}return Math.sqrt(e)}(o);i<10&&qr(o)>a;)Vr(o,Dr),Rr.copy(Dr).transpose(),o.multiplyRight(Dr),o.multiplyLeft(Rr),s.multiplyRight(Dr),++r>2&&(++i,r=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}var Br=[1,0,0],zr=[2,2,1];function qr(t){for(var e=0,n=0;n<3;++n){var r=t[Lr.getElementIndex(zr[n],Br[n])];e+=2*r*r}return Math.sqrt(e)}function Vr(t,e){for(var n=Dt.EPSILON15,r=0,i=1,s=0;s<3;++s){var o=Math.abs(t[Lr.getElementIndex(zr[s],Br[s])]);o>r&&(i=s,r=o)}var a=Br[i],u=zr[i],h=1,c=0;if(Math.abs(t[Lr.getElementIndex(u,a)])>n){var l,f=(t[Lr.getElementIndex(u,u)]-t[Lr.getElementIndex(a,a)])/2/t[Lr.getElementIndex(u,a)];c=(l=f<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(h=1/Math.sqrt(1+l*l))}return oe.IDENTITY.to(e),e[Lr.getElementIndex(a,a)]=e[Lr.getElementIndex(u,u)]=h,e[Lr.getElementIndex(u,a)]=c,e[Lr.getElementIndex(a,u)]=-c,e}var Fr=new st,jr=new st,Gr=new st,Hr=new st,Wr=new st,Qr=new oe,Yr={diagonal:new oe,unitary:new oe};function $r(t,e){if(!t||0===t.length)return e.halfAxes=new oe([0,0,0,0,0,0,0,0,0]),e.center=new st,e;var n=t.length,r=new st(0,0,0),i=!0,s=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var h=a.value;r.add(h)}}catch(t){s=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}var c=1/n;r.multiplyByScalar(c);var l=0,f=0,y=0,d=0,m=0,p=0,v=!0,g=!1,_=void 0;try{for(var T,b=t[Symbol.iterator]();!(v=(T=b.next()).done);v=!0){var w=T.value,E=Fr.copy(w).subtract(r);l+=E.x*E.x,f+=E.x*E.y,y+=E.x*E.z,d+=E.y*E.y,m+=E.y*E.z,p+=E.z*E.z}}catch(t){g=!0,_=t}finally{try{v||null==b.return||b.return()}finally{if(g)throw _}}l*=c,f*=c,y*=c,d*=c,m*=c,p*=c;var S=Qr;S[0]=l,S[1]=f,S[2]=y,S[3]=f,S[4]=d,S[5]=m,S[6]=y,S[7]=m,S[8]=p;var k=Ur(S,Yr).unitary,O=e.halfAxes.copy(k),N=O.getColumn(0,Gr),A=O.getColumn(1,Hr),M=O.getColumn(2,Wr),I=-Number.MAX_VALUE,x=-Number.MAX_VALUE,L=-Number.MAX_VALUE,P=Number.MAX_VALUE,C=Number.MAX_VALUE,D=Number.MAX_VALUE,R=!0,U=!1,B=void 0;try{for(var z,q=t[Symbol.iterator]();!(R=(z=q.next()).done);R=!0){var V=z.value;I=Math.max(V.dot(N),I),x=Math.max(V.dot(A),x),L=Math.max(V.dot(M),L),P=Math.min(V.dot(N),P),C=Math.min(V.dot(A),C),D=Math.min(V.dot(M),D)}}catch(t){U=!0,B=t}finally{try{R||null==q.return||q.return()}finally{if(U)throw B}}N=N.multiplyByScalar(.5*(P+I)),A=A.multiplyByScalar(.5*(C+x)),M=M.multiplyByScalar(.5*(D+L)),e.center.copy(N).add(A).add(M);var F=jr.set(I-P,x-C,L-D).multiplyByScalar(.5);return e.halfAxes.multiplyByScalar(F),e}var Zr=new st,Kr=new st,Jr=new st,Xr=new st,ti=new st,ei=new st,ni=new st,ri=new st,ii=new st,si=new st,oi=new st,ai=0,ui=1,hi=2,ci=3,li=4,fi=5,yi=6,di=7,mi=8,pi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];y(this,t),this.center=(new st).from(e),this.halfAxes=new oe(n)}return m(t,[{key:"clone",value:function(e){return new t(this.center,this.halfAxes)}},{key:"fromPoints",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;return $r(e,n)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xr,e=this.halfAxes,n=e.getColumn(0,ii),r=e.getColumn(1,si),i=e.getColumn(2,oi),s=Zr.copy(n).add(r).add(i);return t.center.copy(this.center),t.radius=s.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,n=t.normal,r=this.halfAxes,i=n.x,s=n.y,o=n.z,a=Math.abs(i*r[ai]+s*r[ui]+o*r[hi])+Math.abs(i*r[ci]+s*r[li]+o*r[fi])+Math.abs(i*r[yi]+s*r[di]+o*r[mi]),u=n.dot(e)+t.distance;return u<=-a?Or.OUTSIDE:u>=a?Or.INSIDE:Or.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=Kr.copy(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Jr),i=n.getColumn(1,Xr),s=n.getColumn(2,ti),o=r.magnitude(),a=i.magnitude(),u=s.magnitude();r.normalize(),i.normalize(),s.normalize();var h=ei;h.x=e.dot(r),h.y=e.dot(i),h.z=e.dot(s);var c,l=0;return h.x<-o?l+=(c=h.x+o)*c:h.x>o&&(l+=(c=h.x-o)*c),h.y<-a?l+=(c=h.y+a)*c:h.y>a&&(l+=(c=h.y-a)*c),h.z<-u?l+=(c=h.z+u)*c:h.z>u&&(l+=(c=h.z-u)*c),l}},{key:"computePlaneDistances",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[[],[]],r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=this.center,o=this.halfAxes,a=o.getColumn(0,Jr),u=o.getColumn(1,Xr),h=o.getColumn(2,ti),c=ni.copy(a).add(u).add(h).add(s),l=ri.copy(c).subtract(t),f=e.dot(l);return r=Math.min(f,r),i=Math.max(f,i),c.copy(s).add(a).add(u).subtract(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),c.copy(s).add(a).subtract(u).add(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),c.copy(s).add(a).subtract(u).subtract(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(c).subtract(a).add(u).add(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(c).subtract(a).add(u).subtract(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(c).subtract(a).subtract(u).add(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(c).subtract(a).subtract(u).subtract(h),l.copy(c).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),n.start=r,n.stop=i,n}},{key:"getTransform",value:function(){}}]),t}(),vi=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return y(this,e),t=v(this,g(e).call(this,-0,-0,-0,-0)),M(n)&&1===arguments.length?t.copy(n):(N.debug&&(U(n),U(r),U(i),U(s)),t[0]=n,t[1]=r,t[2]=i,t[3]=s),t}return T(e,V),m(e,[{key:"set",value:function(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"fromObject",value:function(t){return N.debug&&(U(t.x),U(t.y),U(t.z),U(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}},{key:"transform",value:function(t){return Z(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return rt(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,n){var r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return J(this,this,t),this.check()}},{key:"applyMatrix4",value:function(t){return t.transform(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=U(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=U(t)}}]),e}(),gi=new st,_i=new st,Ti=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this.normal=new st,this.distance=-0,this.fromNormalDistance(e,n)}return m(t,[{key:"fromNormalDistance",value:function(t,e){return S(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=gi.from(t),this.normal.from(e).normalize();var n=-this.normal.dot(t);return this.distance=n,this}},{key:"fromCoefficients",value:function(t,e,n,r){return this.normal.set(t,e,n),S(1===this.normal.len()),this.distance=r,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return D(this.distance,t.distance)&&D(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=_i.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=gi.from(t);var n=this.getPointDistance(t),r=_i.copy(this.normal).scale(n);return t.subtract(r).to(e)}}]),t}(),bi=[new st([1,0,0]),new st([0,1,0]),new st([0,0,1])],wi=new st,Ei=new st,Si=new Ti(new st(1,0,0),0),ki=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y(this,t),this.planes=e,S(this.planes.every(function(t){return t instanceof Ti}))}return m(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),m(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*bi.length;for(var e=t.center,n=t.radius,r=0,i=0,s=bi;i<s.length;i++){var o=s[i],a=this.planes[r],u=this.planes[r+1];a||(a=this.planes[r]=new vi),u||(u=this.planes[r+1]=new vi);var h=wi.copy(o).scale(-n).add(e),c=-o.dot(h);a.x=o.x,a.y=o.y,a.z=o.z,a.w=c;var l=wi.copy(o).scale(n).add(e),f=Ei.copy(o).negate(),y=-f.dot(l);u.x=f.x,u.y=f.y,u.z=f.z,u.w=y,r+=2}return this}},{key:"computeVisibility",value:function(t){S(t);var e=Or.INSIDE,n=!0,r=!1,i=void 0;try{for(var s,o=this.planes[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,u=Si.fromCoefficients.apply(Si,E(a));switch(t.intersectPlane(u)){case Or.OUTSIDE:return Or.OUTSIDE;case Or.INTERSECTING:e=Or.INTERSECTING}}}catch(t){r=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return e}},{key:"computeVisibilityWithPlaneMask",value:function(e,n){if(S(e,"boundingVolume is required."),S(Number.isFinite(n),"parentPlaneMask is required."),n===t.MASK_OUTSIDE||n===t.MASK_INSIDE)return n;for(var r=t.MASK_INSIDE,i=this.planes,s=0;s<this.planes.length;++s){var o=s<31?1<<s:0;if(!(s<31&&0==(n&o))){var a=Si.fromCoefficients.apply(Si,E(i[s])),u=e.intersectPlane(a);if(u===Or.OUTSIDE)return t.MASK_OUTSIDE;u===Or.INTERSECTING&&(r|=o)}}return r}}]),t}();function Oi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ni(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Oi(t,e,n[e])})}return t}var Ai=new st,Mi=new st,Ii=new st,xi=new st,Li=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t),e=Ni({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new ki,this._perspectiveMatrix=new Fe,this._infinitePerspective=new Fe}return m(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,n){S(t,"position is required."),S(e,"direction is required."),S(n,"up is required.");var r=this._cullingVolume.planes,i=Ai.copy(e).cross(n),s=Mi.copy(e).multiplyByScalar(this.near).add(t),o=Ii.copy(e).multiplyByScalar(this.far).add(t),a=xi;a.copy(i).multiplyByScalar(this.left).add(s).subtract(t).normalize().cross(n).normalize(),r[0]=r[0]||new vi;var u=r[0];return u.x=a.x,u.y=a.y,u.z=a.z,u.w=-a.dot(t),a.copy(i).multiplyByScalar(this.right).add(s).subtract(t).normalize().cross(n).normalize(),r[1]=r[1]||new vi,(u=r[1]).x=a.x,u.y=a.y,u.z=a.z,u.w=-a.dot(t),a.copy(n).multiplyByScalar(this.bottom).add(s).subtract(t).normalize().cross(i).normalize(),r[2]=r[2]||new vi,(u=r[2]).x=a.x,u.y=a.y,u.z=a.z,u.w=-a.dot(t),a.copy(n).multiplyByScalar(this.top).add(s).subtract(t).normalize().cross(i).normalize(),r[3]=r[3]||new vi,(u=r[3]).x=a.x,u.y=a.y,u.z=a.z,u.w=-a.dot(t),a=(new st).copy(e).normalize(),r[4]=r[4]||new vi,(u=r[4]).x=e.x,u.y=e.y,u.z=e.z,u.w=-e.dot(s),a.copy(e).negate().normalize(),r[5]=r[5]||new vi,(u=r[5]).x=a.x,u.y=a.y,u.z=a.z,u.w=-a.dot(o),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,n,r){Pi(this),S(Number.isFinite(t)&&Number.isFinite(e)),S(t>0),S(e>0),S(n>0),S(r);var i=1/this.near,s=this.top*i,o=2*n*s/e,a=2*n*(s=this.right*i)/t;return r.x=a,r.y=o,r}},{key:"projectionMatrix",get:function(){return Pi(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Pi(this),this._infinitePerspective}}]),t}();function Pi(t){S(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,n=t.bottom,r=t.right,i=t.left,s=t.near,o=t.far;e===t._top&&n===t._bottom&&i===t._left&&r===t._right&&s===t._near&&o===t._far||(S(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=r,t._top=e,t._bottom=n,t._near=s,t._far=o,t._perspectiveMatrix=(new Fe).frustum({left:i,right:r,bottom:n,top:e,near:s,far:o}),t._infinitePerspective=(new Fe).frustum({left:i,right:r,bottom:n,top:e,near:s,far:1/0}))}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t),e=Ni({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new Li,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}m(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(Ci(this),Ci(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,n){return Ci(this),this._offCenterFrustum.computeCullingVolume(t,e,n)}},{key:"getPixelDimensions",value:function(t,e,n,r){return Ci(this),this._offCenterFrustum.getPixelDimensions(t,e,n,r)}},{key:"projectionMatrix",get:function(){return Ci(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Ci(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return Ci(this),this._fovy}},{key:"sseDenominator",get:function(){return Ci(this),this._sseDenominator}}])}();function Ci(t){S(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(S(t.fov>=0&&t.fov<Math.PI),S(t.aspectRatio>0),S(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new st,new st,new st,new st,new st,new st,new st,new st,new st,new st,new st,new st,Math.PI;const Di=t=>void 0!==t,Ri=(new oe,new st),Ui=new st;new Fe;function Bi(t,e,n){if(yt(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,n){const r=new st(t[0],t[1],t[2]);let i=new oe(t.slice(3,t.length));if(e.transform(r,r),i=new oe(e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]).multiplyRight(i),Di(n))return n.center=r,n.halfAxes=i,n;return new pi(r,i)}(t.box,e,n);if(t.region){const[e,n,r,i,s,o]=t.region,a=new st(P((e+r)/2),P((i+n)/2),(s+o)/2),u=mn.WGS84.cartographicToCartesian(a,Ui),h=mn.WGS84.cartographicToCartesian([i,e,0]),c=mn.WGS84.cartographicToCartesian([i,r,0]),l=mn.WGS84.cartographicToCartesian([n,e,0]),f=8*(Math.abs(c[0]-h[0])+Math.abs(l[1]-h[1]));return zi([u[0],u[1],u[2],f],new Fe)}if(t.sphere)return zi(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function zi(t,e,n){const r=new st(t[0],t[1],t[2]);e.transform(r,r);const i=e.getScale(Ri),s=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*s;return Di(n)?(n.center=r,n.radius=o,n):new xr(r,o)}const qi=t=>null!=t,Vi=new Date,Fi=new st,ji=new Ti;class Gi{constructor(t,e,n,r){yt("object"==typeof e),this._tileset=t,this._header=e,this._basePath=r,this._content=null,this._contentState=o.UNLOADED,this._gpuMemoryUsageInBytes=0,this.parent=n,this.children=[],this.refine=this._getRefine(e.refine),this.cacheNode=void 0,this.userData={},"geometricError"in e?this.geometricError=e.geometricError:(this.geometricError=this.parent&&this.parent.geometricError||t.geometricError,console.warn("3D Tile: Required prop geometricError is undefined. Using parent error")),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeCache(e),this._optimChildrenWithinParent=a.NOT_COMPUTED,this._initializeRenderingState(),Object.seal(this)}destroy(){this._header=null}isDestroyed(){return null===this._header}get gpuMemoryUsageInBytes(){return this._gpuMemoryUsageInBytes}get tileset(){return this._tileset}get depth(){return this._depth}get selectedFrame(){return this._selectedFrame}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get content(){return this._content}get contentReady(){return this._contentState===o.READY}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get contentAvailable(){return this.contentReady&&this.hasRenderContent||qi(this._expiredContent)&&!this.contentFailed}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this._contentState===o.UNLOADED}get contentExpired(){return this._contentState===o.EXPIRED}get contentFailed(){return this._contentState===o.FAILED}get url(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}get uri(){return this.tileset.getTileUrl(this.contentUri,this._basePath)}get boundingVolume(){return this._boundingVolume}get contentBoundingVolume(){return this._contentBoundingVolume||this._boundingVolume}get boundingSphere(){return this._boundingVolume.boundingSphere}get extras(){return this._header.extras}get depth(){return this._depth}getScreenSpaceError(t,e){const n=this._tileset,r=this.parent&&this.parent.geometricError||n.geometricError,i=e?r:this.geometricError;if(0===i)return 0;const s=Math.max(this._distanceToCamera,1e-7),{height:o,sseDenominator:a}=t;let u=i*o/(s*a);return u-=this._getDynamicScreenSpaceError(s)}_getDynamicScreenSpaceError(t){const e=this._tileset;if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const n=e._dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor;return function(t,e){const n=t*e;return 1-Math.exp(-n*n)}(t,n)*r}return 0}async loadContent(){if(this.hasEmptyContent)return!1;if(this._content)return!0;if(this.contentExpired&&(this.expireDate=void 0),this._contentState=o.LOADING,!await this.tileset._requestScheduler.scheduleRequest(this,function(t){return t._visible?t._contentState===o.UNLOADED?-1:Math.max(1e7-t._priority,0)||0:-1}))return this._contentState=o.UNLOADED,!1;try{const t=this.uri;let e;try{this.tileset._requestScheduler.startRequest(this),e=await pr(t,this.tileset.options.fetchOptions)}finally{this.tileset._requestScheduler.endRequest(this)}return this._content=await fr(e,[_n,h]),-1!==t.indexOf(".json")&&this._tileset._initializeTileHeaders(this._content,this,r.dirname(this.uri)),this._contentState=o.READY,this._contentLoaded(),!0}catch(t){throw this._contentState=o.FAILED,t}}unloadContent(){return!!this.hasRenderContent&&(this._content&&this._content.destroy&&this._content.destroy(),this._content=null,this._contentState=o.UNLOADED,!0)}updateVisibility(t){const e=this._tileset;if(this._updatedVisibilityFrame===e._updatedVisibilityFrame)return;const n=this.parent,r=n?n.computedTransform:this._tileset.modelMatrix,i=n?n._visibilityPlaneMask:ki.MASK_INDETERMINATE;this._updateTransform(r),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==ki.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._updatedVisibilityFrame=e._updatedVisibilityFrame}updateExpiration(){if(qi(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now(Vi);Date.lessThan(this.expireDate,t)&&(this._contentState=o.EXPIRED,this._expiredContent=this._content)}}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:r,tileset:i}=this,{clippingPlanes:s,clippingPlanesOriginMatrix:o}=i;if(s&&s.enabled){const t=s.computeIntersectionWithBoundingVolume(r,o);if(this._isClipped=t!==kr.INSIDE,t===kr.OUTSIDE)return ki.MASK_OUTSIDE}return function(t,e,n){if(yt(e,"boundingVolume is required."),yt(Number.isFinite(n),"parentPlaneMask is required."),n===ki.MASK_OUTSIDE||n===ki.MASK_INSIDE)return n;let r=ki.MASK_INSIDE;const i=t.planes;for(let s=0;s<t.planes.length;++s){const t=s<31?1<<s:0;if(s<31&&0==(n&t))continue;const o=ji.fromNormalDistance(i[s].normal,i[s].distance),a=e.intersectPlane(o);if(a===kr.OUTSIDE)return ki.MASK_OUTSIDE;a===kr.INTERSECTING&&(r|=t)}return r}(n,r,e)}contentVisibility(t){return!0}distanceToTile(t){const e=this._boundingVolume;return Math.sqrt(e.distanceSquaredTo(t.camera.position))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return Fi.subVectors(e.center,t.position),t.direction.dot(Fi)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}_initializeCache(t){this.cacheNode=void 0;let e,n,r=t.expire;r&&(e=r.duration,r.date&&(n=Date.fromIso8601(r.date))),this.expireDuration=e,this.expireDate=n}_initializeTransforms(t){this.transform=t.transform?new Fe(t.transform):new Fe;const e=this.parent,n=this._tileset,r=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Fe(r).multiplyRight(this.transform);const i=e&&e._initialTransform?e._initialTransform.clone():new Fe;this._initialTransform=new Fe(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._boundingVolume=Bi(t.boundingVolume,this.computedTransform),this._contentBoundingVolume=null,this._viewerRequestVolume=null,t.content&&t.content.boundingVolume&&(this._contentBoundingVolume=Bi(t.boundingVolume,this.computedTransform)),t.viewerRequestVolume&&(this._viewerRequestVolume=Bi(t.viewerRequestVolume,this.computedTransform))}_initializeContent(t){this._content={_tileset:this._tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=o.UNLOADED,this._expiredContent=void 0,this._serverKey=null,this.hasTilesetContent=!1,t.content&&(this.contentUri=t.content.uri||t.content.url,"url"in t&&(console.warn('Tileset 3D: "content.url" property deprecated. Use "content.uri" instead.'),this.contentUri=t.url),this._content=null,this.hasEmptyContent=!1,this.contentState=o.UNLOADED,this.fullUri=this._basePath+"/"+this.contentUri)}_initializeRenderingState(){this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ki.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._priority=0}_getRefine(t){switch(t){case"REPLACE":case"replace":return u.REPLACE;case"ADD":case"add":return u.ADD;default:return this.parent?this.parent.refine:u.REPLACE}}_isTileset(t){return Boolean(t.asset)}_contentLoaded(){switch(this._content&&this._content.type){case"vctr":case"geom":tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset(this._content)&&(this.hasTilesetContent=!0)}_updateTransform(t=new Fe){const e=t.clone().multiplyRight(this.transform);if(!!e.equals(this.computedTransform))return;this.computedTransform=e;const n=this._header,r=this._header.content;this._boundingVolume=Bi(n.boundingVolume,this.computedTransform,this._boundingVolume),this._contentBoundingVolume&&(this._contentBoundingVolume=Bi(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),this._viewerRequestVolume&&(this._viewerRequestVolume=Bi(n.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume))}}class Hi{constructor(t=0){this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return yt(t<this._array.length),this._array[t]}set(t,e){yt(t>=0),t>=this.length&&(this.length=t+1),this._array[t]=e}peek(){return this._array[this._length-1]}push(t){const e=this.length++;this._array[e]=t}pop(){return this._array[--this.length]}reserve(t){yt(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){yt(t>=0),this.length=t}trim(t=this.length){this._array.length=t}}class Wi{constructor(){this.traversal={stack:new Hi,stackMaximumLength:0},this.emptyTraversal={stack:new Hi,stackMaximumLength:0},this.result={_requestedTiles:[],selectedTiles:[],_emptyTiles:[],_hasMixedContent:!1},this._disableSkipLevelOfDetail=!1}traverse(t,e,n){if(this.root=t,this.options=n,this.result._requestedTiles.length=0,this.result.selectedTiles.length=0,this.result._emptyTiles.length=0,this.result._hasMixedContent=!1,this.updateTile(t,e),!t.isVisibleAndInRequestVolume)return!1;if(t.getScreenSpaceError(e,!0)<=n.maximumScreenSpaceError)return!1;const r=n.maximumScreenSpaceError;return this.executeTraversal(t,r,e),this.traversal.stack.trim(this.traversal.stackMaximumLength),this.emptyTraversal.stack.trim(this.emptyTraversal.stackMaximumLength),!0}selectTile(t,e){t._selectedFrame=e.frameNumber,this.result.selectedTiles.push(t)}selectDesiredTile(t,e){if(!this.options.skipLevelOfDetail)return void(t.contentAvailable&&this.selectTile(t,e));const n=t.contentAvailable?t:t._ancestorWithContentAvailable;n?n._shouldSelect=!0:this.selectDescendants(t,e)}visitTile(t,e,n){++t._statistics.visited,e._visitedFrame=n.frameNumber}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}getPriority(t,e){switch(t.refine){case u.ADD:return t._distanceToCamera;case u.REPLACE:const{parent:n}=t,r=n&&(!e.skipLevelOfDetail||0===t._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-r;default:return yt(!1)}}loadTile(t,e){(t.hasUnloadedContent||t.contentExpired)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t,this.options),this.result._requestedTiles.push(t))}updateTileVisibility(t,e){t.updateVisibility(e)}updateTile(t,e){this.updateTileVisibility(t,e),t.updateExpiration()}updateAndPushChildren(t,e,n){const{children:r}=t;for(const t of r)this.updateTile(t,n),e.push(t);return!0}canTraverse(t,e){return!(0===t.children.length||e.depthLimit<t.depth)&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e.maximumScreenSpaceError)}executeTraversal(t,e,n){const{traversal:r}=this,{stack:i}=r;for(i.push(t);i.length>0;){r.stackMaximumLength=Math.max(r.stackMaximumLength,i.length);const t=i.pop(),e=t.refine===u.ADD,s=t.refine===u.REPLACE,o=t.parent,a=!o||o._refines;let h=!1;this.canTraverse(t,this.options)&&(h=this.updateAndPushChildren(t,i,n)&&a);const c=!h&&a;t.hasRenderContent?e?(this.loadTile(t,n),this.selectDesiredTile(t,n)):s&&(this.loadTile(t,n),c&&this.selectDesiredTile(t,n)):(this.result._emptyTiles.push(t),this.loadTile(t,n),c&&this.selectDesiredTile(t,n)),this.touchTile(t,n),t._refines=h}}}class Qi{constructor(t,e,n){this.item=t,this.previous=e,this.next=n}}const Yi=t=>void 0!==t;class $i{constructor(){this.head=void 0,this.tail=void 0,this._length=0}get length(){return this._length}add(t){const e=new Qi(t,this.tail,void 0);return Yi(this.tail)?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){Yi(t)&&(Yi(t.previous)&&Yi(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):Yi(t.previous)?(t.previous.next=void 0,this.tail=t.previous):Yi(t.next)?(t.next.previous=void 0,this.head=t.next):(this.head=void 0,this.tail=void 0),t.next=void 0,t.previous=void 0,--this._length)}splice(t,e){if(t===e)return;this.remove(e);const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t}}const Zi=t=>void 0!==t;class Ki{constructor(){this._list=new $i,this._sentinel=this._list.add(),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t.cacheNode;Zi(e)&&this._list.splice(this._sentinel,e)}add(t,e,n){Zi(e.cacheNode)||(e.cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const r=e.cacheNode;Zi(r)&&(this._list.remove(r),e.cacheNode=void 0,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,i=1024*t.maximumMemoryUsage*1024,s=this._sentinel;let o=r.head;for(;o!==s&&(t.gpuMemoryUsageInBytes>i||n);){const n=o.item;o=o.next,this.unloadTile(t,n,e)}}trim(){this._trimTiles=!0}}const Ji="Tiles In Tileset(s)",Xi="Tiles In Memory",ts="Tiles In View",es="Tiles To Render",ns="Tiles Loaded",rs="Tiles Loading",is="Tiles Unloaded",ss="Failed Tile Loads",os="Points",as="Tile Memory Use",us=6378137,hs=6378137,cs=6356752.314245179;const ls={basePath:"",ellipsoid:mn.WGS84,modelMatrix:new Fe,throttleRequests:!1,maximumScreenSpaceError:16,maximumMemoryUsage:32,dynamicScreenSpaceError:!1,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:4,skipLevelOfDetail:!1,baseScreenSpaceError:1024,onTileLoad:()=>{},onTileUnload:()=>{},onTileLoadFail:(t,e,n)=>console.error(`A 3D tile failed to load: ${n} ${e}`)};class fs{constructor(t,e,n={}){yt(t),this.options={...ls,...n},this.url=e,this.basePath=r.dirname(e),this.modelMatrix=this.options.modelMatrix,this.stats=new Ln({id:e}),this._initializeStats(),this.gpuMemoryUsageInBytes=0,this.geometricError=void 0,this.userData={},this._queryParams={},this._requestScheduler=new Sr({throttleRequests:this.options.throttleRequests}),this._traverser=new Wi,this._cache=new Ki,this._processingQueue=[],this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.asset={},this.credits={},this._root=void 0,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._extras=void 0,this._allTilesAdditive=!0,this._hasMixedContent=!1,this._maximumScreenSpaceError=n.maximumScreenSpaceError,this._maximumMemoryUsage=n.maximumMemoryUsage,this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._readyPromise=Promise.resolve(),this._classificationType=this.options.classificationType,this._ellipsoid=this.options.ellipsoid,this._dynamicScreenSpaceErrorComputedDensity=0,this._initializeTileSet(t,this.options)}destroy(){this._destroy()}get properties(){return this._properties}get ready(){return Boolean(this._root)}get readyPromise(){return this._readyPromise.promise}get tilesLoaded(){return this._tilesLoaded}get queryParams(){return function(t){const e=[];for(const n of Object.keys(t))e.push(`${n}=${t[n]}`);switch(e.length){case 0:return"";case 1:return`?${e[0]}`;default:return`?${e.join("&")}`}}(this._queryParams)}get root(){return this._root}get boundingSphere(){return this._checkReady(),this._root.updateTransform(this.modelMatrix),this._root.boundingSphere}get timeSinceLoad(){return this._timeSinceLoad}get maximumMemoryUsage(){return this._maximumMemoryUsage}set maximumMemoryUsage(t){yt(t>0),this._maximumMemoryUsage=t}get ellipsoid(){return this.options.ellipsoid}get extras(){return this._extras}getTileUrl(t,e){return(t=>t.startsWith("data:"))(t)?t:`${e||this.basePath}/${t}${this.queryParams}`}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}update(t){this._updatedVisibilityFrame++,this._cache.reset(),this._traverser.traverse(this.root,t,this.options),Object.assign(this,this._traverser.result);const e=this._requestedTiles;for(const t of e)this._loadTile(t);this._unloadTiles();let n=0,r=0;for(const t of this.selectedTiles)t.contentAvailable&&(n++,t.content.pointCount&&(r+=t.content.pointCount));this.stats.get(ts).count=this.selectedTiles.length,this.stats.get(es).count=n,this.stats.get(os).count=r}trimLoadedTiles(){this._cache.trim()}addTileToCache(t){this._cache.add(this,t,(t,e)=>t._addTileToCache(e))}_initializeTileSet(t,e){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:e.attributions||[]},this._properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this._extras=t.extras,this._root=this._initializeTileHeaders(t,null,this.basePath),this._calculateViewProps()}_calculateViewProps(){const t=this._root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new st,void(this.zoom=16);this.cartographicCenter=mn.WGS84.cartesianToCartographic(e,new st),this.zoom=function(t){const{halfAxes:e,radius:n,width:r,height:i}=t;if(e){const[t,,,,n,,,,r]=e;return(Math.log2(us/t/2)+Math.log2(hs/n/2)+Math.log2(cs/r/2))/3}if(n)return Math.log2(cs/n);if(i&&r){return(Math.log2(us/r)+Math.log2(hs/i))/2}return 18}(t.boundingVolume)}_initializeStats(){this.stats.get(Ji),this.stats.get(rs),this.stats.get(Xi),this.stats.get(ts),this.stats.get(es),this.stats.get(ns),this.stats.get(is),this.stats.get(ss),this.stats.get(os,"memory"),this.stats.get(as,"memory")}_initializeTileHeaders(t,e,n){const r=new Gi(this,t.root,e,n);e&&(e.children.push(r),r._depth=e._depth+1);const i=[];for(i.push(r);i.length>0;){const t=i.pop();this.stats.get(Ji).incrementCount();const e=t._header.children||[];for(const r of e){const e=new Gi(this,r,t,n);t.children.push(e),e._depth=t._depth+1,i.push(e)}}return r}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;this.stats.get(rs).incrementCount();try{e=await t.loadContent()}catch(e){return this.stats.get(rs).decrementCount(),this.stats.get(ss).incrementCount(),void this.options.onTileLoadFail(t,e.message||e.toString(),t.url)}this.stats.get(rs).decrementCount(),e&&(t&&t._content&&function(t,e){c(t),c(e);const{rtcCenter:n,rotateYtoZ:r}=e,{computedTransform:i,_boundingVolume:{center:s}}=t;let o=new Fe(i);if(n&&o.translate(n),r){const t=(new Fe).rotateX(Math.PI/2);o=o.multiplyRight(t)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new st(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const u=mn.WGS84.cartesianToCartographic(a,new st),h=mn.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=h.multiplyRight(o),e.cartographicOrigin=u,e.modelMatrix=e.cartographicModelMatrix}(t,t._content),this.options.onTileLoad(t))}_addTileToCache(t){this.stats.get(ns).incrementCount(),this.stats.get(Xi).incrementCount(),this.gpuMemoryUsageInBytes+=t._content.byteLength||0,this.stats.get(as).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.stats.get(Xi).decrementCount(),this.stats.get(is).incrementCount(),this.gpuMemoryUsageInBytes-=t._content.byteLength||0,this.stats.get(as).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_destroy(){const t=[];for(this._root&&t.push(this._root);t.length>0;){for(const n of e.children)t.push(n);const e=t.pop();e.destroy()}this._root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const e of t.children)n.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}}async function ys(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{t.headers.get("Content-Type").includes("application/json")?e+=await t.text():e+=t.statusText}catch(t){return e}return e}const ds="https://api.cesium.com/v1/assets";async function ms(t,e){if(!e){const n=await async function(t){yt(t);const e=ds,n={Authorization:`Bearer ${t}`},r=await fetch(e,{headers:n});if(!r.ok)throw new Error(await ys(r));return await r.json()}(t);for(const t of n.items)"3DTILES"===t.type&&(e=t.id)}const n=await async function(t,e){yt(t,e);const n=`${ds}/${e}/endpoint`,r={Authorization:`Bearer ${t}`},i=await fetch(n,{headers:r});if(!i.ok)throw new Error(await ys(i));return await i.json()}(t,e),{type:r,url:i}=n;return yt("3DTILES"===r&&i),n.headers={Authorization:`Bearer ${n.accessToken}`},n}n.d(e,"TILE3D_TYPE",function(){return i}),n.d(e,"Tileset3DLoader",function(){return h}),n.d(e,"Tile3DLoader",function(){return _n}),n.d(e,"Tile3DWriter",function(){return On}),n.d(e,"Tileset3D",function(){return fs}),n.d(e,"Tile3DFeatureTable",function(){return ft}),n.d(e,"Tile3DBatchTable",function(){return St}),n.d(e,"_getIonTilesetMetadata",function(){return ms})}])});