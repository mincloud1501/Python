{"version":3,"sources":["../../../src/parsers/parse-3d-tile-batched-model.js"],"names":["GL","Tile3DFeatureTable","parse3DTileHeaderSync","parse3DTileTablesHeaderSync","parse3DTileTablesSync","parse3DTileGLTFViewSync","extractGLTF","GLTF_FORMAT","parseBatchedModel3DTile","tile","arrayBuffer","byteOffset","options","context","parseBatchedModel","EMBEDDED","parseBatchedModel3DTileSync","featureTable","featureTableJson","featureTableBinary","rtcCenter","getGlobalProperty","FLOAT"],"mappings":"AAGA,SAAQA,EAAR,QAAiB,kBAAjB;AACA,OAAOC,kBAAP,MAA+B,kCAA/B;AAGA,SAAQC,qBAAR,QAAoC,gCAApC;AACA,SAAQC,2BAAR,EAAqCC,qBAArC,QAAiE,gCAAjE;AACA,SAAQC,uBAAR,EAAiCC,WAAjC,EAA8CC,WAA9C,QAAgE,mCAAhE;AAEA,OAAO,eAAeC,uBAAf,CAAuCC,IAAvC,EAA6CC,WAA7C,EAA0DC,UAA1D,EAAsEC,OAAtE,EAA+EC,OAA/E,EAAwF;AAC7FF,EAAAA,UAAU,GAAGG,iBAAiB,CAACL,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,EAAyCC,OAAzC,CAA9B;AACA,QAAMP,WAAW,CAACG,IAAD,EAAOF,WAAW,CAACQ,QAAnB,EAA6BH,OAA7B,EAAsCC,OAAtC,CAAjB;AACA,SAAOF,UAAP;AACD;AAED,OAAO,SAASK,2BAAT,CAAqCP,IAArC,EAA2CC,WAA3C,EAAwDC,UAAxD,EAAoEC,OAApE,EAA6EC,OAA7E,EAAsF;AAC3FF,EAAAA,UAAU,GAAGG,iBAAiB,CAACL,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,EAAyCC,OAAzC,CAA9B;AACAP,EAAAA,WAAW,CAACG,IAAD,EAAOF,WAAW,CAACQ,QAAnB,EAA6BH,OAA7B,EAAsCC,OAAtC,CAAX;AACA,SAAOF,UAAP;AACD;AAED,OAAO,SAASG,iBAAT,CAA2BL,IAA3B,EAAiCC,WAAjC,EAA8CC,UAA9C,EAA0DC,OAA1D,EAAmEC,OAAnE,EAA4E;AACjFF,EAAAA,UAAU,GAAGT,qBAAqB,CAACO,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,CAAlC;AAEAD,EAAAA,UAAU,GAAGR,2BAA2B,CAACM,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,CAAxC;AACAD,EAAAA,UAAU,GAAGP,qBAAqB,CAACK,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,CAAlC;AAEAD,EAAAA,UAAU,GAAGN,uBAAuB,CAACI,IAAD,EAAOC,WAAP,EAAoBC,UAApB,EAAgCC,OAAhC,CAApC;AAEA,QAAMK,YAAY,GAAG,IAAIhB,kBAAJ,CAAuBQ,IAAI,CAACS,gBAA5B,EAA8CT,IAAI,CAACU,kBAAnD,CAArB;AACAV,EAAAA,IAAI,CAACW,SAAL,GAAiBH,YAAY,CAACI,iBAAb,CAA+B,YAA/B,EAA6CrB,EAAE,CAACsB,KAAhD,EAAuD,CAAvD,CAAjB;AAEAhB,EAAAA,WAAW,CAACG,IAAD,EAAOF,WAAW,CAACQ,QAAnB,EAA6BH,OAA7B,EAAsCC,OAAtC,CAAX;AAEA,SAAOF,UAAP;AACD","sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {GL} from '@loaders.gl/math'; // math.gl/geometry;\nimport Tile3DFeatureTable from '../classes/tile-3d-feature-table';\n// import Tile3DBatchTable from '../classes/tile-3d-batch-table';\n\nimport {parse3DTileHeaderSync} from './helpers/parse-3d-tile-header';\nimport {parse3DTileTablesHeaderSync, parse3DTileTablesSync} from './helpers/parse-3d-tile-tables';\nimport {parse3DTileGLTFViewSync, extractGLTF, GLTF_FORMAT} from './helpers/parse-3d-tile-gltf-view';\n\nexport async function parseBatchedModel3DTile(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = parseBatchedModel(tile, arrayBuffer, byteOffset, options, context);\n  await extractGLTF(tile, GLTF_FORMAT.EMBEDDED, options, context);\n  return byteOffset;\n}\n\nexport function parseBatchedModel3DTileSync(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = parseBatchedModel(tile, arrayBuffer, byteOffset, options, context);\n  extractGLTF(tile, GLTF_FORMAT.EMBEDDED, options, context);\n  return byteOffset;\n}\n\nexport function parseBatchedModel(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = parse3DTileHeaderSync(tile, arrayBuffer, byteOffset, options);\n\n  byteOffset = parse3DTileTablesHeaderSync(tile, arrayBuffer, byteOffset, options);\n  byteOffset = parse3DTileTablesSync(tile, arrayBuffer, byteOffset, options);\n\n  byteOffset = parse3DTileGLTFViewSync(tile, arrayBuffer, byteOffset, options);\n\n  const featureTable = new Tile3DFeatureTable(tile.featureTableJson, tile.featureTableBinary);\n  tile.rtcCenter = featureTable.getGlobalProperty('RTC_CENTER', GL.FLOAT, 3);\n\n  extractGLTF(tile, GLTF_FORMAT.EMBEDDED, options, context);\n\n  return byteOffset;\n}\n"],"file":"parse-3d-tile-batched-model.js"}