{"version":3,"sources":["../../../src/lib/perspective-off-center-frustum.js"],"names":["Vector3","Vector4","Matrix4","assert","CullingVolume","scratchPlaneRightVector","scratchPlaneNearCenter","scratchPlaneFarCenter","scratchPlaneNormal","PerspectiveOffCenterFrustum","options","near","far","left","_left","undefined","right","_right","top","_top","bottom","_bottom","_near","_far","_cullingVolume","_perspectiveMatrix","_infinitePerspective","other","position","direction","up","planes","copy","cross","nearCenter","multiplyByScalar","add","farCenter","normal","subtract","normalize","plane","x","y","z","w","dot","negate","drawingBufferWidth","drawingBufferHeight","distance","result","update","Number","isFinite","inverseNear","tanTheta","pixelHeight","pixelWidth","frustum","Infinity"],"mappings":";;;AAOA,SAAQA,OAAR,EAAiBC,OAAjB,EAA0BC,OAA1B,EAAmCC,MAAnC,QAAgD,SAAhD;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AAEA,IAAMC,uBAAuB,GAAG,IAAIL,OAAJ,EAAhC;AACA,IAAMM,sBAAsB,GAAG,IAAIN,OAAJ,EAA/B;AACA,IAAMO,qBAAqB,GAAG,IAAIP,OAAJ,EAA9B;AACA,IAAMQ,kBAAkB,GAAG,IAAIR,OAAJ,EAA3B;;IAEqBS,2B;AA8BnB,yCAA0B;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AACxBA,IAAAA,OAAO;AAAIC,MAAAA,IAAI,EAAE,GAAV;AAAeC,MAAAA,GAAG,EAAE;AAApB,OAAoCF,OAApC,CAAP;AAOA,SAAKG,IAAL,GAAYH,OAAO,CAACG,IAApB;AACA,SAAKC,KAAL,GAAaC,SAAb;AAOA,SAAKC,KAAL,GAAaN,OAAO,CAACM,KAArB;AACA,SAAKC,MAAL,GAAcF,SAAd;AAOA,SAAKG,GAAL,GAAWR,OAAO,CAACQ,GAAnB;AACA,SAAKC,IAAL,GAAYJ,SAAZ;AAOA,SAAKK,MAAL,GAAcV,OAAO,CAACU,MAAtB;AACA,SAAKC,OAAL,GAAeN,SAAf;AAOA,SAAKJ,IAAL,GAAYD,OAAO,CAACC,IAApB;AACA,SAAKW,KAAL,GAAa,KAAKX,IAAlB;AAOA,SAAKC,GAAL,GAAWF,OAAO,CAACE,GAAnB;AACA,SAAKW,IAAL,GAAY,KAAKX,GAAjB;AAEA,SAAKY,cAAL,GAAsB,IAAIpB,aAAJ,EAAtB;AACA,SAAKqB,kBAAL,GAA0B,IAAIvB,OAAJ,EAA1B;AACA,SAAKwB,oBAAL,GAA4B,IAAIxB,OAAJ,EAA5B;AACD;;;;4BAMO;AACN,aAAO,IAAIO,2BAAJ,CAAgC;AACrCO,QAAAA,KAAK,EAAE,KAAKA,KADyB;AAErCH,QAAAA,IAAI,EAAE,KAAKA,IAF0B;AAGrCK,QAAAA,GAAG,EAAE,KAAKA,GAH2B;AAIrCE,QAAAA,MAAM,EAAE,KAAKA,MAJwB;AAKrCT,QAAAA,IAAI,EAAE,KAAKA,IAL0B;AAMrCC,QAAAA,GAAG,EAAE,KAAKA;AAN2B,OAAhC,CAAP;AAQD;;;2BASMe,K,EAAO;AACZ,aACEA,KAAK,IACLA,KAAK,YAAYlB,2BADjB,IAEA,KAAKO,KAAL,KAAeW,KAAK,CAACX,KAFrB,IAGA,KAAKH,IAAL,KAAcc,KAAK,CAACd,IAHpB,IAIA,KAAKK,GAAL,KAAaS,KAAK,CAACT,GAJnB,IAKA,KAAKE,MAAL,KAAgBO,KAAK,CAACP,MALtB,IAMA,KAAKT,IAAL,KAAcgB,KAAK,CAAChB,IANpB,IAOA,KAAKC,GAAL,KAAae,KAAK,CAACf,GARrB;AAUD;;;yCA0CoBgB,Q,EAAUC,S,EAAWC,E,EAAI;AAC5C3B,MAAAA,MAAM,CAACyB,QAAD,EAAW,uBAAX,CAAN;AACAzB,MAAAA,MAAM,CAAC0B,SAAD,EAAY,wBAAZ,CAAN;AACA1B,MAAAA,MAAM,CAAC2B,EAAD,EAAK,iBAAL,CAAN;AAEA,UAAMC,MAAM,GAAG,KAAKP,cAAL,CAAoBO,MAAnC;AAEA,UAAMf,KAAK,GAAGX,uBAAuB,CAAC2B,IAAxB,CAA6BH,SAA7B,EAAwCI,KAAxC,CAA8CH,EAA9C,CAAd;AAEA,UAAMI,UAAU,GAAG5B,sBAAsB,CACtC0B,IADgB,CACXH,SADW,EAEhBM,gBAFgB,CAEC,KAAKxB,IAFN,EAGhByB,GAHgB,CAGZR,QAHY,CAAnB;AAKA,UAAMS,SAAS,GAAG9B,qBAAqB,CACpCyB,IADe,CACVH,SADU,EAEfM,gBAFe,CAEE,KAAKvB,GAFP,EAGfwB,GAHe,CAGXR,QAHW,CAAlB;AAKA,UAAIU,MAAM,GAAG9B,kBAAb;AAGA8B,MAAAA,MAAM,CACHN,IADH,CACQhB,KADR,EAEGmB,gBAFH,CAEoB,KAAKtB,IAFzB,EAGGuB,GAHH,CAGOF,UAHP,EAIGK,QAJH,CAIYX,QAJZ,EAKGY,SALH,GAMGP,KANH,CAMSH,EANT,EAOGU,SAPH;AASAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACA,UAAIwC,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAlB;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUJ,MAAM,CAACI,CAAjB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUL,MAAM,CAACK,CAAjB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUN,MAAM,CAACM,CAAjB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAACP,MAAM,CAACQ,GAAP,CAAWlB,QAAX,CAAX;AAGAU,MAAAA,MAAM,CACHN,IADH,CACQhB,KADR,EAEGmB,gBAFH,CAEoB,KAAKnB,KAFzB,EAGGoB,GAHH,CAGOF,UAHP,EAIGK,QAJH,CAIYX,QAJZ,EAKGY,SALH,GAMGP,KANH,CAMSH,EANT,EAOGU,SAPH;AASAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACAwC,MAAAA,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAd;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUJ,MAAM,CAACI,CAAjB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUL,MAAM,CAACK,CAAjB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUN,MAAM,CAACM,CAAjB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAACP,MAAM,CAACQ,GAAP,CAAWlB,QAAX,CAAX;AAGAU,MAAAA,MAAM,CACHN,IADH,CACQF,EADR,EAEGK,gBAFH,CAEoB,KAAKf,MAFzB,EAGGgB,GAHH,CAGOF,UAHP,EAIGK,QAJH,CAIYX,QAJZ,EAKGY,SALH,GAMGP,KANH,CAMSjB,KANT,EAOGwB,SAPH;AASAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACAwC,MAAAA,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAd;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUJ,MAAM,CAACI,CAAjB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUL,MAAM,CAACK,CAAjB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUN,MAAM,CAACM,CAAjB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAACP,MAAM,CAACQ,GAAP,CAAWlB,QAAX,CAAX;AAGAU,MAAAA,MAAM,CACHN,IADH,CACQF,EADR,EAEGK,gBAFH,CAEoB,KAAKjB,GAFzB,EAGGkB,GAHH,CAGOF,UAHP,EAIGK,QAJH,CAIYX,QAJZ,EAKGY,SALH,GAMGP,KANH,CAMSjB,KANT,EAOGwB,SAPH;AASAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACAwC,MAAAA,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAd;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUJ,MAAM,CAACI,CAAjB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUL,MAAM,CAACK,CAAjB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUN,MAAM,CAACM,CAAjB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAACP,MAAM,CAACQ,GAAP,CAAWlB,QAAX,CAAX;AAEAU,MAAAA,MAAM,GAAG,IAAItC,OAAJ,GAAcgC,IAAd,CAAmBH,SAAnB,EAA8BW,SAA9B,EAAT;AAGAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACAwC,MAAAA,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAd;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUb,SAAS,CAACa,CAApB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUd,SAAS,CAACc,CAApB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUf,SAAS,CAACe,CAApB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAAChB,SAAS,CAACiB,GAAV,CAAcZ,UAAd,CAAX;AAGAI,MAAAA,MAAM,CACHN,IADH,CACQH,SADR,EAEGkB,MAFH,GAGGP,SAHH;AAKAT,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAN,IAAa,IAAI9B,OAAJ,EAAzB;AACAwC,MAAAA,KAAK,GAAGV,MAAM,CAAC,CAAD,CAAd;AACAU,MAAAA,KAAK,CAACC,CAAN,GAAUJ,MAAM,CAACI,CAAjB;AACAD,MAAAA,KAAK,CAACE,CAAN,GAAUL,MAAM,CAACK,CAAjB;AACAF,MAAAA,KAAK,CAACG,CAAN,GAAUN,MAAM,CAACM,CAAjB;AACAH,MAAAA,KAAK,CAACI,CAAN,GAAU,CAACP,MAAM,CAACQ,GAAP,CAAWT,SAAX,CAAX;AAEA,aAAO,KAAKb,cAAZ;AACD;;;uCA8BkBwB,kB,EAAoBC,mB,EAAqBC,Q,EAAUC,M,EAAQ;AAC5EC,MAAAA,MAAM,CAAC,IAAD,CAAN;AAEAjD,MAAAA,MAAM,CAACkD,MAAM,CAACC,QAAP,CAAgBN,kBAAhB,KAAuCK,MAAM,CAACC,QAAP,CAAgBL,mBAAhB,CAAxC,CAAN;AAEA9C,MAAAA,MAAM,CAAC6C,kBAAkB,GAAG,CAAtB,CAAN;AAEA7C,MAAAA,MAAM,CAAC8C,mBAAmB,GAAG,CAAvB,CAAN;AAEA9C,MAAAA,MAAM,CAAC+C,QAAQ,GAAG,CAAZ,CAAN;AAEA/C,MAAAA,MAAM,CAACgD,MAAD,CAAN;AAGA,UAAMI,WAAW,GAAG,MAAM,KAAK5C,IAA/B;AACA,UAAI6C,QAAQ,GAAG,KAAKtC,GAAL,GAAWqC,WAA1B;AACA,UAAME,WAAW,GAAI,MAAMP,QAAN,GAAiBM,QAAlB,GAA8BP,mBAAlD;AACAO,MAAAA,QAAQ,GAAG,KAAKxC,KAAL,GAAauC,WAAxB;AACA,UAAMG,UAAU,GAAI,MAAMR,QAAN,GAAiBM,QAAlB,GAA8BR,kBAAjD;AAEAG,MAAAA,MAAM,CAACT,CAAP,GAAWgB,UAAX;AACAP,MAAAA,MAAM,CAACR,CAAP,GAAWc,WAAX;AACA,aAAON,MAAP;AACD;;;wBAtMsB;AACrBC,MAAAA,MAAM,CAAC,IAAD,CAAN;AACA,aAAO,KAAK3B,kBAAZ;AACD;;;wBAU8B;AAC7B2B,MAAAA,MAAM,CAAC,IAAD,CAAN;AACA,aAAO,KAAK1B,oBAAZ;AACD;;;;;;SAjJkBjB,2B;;AA2UrB,SAAS2C,MAAT,CAAgBO,OAAhB,EAAyB;AACvBxD,EAAAA,MAAM,CACJkD,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAAC3C,KAAxB,KACEqC,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAAC9C,IAAxB,CADF,IAEEwC,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAACzC,GAAxB,CAFF,IAGEmC,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAACvC,MAAxB,CAHF,IAIEiC,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAAChD,IAAxB,CAJF,IAKE0C,MAAM,CAACC,QAAP,CAAgBK,OAAO,CAAC/C,GAAxB,CANE,CAAN;AADuB,MAWhBM,GAXgB,GAWuByC,OAXvB,CAWhBzC,GAXgB;AAAA,MAWXE,MAXW,GAWuBuC,OAXvB,CAWXvC,MAXW;AAAA,MAWHJ,KAXG,GAWuB2C,OAXvB,CAWH3C,KAXG;AAAA,MAWIH,IAXJ,GAWuB8C,OAXvB,CAWI9C,IAXJ;AAAA,MAWUF,IAXV,GAWuBgD,OAXvB,CAWUhD,IAXV;AAAA,MAWgBC,GAXhB,GAWuB+C,OAXvB,CAWgB/C,GAXhB;;AAavB,MACEM,GAAG,KAAKyC,OAAO,CAACxC,IAAhB,IACAC,MAAM,KAAKuC,OAAO,CAACtC,OADnB,IAEAR,IAAI,KAAK8C,OAAO,CAAC7C,KAFjB,IAGAE,KAAK,KAAK2C,OAAO,CAAC1C,MAHlB,IAIAN,IAAI,KAAKgD,OAAO,CAACrC,KAJjB,IAKAV,GAAG,KAAK+C,OAAO,CAACpC,IANlB,EAOE;AACApB,IAAAA,MAAM,CACJwD,OAAO,CAAChD,IAAR,GAAe,CAAf,IAAoBgD,OAAO,CAAChD,IAAR,GAAegD,OAAO,CAAC/C,GADvC,EAEJ,mDAFI,CAAN;AAKA+C,IAAAA,OAAO,CAAC7C,KAAR,GAAgBD,IAAhB;AACA8C,IAAAA,OAAO,CAAC1C,MAAR,GAAiBD,KAAjB;AACA2C,IAAAA,OAAO,CAACxC,IAAR,GAAeD,GAAf;AACAyC,IAAAA,OAAO,CAACtC,OAAR,GAAkBD,MAAlB;AACAuC,IAAAA,OAAO,CAACrC,KAAR,GAAgBX,IAAhB;AACAgD,IAAAA,OAAO,CAACpC,IAAR,GAAeX,GAAf;AACA+C,IAAAA,OAAO,CAAClC,kBAAR,GAA6B,IAAIvB,OAAJ,GAAcyD,OAAd,CAAsB;AACjD9C,MAAAA,IAAI,EAAJA,IADiD;AAEjDG,MAAAA,KAAK,EAALA,KAFiD;AAGjDI,MAAAA,MAAM,EAANA,MAHiD;AAIjDF,MAAAA,GAAG,EAAHA,GAJiD;AAKjDP,MAAAA,IAAI,EAAJA,IALiD;AAMjDC,MAAAA,GAAG,EAAHA;AANiD,KAAtB,CAA7B;AAQA+C,IAAAA,OAAO,CAACjC,oBAAR,GAA+B,IAAIxB,OAAJ,GAAcyD,OAAd,CAAsB;AACnD9C,MAAAA,IAAI,EAAJA,IADmD;AAEnDG,MAAAA,KAAK,EAALA,KAFmD;AAGnDI,MAAAA,MAAM,EAANA,MAHmD;AAInDF,MAAAA,GAAG,EAAHA,GAJmD;AAKnDP,MAAAA,IAAI,EAAJA,IALmD;AAMnDC,MAAAA,GAAG,EAAEgD;AAN8C,KAAtB,CAA/B;AAQD;AACF","sourcesContent":["// This file is derived from the Cesium math library under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\n// Note: This class is still an experimental export, mainly used by other test cases\n// - It has not been fully adapted to math.gl conventions\n// - Documentation has not been ported\n\nimport {Vector3, Vector4, Matrix4, assert} from 'math.gl';\nimport CullingVolume from './culling-volume';\n\nconst scratchPlaneRightVector = new Vector3();\nconst scratchPlaneNearCenter = new Vector3();\nconst scratchPlaneFarCenter = new Vector3();\nconst scratchPlaneNormal = new Vector3();\n\nexport default class PerspectiveOffCenterFrustum {\n  /**\n   * The viewing frustum is defined by 6 planes.\n   * Each plane is represented by a {@link Vector4} object, where the x, y, and z components\n   * define the unit vector normal to the plane, and the w component is the distance of the\n   * plane from the origin/camera position.\n   *\n   * @alias PerspectiveOffCenterFrustum\n   * @constructor\n   *\n   * @param {Object} [options] An object with the following properties:\n   * @param {Number} [options.left] The left clipping plane distance.\n   * @param {Number} [options.right] The right clipping plane distance.\n   * @param {Number} [options.top] The top clipping plane distance.\n   * @param {Number} [options.bottom] The bottom clipping plane distance.\n   * @param {Number} [options.near=1.0] The near clipping plane distance.\n   * @param {Number} [options.far=500000000.0] The far clipping plane distance.\n   *\n   * @example\n   * const frustum = new PerspectiveOffCenterFrustum({\n   *     left : -1.0,\n   *     right : 1.0,\n   *     top : 1.0,\n   *     bottom : -1.0,\n   *     near : 1.0,\n   *     far : 100.0\n   * });\n   *\n   * @see PerspectiveFrustum\n   */\n  constructor(options = {}) {\n    options = {near: 1.0, far: 500000000.0, ...options};\n\n    /**\n     * Defines the left clipping plane.\n     * @type {Number}\n     * @default undefined\n     */\n    this.left = options.left;\n    this._left = undefined;\n\n    /**\n     * Defines the right clipping plane.\n     * @type {Number}\n     * @default undefined\n     */\n    this.right = options.right;\n    this._right = undefined;\n\n    /**\n     * Defines the top clipping plane.\n     * @type {Number}\n     * @default undefined\n     */\n    this.top = options.top;\n    this._top = undefined;\n\n    /**\n     * Defines the bottom clipping plane.\n     * @type {Number}\n     * @default undefined\n     */\n    this.bottom = options.bottom;\n    this._bottom = undefined;\n\n    /**\n     * The distance of the near plane.\n     * @type {Number}\n     * @default 1.0\n     */\n    this.near = options.near;\n    this._near = this.near;\n\n    /**\n     * The distance of the far plane.\n     * @type {Number}\n     * @default 500000000.0\n     */\n    this.far = options.far;\n    this._far = this.far;\n\n    this._cullingVolume = new CullingVolume();\n    this._perspectiveMatrix = new Matrix4();\n    this._infinitePerspective = new Matrix4();\n  }\n\n  /**\n   * Returns a duplicate of a PerspectiveOffCenterFrustum instance.\n   * @returns {PerspectiveOffCenterFrustum} A new PerspectiveFrustum instance.\n   * */\n  clone() {\n    return new PerspectiveOffCenterFrustum({\n      right: this.right,\n      left: this.left,\n      top: this.top,\n      bottom: this.bottom,\n      near: this.near,\n      far: this.far\n    });\n  }\n\n  /**\n   * Compares the provided PerspectiveOffCenterFrustum componentwise and returns\n   * <code>true</code> if they are equal, <code>false</code> otherwise.\n   *\n   * @param {PerspectiveOffCenterFrustum} [other] The right hand side PerspectiveOffCenterFrustum.\n   * @returns {Boolean} <code>true</code> if they are equal, <code>false</code> otherwise.\n   */\n  equals(other) {\n    return (\n      other &&\n      other instanceof PerspectiveOffCenterFrustum &&\n      this.right === other.right &&\n      this.left === other.left &&\n      this.top === other.top &&\n      this.bottom === other.bottom &&\n      this.near === other.near &&\n      this.far === other.far\n    );\n  }\n\n  /**\n   * Gets the perspective projection matrix computed from the view frustum.\n   * @memberof PerspectiveOffCenterFrustum.prototype\n   * @type {Matrix4}\n   * @readonly\n   *\n   * @see PerspectiveOffCenterFrustum#infiniteProjectionMatrix\n   */\n  get projectionMatrix() {\n    update(this);\n    return this._perspectiveMatrix;\n  }\n\n  /**\n   * Gets the perspective projection matrix computed from the view frustum with an infinite far plane.\n   * @memberof PerspectiveOffCenterFrustum.prototype\n   * @type {Matrix4}\n   * @readonly\n   *\n   * @see PerspectiveOffCenterFrustum#projectionMatrix\n   */\n  get infiniteProjectionMatrix() {\n    update(this);\n    return this._infinitePerspective;\n  }\n\n  /**\n   * Creates a culling volume for this frustum.\n   *\n   * @param {Vector3} position The eye position.\n   * @param {Vector3} direction The view direction.\n   * @param {Vector3} up The up direction.\n   * @returns {CullingVolume} A culling volume at the given position and orientation.\n   *\n   * @example\n   * // Check if a bounding volume intersects the frustum.\n   * const cullingVolume = frustum.computeCullingVolume(cameraPosition, cameraDirection, cameraUp);\n   * const intersect = cullingVolume.computeVisibility(boundingVolume);\n   */\n  // eslint-disable-next-line complexity, max-statements\n  computeCullingVolume(position, direction, up) {\n    assert(position, 'position is required.');\n    assert(direction, 'direction is required.');\n    assert(up, 'up is required.');\n\n    const planes = this._cullingVolume.planes;\n\n    const right = scratchPlaneRightVector.copy(direction).cross(up);\n\n    const nearCenter = scratchPlaneNearCenter\n      .copy(direction)\n      .multiplyByScalar(this.near)\n      .add(position);\n\n    const farCenter = scratchPlaneFarCenter\n      .copy(direction)\n      .multiplyByScalar(this.far)\n      .add(position);\n\n    let normal = scratchPlaneNormal;\n\n    // Left plane computation\n    normal\n      .copy(right)\n      .multiplyByScalar(this.left)\n      .add(nearCenter)\n      .subtract(position)\n      .normalize()\n      .cross(up)\n      .normalize();\n\n    planes[0] = planes[0] || new Vector4();\n    let plane = planes[0];\n    plane.x = normal.x;\n    plane.y = normal.y;\n    plane.z = normal.z;\n    plane.w = -normal.dot(position);\n\n    // Right plane computation\n    normal\n      .copy(right)\n      .multiplyByScalar(this.right)\n      .add(nearCenter)\n      .subtract(position)\n      .normalize()\n      .cross(up)\n      .normalize();\n\n    planes[1] = planes[1] || new Vector4();\n    plane = planes[1];\n    plane.x = normal.x;\n    plane.y = normal.y;\n    plane.z = normal.z;\n    plane.w = -normal.dot(position);\n\n    // Bottom plane computation\n    normal\n      .copy(up)\n      .multiplyByScalar(this.bottom)\n      .add(nearCenter)\n      .subtract(position)\n      .normalize()\n      .cross(right)\n      .normalize();\n\n    planes[2] = planes[2] || new Vector4();\n    plane = planes[2];\n    plane.x = normal.x;\n    plane.y = normal.y;\n    plane.z = normal.z;\n    plane.w = -normal.dot(position);\n\n    // Top plane computation\n    normal\n      .copy(up)\n      .multiplyByScalar(this.top)\n      .add(nearCenter)\n      .subtract(position)\n      .normalize()\n      .cross(right)\n      .normalize();\n\n    planes[3] = planes[3] || new Vector4();\n    plane = planes[3];\n    plane.x = normal.x;\n    plane.y = normal.y;\n    plane.z = normal.z;\n    plane.w = -normal.dot(position);\n\n    normal = new Vector3().copy(direction).normalize();\n\n    // Near plane computation\n    planes[4] = planes[4] || new Vector4();\n    plane = planes[4];\n    plane.x = direction.x;\n    plane.y = direction.y;\n    plane.z = direction.z;\n    plane.w = -direction.dot(nearCenter);\n\n    // Far plane computation\n    normal\n      .copy(direction)\n      .negate()\n      .normalize();\n\n    planes[5] = planes[5] || new Vector4();\n    plane = planes[5];\n    plane.x = normal.x;\n    plane.y = normal.y;\n    plane.z = normal.z;\n    plane.w = -normal.dot(farCenter);\n\n    return this._cullingVolume;\n  }\n\n  /**\n   * Returns the pixel's width and height in meters.\n   *\n   * @param {Number} drawingBufferWidth The width of the drawing buffer.\n   * @param {Number} drawingBufferHeight The height of the drawing buffer.\n   * @param {Number} distance The distance to the near plane in meters.\n   * @param {Vector2} result The object onto which to store the result.\n   * @returns {Vector2} The modified result parameter or a new instance of {@link Vector2} with the pixel's width and height in the x and y properties, respectively.\n   *\n   * @exception {DeveloperError} drawingBufferWidth must be greater than zero.\n   * @exception {DeveloperError} drawingBufferHeight must be greater than zero.\n   *\n   * @example\n   * // Example 1\n   * // Get the width and height of a pixel.\n   * const pixelSize = camera.frustum.getPixelDimensions(scene.drawingBufferWidth, scene.drawingBufferHeight, 1.0, new Vector2());\n   *\n   * @example\n   * // Example 2\n   * // Get the width and height of a pixel if the near plane was set to 'distance'.\n   * // For example, get the size of a pixel of an image on a billboard.\n   * const position = camera.position;\n   * const direction = camera.direction;\n   * const toCenter = Vector3.subtract(primitive.boundingVolume.center, position, new Vector3());      // vector from camera to a primitive\n   * const toCenterProj = Vector3.multiplyByScalar(direction, Vector3.dot(direction, toCenter), new Vector3()); // project vector onto camera direction vector\n   * const distance = Vector3.magnitude(toCenterProj);\n   * const pixelSize = camera.frustum.getPixelDimensions(scene.drawingBufferWidth, scene.drawingBufferHeight, distance, new Vector2());\n   */\n  getPixelDimensions(drawingBufferWidth, drawingBufferHeight, distance, result) {\n    update(this);\n\n    assert(Number.isFinite(drawingBufferWidth) && Number.isFinite(drawingBufferHeight));\n    // 'Both drawingBufferWidth and drawingBufferHeight are required.'\n    assert(drawingBufferWidth > 0);\n    // 'drawingBufferWidth must be greater than zero.'\n    assert(drawingBufferHeight > 0);\n    // 'drawingBufferHeight must be greater than zero.'\n    assert(distance > 0);\n    // 'distance is required.');\n    assert(result);\n    // 'A result object is required.');\n\n    const inverseNear = 1.0 / this.near;\n    let tanTheta = this.top * inverseNear;\n    const pixelHeight = (2.0 * distance * tanTheta) / drawingBufferHeight;\n    tanTheta = this.right * inverseNear;\n    const pixelWidth = (2.0 * distance * tanTheta) / drawingBufferWidth;\n\n    result.x = pixelWidth;\n    result.y = pixelHeight;\n    return result;\n  }\n}\n\n// eslint-disable-next-line complexity, max-statements\nfunction update(frustum) {\n  assert(\n    Number.isFinite(frustum.right) &&\n      Number.isFinite(frustum.left) &&\n      Number.isFinite(frustum.top) &&\n      Number.isFinite(frustum.bottom) &&\n      Number.isFinite(frustum.near) &&\n      Number.isFinite(frustum.far)\n  );\n  // throw new DeveloperError('right, left, top, bottom, near, or far parameters are not set.');\n\n  const {top, bottom, right, left, near, far} = frustum;\n\n  if (\n    top !== frustum._top ||\n    bottom !== frustum._bottom ||\n    left !== frustum._left ||\n    right !== frustum._right ||\n    near !== frustum._near ||\n    far !== frustum._far\n  ) {\n    assert(\n      frustum.near > 0 && frustum.near < frustum.far,\n      'near must be greater than zero and less than far.'\n    );\n\n    frustum._left = left;\n    frustum._right = right;\n    frustum._top = top;\n    frustum._bottom = bottom;\n    frustum._near = near;\n    frustum._far = far;\n    frustum._perspectiveMatrix = new Matrix4().frustum({\n      left,\n      right,\n      bottom,\n      top,\n      near,\n      far\n    });\n    frustum._infinitePerspective = new Matrix4().frustum({\n      left,\n      right,\n      bottom,\n      top,\n      near,\n      far: Infinity\n    });\n  }\n}\n"],"file":"perspective-off-center-frustum.js"}